<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="ä»¥å¤ªåŠä¸Šçš„ä»£å¸è®©æˆ‘ä»¬æ¥èŠèŠ ä»£å¸.å¦‚æœä½ å¯¹ä»¥å¤ªåŠçš„ä¸–ç•Œæœ‰ä¸€äº›äº†è§£ï¼Œä½ å¾ˆå¯èƒ½å¬è¿‡äººä»¬èŠåˆ°ä»£å¸â€”â€”å°¤å…¶æ˜¯ ERC20 ä»£å¸\.ä¸€ä¸ª ä»£å¸ åœ¨ä»¥å¤ªåŠåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªéµå¾ªä¸€äº›å…±åŒè§„åˆ™çš„æ™ºèƒ½åˆçº¦â€”â€”å³å®ƒå®ç°äº†æ‰€æœ‰å…¶ä»–ä»£å¸åˆçº¦å…±äº«çš„ä¸€ç»„æ ‡å‡†å‡½æ•°ï¼Œä¾‹å¦‚ transfer(address _to, uint256 _value) å’Œ balanceOf(address _owner).">
<meta name="keywords" content="solidity">
<meta property="og:type" content="article">
<meta property="og:title" content="ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“">
<meta property="og:url" content="http:&#x2F;&#x2F;lisongbai.top&#x2F;2020&#x2F;06&#x2F;29&#x2F;ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81&#x2F;index.html">
<meta property="og:site_name" content="å°æã®åšå®¢">
<meta property="og:description" content="ä»¥å¤ªåŠä¸Šçš„ä»£å¸è®©æˆ‘ä»¬æ¥èŠèŠ ä»£å¸.å¦‚æœä½ å¯¹ä»¥å¤ªåŠçš„ä¸–ç•Œæœ‰ä¸€äº›äº†è§£ï¼Œä½ å¾ˆå¯èƒ½å¬è¿‡äººä»¬èŠåˆ°ä»£å¸â€”â€”å°¤å…¶æ˜¯ ERC20 ä»£å¸\.ä¸€ä¸ª ä»£å¸ åœ¨ä»¥å¤ªåŠåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªéµå¾ªä¸€äº›å…±åŒè§„åˆ™çš„æ™ºèƒ½åˆçº¦â€”â€”å³å®ƒå®ç°äº†æ‰€æœ‰å…¶ä»–ä»£å¸åˆçº¦å…±äº«çš„ä¸€ç»„æ ‡å‡†å‡½æ•°ï¼Œä¾‹å¦‚ transfer(address _to, uint256 _value) å’Œ balanceOf(address _owner).">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;29&#x2F;OwCBJ4kfo8W9RpM.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;29&#x2F;Rt1SieE7unND4zc.png">
<meta property="og:updated_time" content="2020-06-29T15:34:10.047Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;29&#x2F;OwCBJ4kfo8W9RpM.png">

<link rel="canonical" href="http://lisongbai.top/2020/06/29/ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“ | å°æã®åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="å°æã®åšå®¢" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å°æã®åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">æˆ‘æœ‰ä¸€å£¶é…’ï¼Œè¶³ä»¥æ…°å¹³ç”Ÿã€‚</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/yym08090809" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lisongbai.top/2020/06/29/ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ææ¾æŸ">
      <meta itemprop="description" content="è®°å½•å­¦ä¹ çš„æŠ€èƒ½å’Œé‡åˆ°çš„é—®é¢˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°æã®åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-06-29 18:44:50 / ä¿®æ”¹æ—¶é—´ï¼š23:34:10" itemprop="dateCreated datePublished" datetime="2020-06-29T18:44:50+08:00">2020-06-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/loom-network/" itemprop="url" rel="index">
                    <span itemprop="name">loom network</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020/06/29/ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81/" class="post-meta-item leancloud_visitors" data-flag-title="ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2020/06/29/ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/06/29/ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="ä»¥å¤ªåŠä¸Šçš„ä»£å¸"><a href="#ä»¥å¤ªåŠä¸Šçš„ä»£å¸" class="headerlink" title="ä»¥å¤ªåŠä¸Šçš„ä»£å¸"></a>ä»¥å¤ªåŠä¸Šçš„ä»£å¸</h1><p>è®©æˆ‘ä»¬æ¥èŠèŠ <strong><em>ä»£å¸</em></strong>.</p><p>å¦‚æœä½ å¯¹ä»¥å¤ªåŠçš„ä¸–ç•Œæœ‰ä¸€äº›äº†è§£ï¼Œä½ å¾ˆå¯èƒ½å¬è¿‡äººä»¬èŠåˆ°ä»£å¸â€”â€”å°¤å…¶æ˜¯ <strong><em>ERC20 ä»£å¸\</em></strong>.</p><p>ä¸€ä¸ª <strong><em>ä»£å¸</em></strong> åœ¨ä»¥å¤ªåŠåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªéµå¾ªä¸€äº›å…±åŒè§„åˆ™çš„æ™ºèƒ½åˆçº¦â€”â€”å³å®ƒå®ç°äº†æ‰€æœ‰å…¶ä»–ä»£å¸åˆçº¦å…±äº«çš„ä¸€ç»„æ ‡å‡†å‡½æ•°ï¼Œä¾‹å¦‚ <code>transfer(address _to, uint256 _value)</code> å’Œ <code>balanceOf(address _owner)</code>.</p><a id="more"></a>


<p>åœ¨æ™ºèƒ½åˆçº¦å†…éƒ¨ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªæ˜ å°„ï¼Œ <code>mapping(address =&gt; uint256) balances</code>ï¼Œç”¨äºè¿½è¸ªæ¯ä¸ªåœ°å€è¿˜æœ‰å¤šå°‘ä½™é¢ã€‚</p>
<p>æ‰€ä»¥åŸºæœ¬ä¸Šä¸€ä¸ªä»£å¸åªæ˜¯ä¸€ä¸ªè¿½è¸ªè°æ‹¥æœ‰å¤šå°‘è¯¥ä»£å¸çš„åˆçº¦ï¼Œå’Œä¸€äº›å¯ä»¥è®©é‚£äº›ç”¨æˆ·å°†ä»–ä»¬çš„ä»£å¸è½¬ç§»åˆ°å…¶ä»–åœ°å€çš„å‡½æ•°ã€‚</p>
<h2 id="å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ"><a href="#å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ" class="headerlink" title="å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ"></a>å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ</h2><p>ç”±äºæ‰€æœ‰ ERC20 ä»£å¸å…±äº«å…·æœ‰ç›¸åŒåç§°çš„åŒä¸€ç»„å‡½æ•°ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚</p>
<p>è¿™æ„å‘³ç€å¦‚æœä½ æ„å»ºçš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸ä¸€ä¸ª ERC20 ä»£å¸è¿›è¡Œäº¤äº’ï¼Œé‚£ä¹ˆå®ƒå°±ä¹Ÿèƒ½å¤Ÿä¸ä»»ä½• ERC20 ä»£å¸è¿›è¡Œäº¤äº’ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå°†æ¥ä½ å°±å¯ä»¥è½»æ¾åœ°å°†æ›´å¤šçš„ä»£å¸æ·»åŠ åˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œè€Œæ— éœ€è¿›è¡Œè‡ªå®šä¹‰ç¼–ç ã€‚ ä½ å¯ä»¥ç®€å•åœ°æ’å…¥æ–°çš„ä»£å¸åˆçº¦åœ°å€ï¼Œç„¶åå“—å•¦ï¼Œä½ çš„åº”ç”¨ç¨‹åºæœ‰å¦ä¸€ä¸ªå®ƒå¯ä»¥ä½¿ç”¨çš„ä»£å¸äº†ã€‚</p>
<p>å…¶ä¸­ä¸€ä¸ªä¾‹å­å°±æ˜¯äº¤æ˜“æ‰€ã€‚ å½“äº¤æ˜“æ‰€æ·»åŠ ä¸€ä¸ªæ–°çš„ ERC20 ä»£å¸æ—¶ï¼Œå®é™…ä¸Šå®ƒåªéœ€è¦æ·»åŠ ä¸ä¹‹å¯¹è¯çš„å¦ä¸€ä¸ªæ™ºèƒ½åˆçº¦ã€‚ ç”¨æˆ·å¯ä»¥è®©é‚£ä¸ªåˆçº¦å°†ä»£å¸å‘é€åˆ°äº¤æ˜“æ‰€çš„é’±åŒ…åœ°å€ï¼Œç„¶åäº¤æ˜“æ‰€å¯ä»¥è®©åˆçº¦åœ¨ç”¨æˆ·è¦æ±‚å–æ¬¾æ—¶å°†ä»£å¸å‘é€å›ç»™ä»–ä»¬ã€‚</p>
<p>äº¤æ˜“æ‰€åªéœ€è¦å®ç°è¿™ç§è½¬ç§»é€»è¾‘ä¸€æ¬¡ï¼Œç„¶åå½“å®ƒæƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ ERC20 ä»£å¸æ—¶ï¼Œåªéœ€å°†æ–°çš„åˆçº¦åœ°å€æ·»åŠ åˆ°å®ƒçš„æ•°æ®åº“å³å¯ã€‚</p>
<h2 id="å…¶ä»–ä»£å¸æ ‡å‡†"><a href="#å…¶ä»–ä»£å¸æ ‡å‡†" class="headerlink" title="å…¶ä»–ä»£å¸æ ‡å‡†"></a>å…¶ä»–ä»£å¸æ ‡å‡†</h2><p>å¯¹äºåƒè´§å¸ä¸€æ ·çš„ä»£å¸æ¥è¯´ï¼ŒERC20 ä»£å¸éå¸¸é…·ã€‚ ä½†æ˜¯è¦åœ¨æˆ‘ä»¬åƒµå°¸æ¸¸æˆä¸­ä»£è¡¨åƒµå°¸å°±å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œåƒµå°¸ä¸åƒè´§å¸å¯ä»¥åˆ†å‰² â€”â€” æˆ‘å¯ä»¥å‘ç»™ä½  0.237 ä»¥å¤ªï¼Œä½†æ˜¯è½¬ç§»ç»™ä½  0.237 çš„åƒµå°¸å¬èµ·æ¥å°±æœ‰äº›æç¬‘ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰åƒµå°¸éƒ½æ˜¯å¹³ç­‰çš„ã€‚ ä½ çš„2çº§åƒµå°¸â€<strong>Steve</strong>â€œå®Œå…¨ä¸èƒ½ç­‰åŒäºæˆ‘732çº§çš„åƒµå°¸â€<strong>H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</strong>â€œã€‚ï¼ˆä½ å·®å¾—è¿œå‘¢ï¼Œ<em>Steve</em>ï¼‰ã€‚</p>
<p>æœ‰å¦ä¸€ä¸ªä»£å¸æ ‡å‡†æ›´é€‚åˆå¦‚ CryptoZombies è¿™æ ·çš„åŠ å¯†æ”¶è—å“â€”â€”å®ƒä»¬è¢«ç§°ä¸º<strong><em>ERC721 ä»£å¸.\</em></strong></p>
<p><strong><em>ERC721 ä»£å¸\</em></strong>æ˜¯<strong>ä¸</strong>èƒ½äº’æ¢çš„ï¼Œå› ä¸ºæ¯ä¸ªä»£å¸éƒ½è¢«è®¤ä¸ºæ˜¯å”¯ä¸€ä¸”ä¸å¯åˆ†å‰²çš„ã€‚ ä½ åªèƒ½ä»¥æ•´ä¸ªå•ä½äº¤æ˜“å®ƒä»¬ï¼Œå¹¶ä¸”æ¯ä¸ªå•ä½éƒ½æœ‰å”¯ä¸€çš„ IDã€‚ è¿™äº›ç‰¹æ€§æ­£å¥½è®©æˆ‘ä»¬çš„åƒµå°¸å¯ä»¥ç”¨æ¥äº¤æ˜“ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œä½¿ç”¨åƒ ERC721 è¿™æ ·çš„æ ‡å‡†çš„ä¼˜åŠ¿å°±æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­å®ç°æ‹å–æˆ–æ‰˜ç®¡é€»è¾‘ï¼Œè¿™å†³å®šäº†ç©å®¶èƒ½å¤Ÿå¦‚ä½•äº¤æ˜“ï¼å‡ºå”®æˆ‘ä»¬çš„åƒµå°¸ã€‚ å¦‚æœæˆ‘ä»¬ç¬¦åˆè§„èŒƒï¼Œå…¶ä»–äººå¯ä»¥ä¸ºåŠ å¯†å¯äº¤æ˜“çš„ ERC721 èµ„äº§æ­å»ºä¸€ä¸ªäº¤æ˜“æ‰€å¹³å°ï¼Œæˆ‘ä»¬çš„ ERC721 åƒµå°¸å°†å¯ä»¥åœ¨è¯¥å¹³å°ä¸Šä½¿ç”¨ã€‚ æ‰€ä»¥ä½¿ç”¨ä»£å¸æ ‡å‡†ç›¸è¾ƒäºä½¿ç”¨ä½ è‡ªå·±çš„äº¤æ˜“é€»è¾‘æœ‰æ˜æ˜¾çš„å¥½å¤„ã€‚</p>
</blockquote>
<h2 id="å®æˆ˜æ¼”ä¹ "><a href="#å®æˆ˜æ¼”ä¹ " class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« æ·±å…¥è®¨è®ºERC721çš„å®ç°ã€‚ ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¸ºæœ¬è¯¾è®¾ç½®æˆ‘ä»¬çš„æ–‡ä»¶ç»“æ„ã€‚</p>
<p>æˆ‘ä»¬å°†æŠŠæ‰€æœ‰ERC721é€»è¾‘å­˜å‚¨åœ¨ä¸€ä¸ªå«<code>ZombieOwnership</code>çš„åˆçº¦ä¸­ã€‚</p>
<ol>
<li>åœ¨æ–‡ä»¶é¡¶éƒ¨å£°æ˜æˆ‘ä»¬<code>pragma</code>çš„ç‰ˆæœ¬ï¼ˆæ ¼å¼å‚è€ƒä¹‹å‰çš„è¯¾ç¨‹ï¼‰ã€‚</li>
<li>å°† <code>zombieattack.sol</code> <code>import</code> è¿›æ¥ã€‚</li>
<li>å£°æ˜ä¸€ä¸ªç»§æ‰¿ <code>ZombieAttack</code> çš„æ–°åˆçº¦ï¼Œ å‘½åä¸º<code>ZombieOwnership</code>ã€‚åˆçº¦çš„å…¶ä»–éƒ¨åˆ†å…ˆç•™ç©ºã€‚</li>
</ol>
<h2 id="åˆçº¦åˆ›å»º"><a href="#åˆçº¦åˆ›å»º" class="headerlink" title="åˆçº¦åˆ›å»º"></a>åˆçº¦åˆ›å»º</h2><p>ZombieOwnership.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombieattack.sol"</span>;</span><br><span class="line">contract ZombieOwnership is ZombieAttack &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿"><a href="#ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿" class="headerlink" title="ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿"></a>ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</h1><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ ERC721 æ ‡å‡†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">contract ERC721 &#123;</span><br><span class="line">  event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</span><br><span class="line">  event Approval(address indexed _owner, address indexed _approved, uint256 _tokenId);</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint256 _balance);</span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner);</span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line">  function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">  function takeOwnership(uint256 _tokenId) public;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æˆ‘ä»¬éœ€è¦å®ç°çš„æ–¹æ³•åˆ—è¡¨ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­é€ä¸ªå­¦ä¹ ã€‚</p>
<p>è™½ç„¶çœ‹èµ·æ¥å¾ˆå¤šï¼Œä½†ä¸è¦è¢«å“åˆ°äº†ï¼æˆ‘ä»¬åœ¨è¿™é‡Œå°±æ˜¯å‡†å¤‡å¸¦ç€ä½ ä¸€æ­¥ä¸€æ­¥äº†è§£å®ƒä»¬çš„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š ERC721ç›®å‰æ˜¯ä¸€ä¸ª <em>è‰ç¨¿</em>ï¼Œè¿˜æ²¡æœ‰æ­£å¼å•†å®šçš„å®ç°ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ OpenZeppelin åº“ä¸­çš„å½“å‰ç‰ˆæœ¬ï¼Œä½†åœ¨æœªæ¥æ­£å¼å‘å¸ƒä¹‹å‰å®ƒå¯èƒ½ä¼šæœ‰æ›´æ”¹ã€‚ æ‰€ä»¥æŠŠè¿™ <strong>ä¸€ä¸ª</strong> å¯èƒ½çš„å®ç°å½“ä½œè€ƒè™‘ï¼Œä½†ä¸è¦æŠŠå®ƒä½œä¸º ERC721 ä»£å¸çš„å®˜æ–¹æ ‡å‡†ã€‚</p>
</blockquote>
<h2 id="å®ç°ä¸€ä¸ªä»£å¸åˆçº¦"><a href="#å®ç°ä¸€ä¸ªä»£å¸åˆçº¦" class="headerlink" title="å®ç°ä¸€ä¸ªä»£å¸åˆçº¦"></a>å®ç°ä¸€ä¸ªä»£å¸åˆçº¦</h2><p>åœ¨å®ç°ä¸€ä¸ªä»£å¸åˆçº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åšçš„æ˜¯å°†æ¥å£å¤åˆ¶åˆ°å®ƒè‡ªå·±çš„ Solidity æ–‡ä»¶å¹¶å¯¼å…¥å®ƒï¼Œ<code>import &quot;./erc721.sol&quot;;</code>ã€‚ æ¥ç€ï¼Œè®©æˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿å®ƒï¼Œç„¶åæˆ‘ä»¬ç”¨ä¸€ä¸ªå‡½æ•°å®šä¹‰æ¥é‡å†™æ¯ä¸ªæ–¹æ³•ã€‚</p>
<p>ä½†ç­‰ä¸€ä¸‹â€”â€” <code>ZombieOwnership</code>å·²ç»ç»§æ‰¿è‡ª <code>ZombieAttack</code>äº† â€”â€” å®ƒå¦‚ä½•èƒ½å¤Ÿä¹Ÿç»§æ‰¿äº <code>ERC721</code>å‘¢ï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯åœ¨Solidityï¼Œä½ çš„åˆçº¦å¯ä»¥ç»§æ‰¿è‡ªå¤šä¸ªåˆçº¦ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract SatoshiNakamoto is NickSzabo, HalFinney &#123;</span><br><span class="line">  // å•§å•§å•§ï¼Œå®‡å®™çš„å¥¥ç§˜æ³„éœ²äº†</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚ä½ æ‰€è§ï¼Œå½“ä½¿ç”¨å¤šé‡ç»§æ‰¿çš„æ—¶å€™ï¼Œä½ åªéœ€è¦ç”¨é€—å· <code>,</code> æ¥éš”å¼€å‡ ä¸ªä½ æƒ³è¦ç»§æ‰¿çš„åˆçº¦ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿è‡ª <code>NickSzabo</code> å’Œ <code>HalFinney</code>ã€‚</p>
<p>æ¥è¯•è¯•å§ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -1"><a href="#å®æˆ˜æ¼”ä¹ -1" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬å·²ç»åœ¨ä¸Šé¢ä¸ºä½ åˆ›å»ºäº†å¸¦ç€æ¥å£çš„ <code>erc721.sol</code> ã€‚</p>
<ol>
<li>å°† <code>erc721.sol</code> å¯¼å…¥åˆ° <code>zombieownership.sol</code></li>
<li>å£°æ˜ <code>ZombieOwnership</code> ç»§æ‰¿è‡ª <code>ZombieAttack</code> å’Œ <code>ERC721</code></li>
</ol>
<h2 id="åˆçº¦å®Œå–„"><a href="#åˆçº¦å®Œå–„" class="headerlink" title="åˆçº¦å®Œå–„"></a>åˆçº¦å®Œå–„</h2><p>ZombieOwnership.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombieattack.sol"</span>;</span><br><span class="line"><span class="comment">// åœ¨è¿™é‡Œå¼•å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./erc721.sol"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨è¿™é‡Œå£°æ˜ ERC721 çš„ç»§æ‰¿</span></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="balanceOf-å’Œ-ownerOf"><a href="#balanceOf-å’Œ-ownerOf" class="headerlink" title="balanceOf å’Œ ownerOf"></a>balanceOf å’Œ ownerOf</h1><p>å¤ªæ£’äº†ï¼Œæˆ‘ä»¬æ¥æ·±å…¥è®¨è®ºä¸€ä¸‹ ERC721 çš„å®ç°ã€‚</p>
<p>æˆ‘ä»¬å·²ç»æŠŠæ‰€æœ‰ä½ éœ€è¦åœ¨æœ¬è¯¾ä¸­å®ç°çš„å‡½æ•°çš„ç©ºå£³å¤åˆ¶å¥½äº†ã€‚</p>
<p>åœ¨æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å°†å®ç°å¤´ä¸¤ä¸ªæ–¹æ³•ï¼š <code>balanceOf</code> å’Œ <code>ownerOf</code>ã€‚</p>
<h2 id="balanceOf"><a href="#balanceOf" class="headerlink" title="balanceOf"></a><code>balanceOf</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function balanceOf(address _owner) public view returns (uint256 _balance);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°åªéœ€è¦ä¸€ä¸ªä¼ å…¥ <code>address</code> å‚æ•°ï¼Œç„¶åè¿”å›è¿™ä¸ª <code>address</code> æ‹¥æœ‰å¤šå°‘ä»£å¸ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„â€œä»£å¸â€æ˜¯åƒµå°¸ã€‚ä½ è¿˜è®°å¾—åœ¨æˆ‘ä»¬ DApp çš„å“ªé‡Œå­˜å‚¨äº†ä¸€ä¸ªä¸»äººæ‹¥æœ‰å¤šå°‘åªåƒµå°¸å—ï¼Ÿ</p>
<h2 id="ownerOf"><a href="#ownerOf" class="headerlink" title="ownerOf"></a><code>ownerOf</code></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function ownerOf(uint256 _tokenId) public view returns (address _owner);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ªä»£å¸ ID ä½œä¸ºå‚æ•° (æˆ‘ä»¬çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ªåƒµå°¸ ID)ï¼Œç„¶åè¿”å›è¯¥ä»£å¸æ‹¥æœ‰è€…çš„ <code>address</code>ã€‚</p>
<p>åŒæ ·çš„ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ DApp é‡Œå·²ç»æœ‰ä¸€ä¸ª <code>mapping</code> (æ˜ å°„) å­˜å‚¨äº†è¿™ä¸ªä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹æˆ‘ä»¬æ¥è¯´è¿™ä¸ªå®ç°éå¸¸ç›´æ¥æ¸…æ™°ã€‚æˆ‘ä»¬å¯ä»¥åªç”¨ä¸€è¡Œ <code>return</code> è¯­å¥æ¥å®ç°è¿™ä¸ªå‡½æ•°ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¦è®°å¾—ï¼Œ <code>uint256</code> ç­‰åŒäº<code>uint</code>ã€‚æˆ‘ä»¬ä»è¯¾ç¨‹çš„å¼€å§‹ä¸€ç›´åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>uint</code>ï¼Œä½†ä»ç°åœ¨å¼€å§‹æˆ‘ä»¬å°†åœ¨è¿™é‡Œç”¨ <code>uint256</code>ï¼Œå› ä¸ºæˆ‘ä»¬ç›´æ¥ä»è§„èŒƒä¸­å¤åˆ¶ç²˜è´´ã€‚</p>
</blockquote>
<h2 id="å®æˆ˜æ¼”ä¹ -2"><a href="#å®æˆ˜æ¼”ä¹ -2" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘å°†è®©ä½ æ¥å†³å®šå¦‚ä½•å®ç°è¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<p>æ¯ä¸ªå‡½æ•°çš„ä»£ç éƒ½åº”è¯¥åªæœ‰1è¡Œ <code>return</code> è¯­å¥ã€‚çœ‹çœ‹æˆ‘ä»¬åœ¨ä¹‹å‰è¯¾ç¨‹ä¸­å†™çš„ä»£ç ï¼Œæƒ³æƒ³æˆ‘ä»¬éƒ½æŠŠè¿™ä¸ªæ•°æ®å­˜å‚¨åœ¨å“ªã€‚å¦‚æœä½ è§‰å¾—æœ‰å›°éš¾ï¼Œä½ å¯ä»¥ç‚¹â€œæˆ‘è¦çœ‹ç­”æ¡ˆâ€çš„æŒ‰é’®æ¥è·å¾—å¸®åŠ©ã€‚</p>
<ol>
<li>å®ç° <code>balanceOf</code> æ¥è¿”å› <code>_owner</code> æ‹¥æœ‰çš„åƒµå°¸æ•°é‡ã€‚</li>
<li>å®ç° <code>ownerOf</code> æ¥è¿”å›æ‹¥æœ‰ ID ä¸º <code>_tokenId</code> åƒµå°¸çš„æ‰€æœ‰è€…çš„åœ°å€ã€‚</li>
</ol>
<h2 id="åˆçº¦å®Œå–„-1"><a href="#åˆçº¦å®Œå–„-1" class="headerlink" title="åˆçº¦å®Œå–„"></a>åˆçº¦å®Œå–„</h2><p>ZombieOwnership.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombieattack.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./erc721.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 _balance</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åœ¨è¿™é‡Œè¿”å› `_owner` æ‹¥æœ‰çš„åƒµå°¸æ•°</span></span><br><span class="line">    <span class="keyword">return</span> ownerZombieCount[_owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address _owner</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2. åœ¨è¿™é‡Œè¿”å› `_tokenId` çš„æ‰€æœ‰è€…</span></span><br><span class="line">    <span class="keyword">return</span> zombieToOwner[_tokenId];</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="é‡æ„"><a href="#é‡æ„" class="headerlink" title="é‡æ„"></a>é‡æ„</h1><p>å˜¿å˜¿ï¼æˆ‘ä»¬åˆšåˆšçš„ä»£ç ä¸­å…¶å®æœ‰ä¸ªé”™è¯¯ï¼Œä»¥è‡³äºå…¶æ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä½ å‘ç°äº†æ²¡ï¼Ÿ</p>
<p>åœ¨å‰ä¸€ä¸ªç« èŠ‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå« <code>ownerOf</code> çš„å‡½æ•°ã€‚ä½†å¦‚æœä½ è¿˜è®°å¾—ç¬¬4è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬åŒæ ·åœ¨<code>zombiefeeding.sol</code> é‡Œä»¥ <code>ownerOf</code> å‘½ååˆ›å»ºäº†ä¸€ä¸ª <code>modifier</code>ï¼ˆä¿®é¥°ç¬¦ï¼‰ã€‚</p>
<p>å¦‚æœä½ å°è¯•ç¼–è¯‘è¿™æ®µä»£ç ï¼Œç¼–è¯‘å™¨ä¼šç»™ä½ ä¸€ä¸ªé”™è¯¯è¯´ä½ ä¸èƒ½æœ‰ç›¸åŒåç§°çš„ä¿®é¥°ç¬¦å’Œå‡½æ•°ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æŠŠåœ¨ <code>ZombieOwnership</code> é‡Œçš„å‡½æ•°åç§°æ”¹æˆåˆ«çš„å—ï¼Ÿ</p>
<p>ä¸ï¼Œæˆ‘ä»¬ä¸èƒ½é‚£æ ·åšï¼ï¼ï¼è¦è®°å¾—ï¼Œæˆ‘ä»¬æ­£åœ¨ç”¨ ERC721 ä»£å¸æ ‡å‡†ï¼Œæ„å‘³ç€å…¶ä»–åˆçº¦å°†æœŸæœ›æˆ‘ä»¬çš„åˆçº¦ä»¥è¿™äº›ç¡®åˆ‡çš„åç§°æ¥å®šä¹‰å‡½æ•°ã€‚è¿™å°±æ˜¯è¿™äº›æ ‡å‡†å®ç”¨çš„åŸå› â€”â€”å¦‚æœå¦ä¸€ä¸ªåˆçº¦çŸ¥é“æˆ‘ä»¬çš„åˆçº¦ç¬¦åˆ ERC721 æ ‡å‡†ï¼Œå®ƒå¯ä»¥ç›´æ¥ä¸æˆ‘ä»¬äº¤äº’ï¼Œè€Œæ— éœ€äº†è§£ä»»ä½•å…³äºæˆ‘ä»¬å†…éƒ¨å¦‚ä½•å®ç°çš„ç»†èŠ‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œé‚£æ„å‘³ç€æˆ‘ä»¬å°†å¿…é¡»é‡æ„æˆ‘ä»¬ç¬¬4è¯¾ä¸­çš„ä»£ç ï¼Œå°† <code>modifier</code> çš„åç§°æ¢æˆåˆ«çš„ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -3"><a href="#å®æˆ˜æ¼”ä¹ -3" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬å›åˆ°äº† <code>zombiefeeding.sol</code> ã€‚æˆ‘ä»¬å°†æŠŠ <code>modifier</code> çš„åç§°ä» <code>ownerOf</code> æ”¹æˆ <code>onlyOwnerOf</code>ã€‚</p>
<ol>
<li>æŠŠä¿®é¥°ç¬¦å®šä¹‰ä¸­çš„åç§°æ”¹æˆ <code>onlyOwnerOf</code></li>
<li>å¾€ä¸‹æ»‘åˆ°ä½¿ç”¨æ­¤ä¿®é¥°ç¬¦çš„å‡½æ•° <code>feedAndMultiply</code> ã€‚æˆ‘ä»¬ä¹Ÿéœ€è¦æ”¹è¿™é‡Œçš„åç§°ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ <code>zombiehelper.sol</code> å’Œ <code>zombieattack.sol</code> é‡Œä¹Ÿä½¿ç”¨äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œä½†ä¸ºäº†ä¸åœ¨è¿™èŠ‚è¯¾çš„é‡æ„é‡ŒèŠ±å¤ªå¤šæ—¶é—´ï¼Œæˆ‘ä»¬å·²ç»å°†é‚£äº›æ–‡ä»¶é‡Œçš„ä¿®é¥°ç¬¦åç§°ä¸ºä½ æ”¹å¥½äº†ã€‚</p>
</blockquote>
<h2 id="åˆçº¦ä¿®æ”¹"><a href="#åˆçº¦ä¿®æ”¹" class="headerlink" title="åˆçº¦ä¿®æ”¹"></a>åˆçº¦ä¿®æ”¹</h2><p>zombiefeeding.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombiefactory.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract KittyInterface &#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getKitty</span>(<span class="params">uint256 _id</span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    bool isGestating,</span></span></span><br><span class="line"><span class="function"><span class="params">    bool isReady,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 cooldownIndex,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 nextActionAt,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 siringWithId,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 birthTime,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 matronId,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 sireId,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 generation,</span></span></span><br><span class="line"><span class="function"><span class="params">    uint256 genes</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">contract</span> <span class="title">ZombieFeeding</span> <span class="title">is</span> <span class="title">ZombieFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  KittyInterface kittyContract;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. æŠŠä¿®é¥°ç¬¦åç§°æ”¹æˆ `onlyOwnerOf`</span></span><br><span class="line">  <span class="comment">//modifier ownerOf(uint _zombieId) &#123;</span></span><br><span class="line">    modifier onlyOwnerOf(uint _zombieId) &#123;</span><br><span class="line">    <span class="built_in">require</span>(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setKittyContractAddress</span>(<span class="params">address _address</span>) <span class="title">external</span> <span class="title">onlyOwner</span> </span>&#123;</span><br><span class="line">    kittyContract = KittyInterface(_address);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_triggerCooldown</span>(<span class="params">Zombie storage _zombie</span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">    _zombie.readyTime = uint32(now + cooldownTime);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_isReady</span>(<span class="params">Zombie storage _zombie</span>) <span class="title">internal</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (_zombie.readyTime &lt;= now);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. è¿™é‡Œä¹Ÿè¦ä¿®æ”¹ä¿®é¥°ç¬¦çš„åç§°</span></span><br><span class="line">  <span class="comment">//function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal ownerOf(_zombieId) &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">feedAndMultiply</span>(<span class="params">uint _zombieId, uint _targetDna, string _species</span>) <span class="title">internal</span>  <span class="title">onlyOwnerOf</span>(<span class="params">_zombieId</span>) </span>&#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    <span class="built_in">require</span>(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (keccak256(_species) == keccak256(<span class="string">"kitty"</span>)) &#123;</span><br><span class="line">      newDna = newDna - newDna % <span class="number">100</span> + <span class="number">99</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _createZombie(<span class="string">"NoName"</span>, newDna);</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">feedOnKitty</span>(<span class="params">uint _zombieId, uint _kittyId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna, <span class="string">"kitty"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ERC721-è½¬ç§»æ ‡å‡†"><a href="#ERC721-è½¬ç§»æ ‡å‡†" class="headerlink" title="ERC721: è½¬ç§»æ ‡å‡†"></a>ERC721: è½¬ç§»æ ‡å‡†</h1><p>å¥½äº†ï¼Œæˆ‘ä»¬å°†å†²çªä¿®å¤äº†ï¼</p>
<p>ç°åœ¨æˆ‘ä»¬å°†é€šè¿‡å­¦ä¹ æŠŠæ‰€æœ‰æƒä»ä¸€ä¸ªäººè½¬ç§»ç»™å¦ä¸€ä¸ªäººæ¥ç»§ç»­æˆ‘ä»¬çš„ ERC721 è§„èŒƒçš„å®ç°ã€‚</p>
<p>æ³¨æ„ ERC721 è§„èŒƒæœ‰ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥è½¬ç§»ä»£å¸ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span>;</span></span><br><span class="line"><span class="function"><span class="title">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span>;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä»£å¸çš„æ‹¥æœ‰è€…è°ƒç”¨<code>transfer</code> æ–¹æ³•ï¼Œä¼ å…¥ä»–æƒ³è½¬ç§»åˆ°çš„ <code>address</code> å’Œä»–æƒ³è½¬ç§»çš„ä»£å¸çš„ <code>_tokenId</code>ã€‚</li>
<li>ç¬¬äºŒç§æ–¹æ³•æ˜¯ä»£å¸æ‹¥æœ‰è€…é¦–å…ˆè°ƒç”¨ <code>approve</code>ï¼Œç„¶åä¼ å…¥ä¸ä»¥ä¸Šç›¸åŒçš„å‚æ•°ã€‚æ¥ç€ï¼Œè¯¥åˆçº¦ä¼šå­˜å‚¨è°è¢«å…è®¸æå–ä»£å¸ï¼Œé€šå¸¸å­˜å‚¨åˆ°ä¸€ä¸ª <code>mapping (uint256 =&gt; address)</code> é‡Œã€‚ç„¶åï¼Œå½“æœ‰äººè°ƒç”¨ <code>takeOwnership</code> æ—¶ï¼Œåˆçº¦ä¼šæ£€æŸ¥ <code>msg.sender</code> æ˜¯å¦å¾—åˆ°æ‹¥æœ‰è€…çš„æ‰¹å‡†æ¥æå–ä»£å¸ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†ä»£å¸è½¬ç§»ç»™ä»–ã€‚</li>
</ol>
<p>ä½ æ³¨æ„åˆ°äº†å—ï¼Œ<code>transfer</code> å’Œ <code>takeOwnership</code> éƒ½å°†åŒ…å«ç›¸åŒçš„è½¬ç§»é€»è¾‘ï¼Œåªæ˜¯ä»¥ç›¸åçš„é¡ºåºã€‚ ï¼ˆä¸€ç§æƒ…å†µæ˜¯ä»£å¸çš„å‘é€è€…è°ƒç”¨å‡½æ•°ï¼›å¦ä¸€ç§æƒ…å†µæ˜¯ä»£å¸çš„æ¥æ”¶è€…è°ƒç”¨å®ƒï¼‰ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªé€»è¾‘æŠ½è±¡æˆå®ƒè‡ªå·±çš„ç§æœ‰å‡½æ•° <code>_transfer</code>ï¼Œç„¶åç”±è¿™ä¸¤ä¸ªå‡½æ•°æ¥è°ƒç”¨å®ƒã€‚ è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†™é‡å¤çš„ä»£ç äº†ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -4"><a href="#å®æˆ˜æ¼”ä¹ -4" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>è®©æˆ‘ä»¬æ¥å®šä¹‰ <code>_transfer</code> çš„é€»è¾‘ã€‚</p>
<ol>
<li><p>å®šä¹‰ä¸€ä¸ªåä¸º <code>_transfer</code>çš„å‡½æ•°ã€‚å®ƒä¼šéœ€è¦3ä¸ªå‚æ•°ï¼š<code>address _from</code>ã€<code>address _to</code>å’Œ<code>uint256 _tokenId</code>ã€‚å®ƒåº”è¯¥æ˜¯ä¸€ä¸ª <code>ç§æœ‰</code> å‡½æ•°ã€‚</p>
</li>
<li><p>æˆ‘ä»¬æœ‰2ä¸ªæ˜ å°„ä¼šåœ¨æ‰€æœ‰æƒæ”¹å˜çš„æ—¶å€™æ”¹å˜ï¼š <code>ownerZombieCount</code> ï¼ˆè®°å½•ä¸€ä¸ªæ‰€æœ‰è€…æœ‰å¤šå°‘åªåƒµå°¸ï¼‰å’Œ <code>zombieToOwner</code> ï¼ˆè®°å½•ä»€ä¹ˆäººæ‹¥æœ‰ä»€ä¹ˆï¼‰ã€‚</p>
<p>æˆ‘ä»¬çš„å‡½æ•°éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¸º <strong>æ¥æ”¶</strong> åƒµå°¸çš„äººï¼ˆ<code>address _to</code>ï¼‰å¢ åŠ <code>ownerZombieCount</code>ã€‚ä½¿ç”¨ <code>++</code> æ¥å¢åŠ ã€‚</p>
</li>
<li><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸º <strong>å‘é€</strong> åƒµå°¸çš„äººï¼ˆ<code>address _from</code>ï¼‰<strong>å‡å°‘</strong><code>ownerZombieCount</code>ã€‚ä½¿ç”¨ <code>--</code> æ¥æ‰£å‡ã€‚</p>
</li>
<li><p>æœ€åï¼Œæˆ‘ä»¬å°†æ”¹å˜è¿™ä¸ª <code>_tokenId</code> çš„ <code>zombieToOwner</code> æ˜ å°„ï¼Œè¿™æ ·å®ƒç°åœ¨å°±ä¼šæŒ‡å‘ <code>_to</code>ã€‚</p>
</li>
<li><p>éª—ä½ çš„ï¼Œé‚£ä¸æ˜¯æœ€åä¸€æ­¥ã€‚æˆ‘ä»¬è¿˜éœ€è¦å†åšä¸€ä»¶äº‹æƒ…ã€‚</p>
<p>ERC721è§„èŒƒåŒ…å«äº†ä¸€ä¸ª <code>Transfer</code> äº‹ä»¶ã€‚è¿™ä¸ªå‡½æ•°çš„æœ€åä¸€è¡Œåº”è¯¥ç”¨æ­£ç¡®çš„å‚æ•°è§¦å‘<code>Transfer</code> â€”â€”æŸ¥çœ‹ <code>erc721.sol</code> çœ‹å®ƒæœŸæœ›ä¼ å…¥çš„å‚æ•°å¹¶åœ¨è¿™é‡Œå®ç°ã€‚</p>
</li>
</ol>
<h2 id="åˆçº¦å®Œå–„-2"><a href="#åˆçº¦å®Œå–„-2" class="headerlink" title="åˆçº¦å®Œå–„"></a>åˆçº¦å®Œå–„</h2><p>ZombieOwnership.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombieattack.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./erc721.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 _balance</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ownerZombieCount[_owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address _owner</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zombieToOwner[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨è¿™é‡Œå®šä¹‰ _transfer()</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint256 _tokenId</span>) <span class="title">private</span> </span>&#123;</span><br><span class="line">      ownerZombieCount[_to]++;</span><br><span class="line">      ownerZombieCount[_from]--;</span><br><span class="line">      zombieToOwner[_tokenId] = _to;</span><br><span class="line">      Transfer(_from, _to, _tokenId);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ERC721-è½¬ç§»-ç»­"><a href="#ERC721-è½¬ç§»-ç»­" class="headerlink" title="ERC721: è½¬ç§»-ç»­"></a>ERC721: è½¬ç§»-ç»­</h1><p>å¤ªå¥½äº†ï¼åˆšæ‰é‚£æ˜¯æœ€éš¾çš„éƒ¨åˆ†â€”â€”ç°åœ¨å®ç°å…¬å…±çš„ <code>transfer</code> å‡½æ•°åº”è¯¥ååˆ†å®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬çš„ <code>_transfer</code> å‡½æ•°å‡ ä¹å·²ç»æŠŠæ‰€æœ‰çš„é‡æ´»éƒ½å¹²å®Œäº†ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -5"><a href="#å®æˆ˜æ¼”ä¹ -5" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><ol>
<li><p>æˆ‘ä»¬æƒ³ç¡®ä¿åªæœ‰ä»£å¸æˆ–åƒµå°¸çš„æ‰€æœ‰è€…å¯ä»¥è½¬ç§»å®ƒã€‚è¿˜è®°å¾—æˆ‘ä»¬å¦‚ä½•é™åˆ¶åªæœ‰æ‰€æœ‰è€…æ‰èƒ½è®¿é—®æŸä¸ªåŠŸèƒ½å—ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦èƒ½å¤Ÿå®Œæˆè¿™ä¸ªä»»åŠ¡äº†ã€‚æ‰€ä»¥å°†ä¿®é¥°ç¬¦ <code>onlyOwnerOf</code> æ·»åŠ åˆ°è¿™ä¸ªå‡½æ•°ä¸­ã€‚</p>
</li>
<li><p>ç°åœ¨è¯¥å‡½æ•°çš„æ­£æ–‡åªéœ€è¦ä¸€è¡Œä»£ç ã€‚å®ƒåªéœ€è¦è°ƒç”¨ <code>_transfer</code>ã€‚</p>
<p>è®°å¾—æŠŠ <code>msg.sender</code> ä½œä¸ºå‚æ•°ä¼ é€’è¿› <code>address _from</code>ã€‚</p>
</li>
</ol>
<h2 id="åˆçº¦å®Œå–„-3"><a href="#åˆçº¦å®Œå–„-3" class="headerlink" title="åˆçº¦å®Œå–„"></a>åˆçº¦å®Œå–„</h2><p>ZombieOwnership.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombieattack.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./erc721.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 _balance</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ownerZombieCount[_owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address _owner</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zombieToOwner[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint256 _tokenId</span>) <span class="title">private</span> </span>&#123;</span><br><span class="line">    ownerZombieCount[_to]++;</span><br><span class="line">    ownerZombieCount[_from]--;</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. åœ¨è¿™é‡Œæ·»åŠ ä¿®é¥°ç¬¦</span></span><br><span class="line">  <span class="comment">//function transfer(address _to, uint256 _tokenId) public &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> <span class="title">onlyOwnerOf</span>(<span class="params">_tokenId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2. åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•</span></span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ERC721-æ‰¹å‡†"><a href="#ERC721-æ‰¹å‡†" class="headerlink" title="ERC721: æ‰¹å‡†"></a>ERC721: æ‰¹å‡†</h1><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å®ç° <code>approve</code>ã€‚</p>
<p>è®°ä½ï¼Œä½¿ç”¨ <code>approve</code> æˆ–è€… <code>takeOwnership</code> çš„æ—¶å€™ï¼Œè½¬ç§»æœ‰2ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ä½ ï¼Œä½œä¸ºæ‰€æœ‰è€…ï¼Œç”¨æ–°ä¸»äººçš„ <code>address</code> å’Œä½ å¸Œæœ›ä»–è·å–çš„ <code>_tokenId</code> æ¥è°ƒç”¨ <code>approve</code></li>
<li>æ–°ä¸»äººç”¨ <code>_tokenId</code> æ¥è°ƒç”¨ <code>takeOwnership</code>ï¼Œåˆçº¦ä¼šæ£€æŸ¥ç¡®ä¿ä»–è·å¾—äº†æ‰¹å‡†ï¼Œç„¶åæŠŠä»£å¸è½¬ç§»ç»™ä»–ã€‚</li>
</ol>
<p>å› ä¸ºè¿™å‘ç”Ÿåœ¨2ä¸ªå‡½æ•°çš„è°ƒç”¨ä¸­ï¼Œæ‰€ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨ä»€ä¹ˆäººè¢«æ‰¹å‡†è·å–ä»€ä¹ˆã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -6"><a href="#å®æˆ˜æ¼”ä¹ -6" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><ol>
<li><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªæ˜ å°„ <code>zombieApprovals</code>ã€‚å®ƒåº”è¯¥å°†ä¸€ä¸ª <code>uint</code> æ˜ å°„åˆ°ä¸€ä¸ª <code>address</code>ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œå½“æœ‰äººç”¨ä¸€ä¸ª <code>_tokenId</code> è°ƒç”¨ <code>takeOwnership</code> æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ˜ å°„æ¥å¿«é€ŸæŸ¥æ‰¾è°è¢«æ‰¹å‡†è·å–é‚£ä¸ªä»£å¸ã€‚</p>
</li>
<li><p>åœ¨å‡½æ•° <code>approve</code> ä¸Šï¼Œ æˆ‘ä»¬æƒ³è¦ç¡®ä¿åªæœ‰ä»£å¸æ‰€æœ‰è€…å¯ä»¥æ‰¹å‡†æŸäººæ¥è·å–ä»£å¸ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¿®é¥°ç¬¦ <code>onlyOwnerOf</code> åˆ° <code>approve</code>ã€‚</p>
</li>
<li><p>å‡½æ•°çš„æ­£æ–‡éƒ¨åˆ†ï¼Œå°† <code>_tokenId</code> çš„ <code>zombieApprovals</code> è®¾ç½®ä¸ºå’Œ <code>_to</code> ç›¸ç­‰ã€‚</p>
</li>
<li><p>æœ€åï¼Œåœ¨ ERC721 è§„èŒƒé‡Œæœ‰ä¸€ä¸ª <code>Approval</code> äº‹ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨è¿™ä¸ªå‡½æ•°çš„æœ€åè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚ï¼ˆå‚è€ƒ <code>erc721.sol</code> æ¥ç¡®è®¤ä¼ å…¥çš„å‚æ•°ï¼Œå¹¶ç¡®ä¿ <code>_owner</code> æ˜¯ <code>msg.sender</code>ï¼‰</p>
</li>
</ol>
<h2 id="åˆçº¦å®Œå–„-4"><a href="#åˆçº¦å®Œå–„-4" class="headerlink" title="åˆçº¦å®Œå–„"></a>åˆçº¦å®Œå–„</h2><p>ZombieOwnership.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombieattack.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./erc721.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. åœ¨è¿™é‡Œå®šä¹‰æ˜ å°„</span></span><br><span class="line">  mapping (<span class="function"><span class="params">uint</span> =&gt;</span> address) zombieApprovals;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 _balance</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ownerZombieCount[_owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address _owner</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zombieToOwner[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint256 _tokenId</span>) <span class="title">private</span> </span>&#123;</span><br><span class="line">    ownerZombieCount[_to]++;</span><br><span class="line">    ownerZombieCount[_from]--;</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> <span class="title">onlyOwnerOf</span>(<span class="params">_tokenId</span>) </span>&#123;</span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. åœ¨è¿™é‡Œæ·»åŠ æ–¹æ³•ä¿®é¥°ç¬¦</span></span><br><span class="line">  <span class="comment">//function approve(address _to, uint256 _tokenId) public &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> <span class="title">onlyOwnerOf</span>(<span class="params">_tokenId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 3. åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•</span></span><br><span class="line">    zombieApprovals[_tokenId] = _to;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ERC721-takeOwnership"><a href="#ERC721-takeOwnership" class="headerlink" title="ERC721: takeOwnership"></a>ERC721: takeOwnership</h1><p>å¤ªæ£’äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬å®Œæˆæœ€åä¸€ä¸ªå‡½æ•°æ¥ç»“æŸ ERC721 çš„å®ç°ã€‚ï¼ˆåˆ«æ‹…å¿ƒï¼Œè¿™åé¢æˆ‘ä»¬è¿˜ä¼šè®²æ›´å¤šå†…å®¹ğŸ˜‰ï¼‰</p>
<p>æœ€åä¸€ä¸ªå‡½æ•° <code>takeOwnership</code>ï¼Œ åº”è¯¥åªæ˜¯ç®€å•åœ°æ£€æŸ¥ä»¥ç¡®ä¿ <code>msg.sender</code> å·²ç»è¢«æ‰¹å‡†æ¥æå–è¿™ä¸ªä»£å¸æˆ–è€…åƒµå°¸ã€‚è‹¥ç¡®è®¤ï¼Œå°±è°ƒç”¨ <code>_transfer</code>ï¼›</p>
<h2 id="å®æˆ˜æ¼”ä¹ -7"><a href="#å®æˆ˜æ¼”ä¹ -7" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><ol>
<li><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦ç”¨ä¸€ä¸ª <code>require</code> å¥å¼æ¥æ£€æŸ¥ <code>_tokenId</code> çš„ <code>zombieApprovals</code> å’Œ <code>msg.sender</code> ç›¸ç­‰ã€‚</p>
<p>è¿™æ ·å¦‚æœ <code>msg.sender</code> æœªè¢«æˆæƒæ¥æå–è¿™ä¸ªä»£å¸ï¼Œå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p>
</li>
<li><p>ä¸ºäº†è°ƒç”¨ <code>_transfer</code>ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»£å¸æ‰€æœ‰è€…çš„åœ°å€ï¼ˆå®ƒéœ€è¦ä¸€ä¸ª <code>_from</code> æ¥ä½œä¸ºå‚æ•°ï¼‰ã€‚å¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ <code>ownerOf</code> å‡½æ•°ä¸­æ¥æ‰¾åˆ°è¿™ä¸ªå‚æ•°ã€‚</p>
<p>æ‰€ä»¥ï¼Œå®šä¹‰ä¸€ä¸ªåä¸º <code>owner</code> çš„ <code>address</code> å˜é‡ï¼Œå¹¶ä½¿å…¶ç­‰äº <code>ownerOf(_tokenId)</code>ã€‚</p>
</li>
<li><p>æœ€åï¼Œè°ƒç”¨ <code>_transfer</code>, å¹¶ä¼ å…¥æ‰€æœ‰å¿…é¡»çš„å‚æ•°ã€‚ï¼ˆåœ¨è¿™é‡Œä½ å¯ä»¥ç”¨ <code>msg.sender</code> ä½œä¸º <code>_to</code>ï¼Œ å› ä¸ºä»£å¸æ­£æ˜¯è¦å‘é€ç»™è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„äººï¼‰ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨ä¸€è¡Œä»£ç æ¥å®ç°ç¬¬2ã€3ä¸¤æ­¥ã€‚ä½†æ˜¯åˆ†å¼€å†™ä¼šè®©ä»£ç æ›´æ˜“è¯»ã€‚ä¸€ç‚¹ä¸ªäººå»ºè®® :)</p>
</blockquote>
</li>
</ol>
<h2 id="åˆçº¦å®Œå–„-5"><a href="#åˆçº¦å®Œå–„-5" class="headerlink" title="åˆçº¦å®Œå–„"></a>åˆçº¦å®Œå–„</h2><p>ZombieOwnership.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombieattack.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./erc721.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">  mapping (<span class="function"><span class="params">uint</span> =&gt;</span> address) zombieApprovals;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 _balance</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ownerZombieCount[_owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address _owner</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zombieToOwner[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint256 _tokenId</span>) <span class="title">private</span> </span>&#123;</span><br><span class="line">    ownerZombieCount[_to]++;</span><br><span class="line">    ownerZombieCount[_from]--;</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> <span class="title">onlyOwnerOf</span>(<span class="params">_tokenId</span>) </span>&#123;</span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> <span class="title">onlyOwnerOf</span>(<span class="params">_tokenId</span>) </span>&#123;</span><br><span class="line">    zombieApprovals[_tokenId] = _to;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä»è¿™é‡Œå¼€å§‹</span></span><br><span class="line">    <span class="built_in">require</span>(zombieApprovals[_tokenId] == msg.sender);</span><br><span class="line">    address owner = ownerOf(_tokenId);</span><br><span class="line">    _transfer(owner, msg.sender, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="é¢„é˜²æº¢å‡º"><a href="#é¢„é˜²æº¢å‡º" class="headerlink" title="é¢„é˜²æº¢å‡º"></a>é¢„é˜²æº¢å‡º</h1><p>æ­å–œä½ ï¼Œæˆ‘ä»¬å®Œæˆäº† ERC721 çš„å®ç°ã€‚</p>
<p>å¹¶ä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¯¹å§ï¼Ÿå¾ˆå¤šç±»ä¼¼çš„ä»¥å¤ªåŠæ¦‚å¿µï¼Œå½“ä½ åªå¬äººä»¬è°ˆè®ºå®ƒä»¬çš„æ—¶å€™ï¼Œä¼šè§‰å¾—å¾ˆå¤æ‚ã€‚æ‰€ä»¥æœ€ç®€å•çš„ç†è§£æ–¹å¼å°±æ˜¯ä½ è‡ªå·±æ¥å®ç°å®ƒã€‚</p>
<p>ä¸è¿‡è¦è®°ä½é‚£åªæ˜¯æœ€ç®€å•çš„å®ç°ã€‚è¿˜æœ‰å¾ˆå¤šçš„ç‰¹æ€§æˆ‘ä»¬ä¹Ÿè®¸æƒ³åŠ å…¥åˆ°æˆ‘ä»¬çš„å®ç°ä¸­æ¥ï¼Œæ¯”å¦‚ä¸€äº›é¢å¤–çš„æ£€æŸ¥ï¼Œæ¥ç¡®ä¿ç”¨æˆ·ä¸ä¼šä¸å°å¿ƒæŠŠä»–ä»¬çš„åƒµå°¸è½¬ç§»ç»™<code>0</code> åœ°å€ï¼ˆè¿™è¢«ç§°ä½œ â€œçƒ§å¸â€, åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä»£å¸è½¬ç§»åˆ°ä¸€ä¸ªè°ä¹Ÿæ²¡æœ‰ç§é’¥çš„åœ°å€ï¼Œè®©è¿™ä¸ªä»£å¸æ°¸è¿œä¹Ÿæ— æ³•æ¢å¤ï¼‰ã€‚ æˆ–è€…åœ¨ DApp ä¸­åŠ å…¥ä¸€äº›åŸºæœ¬çš„æ‹å–é€»è¾‘ã€‚ï¼ˆä½ èƒ½æƒ³å‡ºä¸€äº›å®ç°çš„æ–¹æ³•ä¹ˆï¼Ÿï¼‰</p>
<p>ä½†æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„è¯¾ç¨‹ä¸è‡³äºç¦»é¢˜å¤ªè¿œï¼Œæ‰€ä»¥æˆ‘ä»¬åªä¸“æ³¨äºä¸€äº›åŸºç¡€å®ç°ã€‚å¦‚æœä½ æƒ³å­¦ä¹ ä¸€äº›æ›´æ·±å±‚æ¬¡çš„å®ç°ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ•™ç¨‹ç»“æŸåï¼Œå»çœ‹çœ‹ OpenZeppelin çš„ ERC721 åˆçº¦ã€‚</p>
<h2 id="åˆçº¦å®‰å…¨å¢å¼º-æº¢å‡ºå’Œä¸‹æº¢"><a href="#åˆçº¦å®‰å…¨å¢å¼º-æº¢å‡ºå’Œä¸‹æº¢" class="headerlink" title="åˆçº¦å®‰å…¨å¢å¼º: æº¢å‡ºå’Œä¸‹æº¢"></a>åˆçº¦å®‰å…¨å¢å¼º: æº¢å‡ºå’Œä¸‹æº¢</h2><p>æˆ‘ä»¬å°†æ¥å­¦ä¹ ä½ åœ¨ç¼–å†™æ™ºèƒ½åˆçº¦çš„æ—¶å€™éœ€è¦æ³¨æ„çš„ä¸€ä¸ªä¸»è¦çš„å®‰å…¨ç‰¹æ€§ï¼šé˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢ã€‚</p>
<p>ä»€ä¹ˆæ˜¯ <strong><em>æº¢å‡º</em></strong> (<strong><em>overflow\</em></strong>)?</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>uint8</code>, åªèƒ½å­˜å‚¨8 bitæ•°æ®ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬èƒ½å­˜å‚¨çš„æœ€å¤§æ•°å­—å°±æ˜¯äºŒè¿›åˆ¶ <code>11111111</code> (æˆ–è€…è¯´åè¿›åˆ¶çš„ 2^8 - 1 = 255).</p>
<p>æ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚æœ€å <code>number</code> å°†ä¼šæ˜¯ä»€ä¹ˆå€¼ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint8 number = 255;</span><br><span class="line">number++;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¼è‡´äº†æº¢å‡º â€” è™½ç„¶æˆ‘ä»¬åŠ äº†1ï¼Œ ä½†æ˜¯ <code>number</code> å‡ºä¹æ„æ–™åœ°ç­‰äº <code>0</code>äº†ã€‚ (å¦‚æœä½ ç»™äºŒè¿›åˆ¶ <code>11111111</code> åŠ 1, å®ƒå°†è¢«é‡ç½®ä¸º <code>00000000</code>ï¼Œå°±åƒé’Ÿè¡¨ä» <code>23:59</code> èµ°å‘ <code>00:00</code>)ã€‚</p>
<p>ä¸‹æº¢(<code>underflow</code>)ä¹Ÿç±»ä¼¼ï¼Œå¦‚æœä½ ä»ä¸€ä¸ªç­‰äº <code>0</code> çš„ <code>uint8</code> å‡å» <code>1</code>, å®ƒå°†å˜æˆ <code>255</code> (å› ä¸º <code>uint</code> æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶ä¸èƒ½ç­‰äºè´Ÿæ•°)ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬åœ¨è¿™é‡Œä¸ä½¿ç”¨ <code>uint8</code>ï¼Œè€Œä¸”æ¯æ¬¡ç»™ä¸€ä¸ª <code>uint256</code> åŠ  <code>1</code> ä¹Ÿä¸å¤ªå¯èƒ½æº¢å‡º (2^256 çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°äº†)ï¼Œåœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­æ·»åŠ ä¸€äº›ä¿æŠ¤æœºåˆ¶ä¾ç„¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œä»¥é˜²æˆ‘ä»¬çš„ DApp ä»¥åå‡ºç°ä»€ä¹ˆå¼‚å¸¸æƒ…å†µã€‚</p>
<h2 id="ä½¿ç”¨-SafeMath"><a href="#ä½¿ç”¨-SafeMath" class="headerlink" title="ä½¿ç”¨ SafeMath"></a>ä½¿ç”¨ SafeMath</h2><p>ä¸ºäº†é˜²æ­¢è¿™äº›æƒ…å†µï¼ŒOpenZeppelin å»ºç«‹äº†ä¸€ä¸ªå«åš SafeMath çš„ <strong><em>åº“</em></strong>(<strong><em>library\</em></strong>)ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥é˜²æ­¢è¿™äº›é—®é¢˜ã€‚</p>
<p>ä¸è¿‡åœ¨æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰â€¦â€¦ ä»€ä¹ˆå«åšåº“?</p>
<p>ä¸€ä¸ª<strong><em>åº“</em></strong> æ˜¯ Solidity ä¸­ä¸€ç§ç‰¹æ®Šçš„åˆçº¦ã€‚å…¶ä¸­ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯ç»™åŸå§‹æ•°æ®ç±»å‹å¢åŠ ä¸€äº›æ–¹æ³•ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½¿ç”¨ SafeMath åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>using SafeMath for uint256</code> è¿™æ ·çš„è¯­æ³•ã€‚ SafeMath åº“æœ‰å››ä¸ªæ–¹æ³• â€” <code>add</code>ï¼Œ <code>sub</code>ï¼Œ <code>mul</code>ï¼Œ ä»¥åŠ <code>div</code>ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®© <code>uint256</code> è°ƒç”¨è¿™äº›æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">uint256 a = 5;</span><br><span class="line">uint256 b = a.add(3); // 5 + 3 = 8</span><br><span class="line">uint256 c = a.mul(2); // 5 * 2 = 10</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« æ¥å­¦ä¹ è¿™äº›æ–¹æ³•ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬å…ˆå°† SafeMath åº“æ·»åŠ è¿›æˆ‘ä»¬çš„åˆçº¦ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -8"><a href="#å®æˆ˜æ¼”ä¹ -8" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬å·²ç»å¸®ä½ æŠŠ OpenZeppelin çš„ <code>SafeMath</code> åº“åŒ…å«è¿› <code>safemath.sol</code>äº†ï¼Œå¦‚æœä½ æƒ³çœ‹ä¸€ä¸‹ä»£ç çš„è¯ï¼Œç°åœ¨å¯ä»¥çœ‹çœ‹ï¼Œä¸è¿‡æˆ‘ä»¬ä¸‹ä¸€ç« å°†æ·±å…¥è¿›å»ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æ¥å‘Šè¯‰æˆ‘ä»¬çš„åˆçº¦è¦ä½¿ç”¨ SafeMathã€‚æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„ <code>ZombieFactory</code> é‡Œè°ƒç”¨ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„åŸºç¡€åˆçº¦ â€” è¿™æ ·å…¶ä»–æ‰€æœ‰ç»§æ‰¿å‡ºå»çš„å­åˆçº¦éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªåº“äº†ã€‚</p>
<ol>
<li>å°† <code>safemath.sol</code> å¼•å…¥åˆ° <code>zombiefactory.sol</code>.</li>
<li>æ·»åŠ å®šä¹‰ï¼š <code>using SafeMath for uint256;</code>.</li>
</ol>
<h2 id="åˆçº¦ä¿®æ”¹-1"><a href="#åˆçº¦ä¿®æ”¹-1" class="headerlink" title="åˆçº¦ä¿®æ”¹"></a>åˆçº¦ä¿®æ”¹</h2><p>ZombieFactory.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./ownable.sol"</span>;</span><br><span class="line"><span class="comment">// 1. åœ¨è¿™é‡Œå¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./safemath.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. åœ¨è¿™é‡Œå®šä¹‰ using safemath </span></span><br><span class="line">  using SafeMath <span class="keyword">for</span> uint256;</span><br><span class="line">  event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">  uint dnaDigits = <span class="number">16</span>;</span><br><span class="line">  uint dnaModulus = <span class="number">10</span> ** dnaDigits;</span><br><span class="line">  uint cooldownTime = <span class="number">1</span> days;</span><br><span class="line"></span><br><span class="line">  struct Zombie &#123;</span><br><span class="line">    string name;</span><br><span class="line">    uint dna;</span><br><span class="line">    uint32 level;</span><br><span class="line">    uint32 readyTime;</span><br><span class="line">    uint16 winCount;</span><br><span class="line">    uint16 lossCount;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">  mapping (<span class="function"><span class="params">uint</span> =&gt;</span> address) public zombieToOwner;</span><br><span class="line">  mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_createZombie</span>(<span class="params">string _name, uint _dna</span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">    uint id = zombies.push(Zombie(_name, _dna, <span class="number">1</span>, uint32(now + cooldownTime), <span class="number">0</span>, <span class="number">0</span>)) - <span class="number">1</span>;</span><br><span class="line">    zombieToOwner[id] = msg.sender;</span><br><span class="line">    ownerZombieCount[msg.sender]++;</span><br><span class="line">    NewZombie(id, _name, _dna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_generateRandomDna</span>(<span class="params">string _str</span>) <span class="title">private</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    uint rand = uint(keccak256(_str));</span><br><span class="line">    <span class="keyword">return</span> rand % dnaModulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createRandomZombie</span>(<span class="params">string _name</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(ownerZombieCount[msg.sender] == <span class="number">0</span>);</span><br><span class="line">    uint randDna = _generateRandomDna(_name);</span><br><span class="line">    randDna = randDna - randDna % <span class="number">100</span>;</span><br><span class="line">    _createZombie(_name, randDna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="SafeMath-ç¬¬äºŒéƒ¨åˆ†"><a href="#SafeMath-ç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="SafeMath ç¬¬äºŒéƒ¨åˆ†"></a>SafeMath ç¬¬äºŒéƒ¨åˆ†</h1><p>æ¥çœ‹çœ‹ SafeMath çš„éƒ¨åˆ†ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">library SafeMath &#123;</span><br><span class="line"></span><br><span class="line">  function mul(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    if (a == 0) &#123;</span><br><span class="line">      return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    uint256 c = a * b;</span><br><span class="line">    assert(c / a == b);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function div(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    // assert(b &gt; 0); // Solidity automatically throws when dividing by 0</span><br><span class="line">    uint256 c = a / b;</span><br><span class="line">    // assert(a == b * c + a % b); // There is no case in which this doesn&apos;t hold</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function sub(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    assert(b &lt;= a);</span><br><span class="line">    return a - b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    uint256 c = a + b;</span><br><span class="line">    assert(c &gt;= a);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬æœ‰äº† <code>library</code> å…³é”®å­— â€” åº“å’Œ <code>åˆçº¦</code>å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯åˆæœ‰ä¸€äº›ä¸åŒã€‚ å°±æˆ‘ä»¬çš„ç›®çš„è€Œè¨€ï¼Œåº“å…è®¸æˆ‘ä»¬ä½¿ç”¨ <code>using</code> å…³é”®å­—ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æŠŠåº“çš„æ‰€æœ‰æ–¹æ³•æ·»åŠ ç»™ä¸€ä¸ªæ•°æ®ç±»å‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">using SafeMath for uint;</span><br><span class="line">// è¿™ä¸‹æˆ‘ä»¬å¯ä»¥ä¸ºä»»ä½• uint è°ƒç”¨è¿™äº›æ–¹æ³•äº†</span><br><span class="line">uint test = 2;</span><br><span class="line">test = test.mul(3); // test ç­‰äº 6 äº†</span><br><span class="line">test = test.add(5); // test ç­‰äº 11 äº†</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ <code>mul</code> å’Œ <code>add</code> å…¶å®éƒ½éœ€è¦ä¸¤ä¸ªå‚æ•°ã€‚ åœ¨æˆ‘ä»¬å£°æ˜äº† <code>using SafeMath for uint</code> åï¼Œæˆ‘ä»¬ç”¨æ¥è°ƒç”¨è¿™äº›æ–¹æ³•çš„ <code>uint</code> å°±è‡ªåŠ¨è¢«ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»äº†(åœ¨æ­¤ä¾‹ä¸­å°±æ˜¯ <code>test</code>)</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ <code>add</code> çš„æºä»£ç çœ‹ SafeMath åšäº†ä»€ä¹ˆ:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">  uint256 c = a + b;</span><br><span class="line">  assert(c &gt;= a);</span><br><span class="line">  return c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬ä¸Š <code>add</code> åªæ˜¯åƒ <code>+</code> ä¸€æ ·å¯¹ä¸¤ä¸ª <code>uint</code> ç›¸åŠ ï¼Œ ä½†æ˜¯å®ƒç”¨ä¸€ä¸ª <code>assert</code> è¯­å¥æ¥ç¡®ä¿ç»“æœå¤§äº <code>a</code>ã€‚è¿™æ ·å°±é˜²æ­¢äº†æº¢å‡ºã€‚</p>
<p><code>assert</code> å’Œ <code>require</code> ç›¸ä¼¼ï¼Œè‹¥ç»“æœä¸ºå¦å®ƒå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ <code>assert</code> å’Œ <code>require</code> åŒºåˆ«åœ¨äºï¼Œ<code>require</code> è‹¥å¤±è´¥åˆ™ä¼šè¿”è¿˜ç»™ç”¨æˆ·å‰©ä¸‹çš„ gasï¼Œ <code>assert</code> åˆ™ä¸ä¼šã€‚æ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ å†™ä»£ç çš„æ—¶å€™ä¼šæ¯”è¾ƒå–œæ¬¢ <code>require</code>ï¼Œ<code>assert</code> åªåœ¨ä»£ç å¯èƒ½å‡ºç°ä¸¥é‡é”™è¯¯çš„æ—¶å€™ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>uint</code> æº¢å‡ºã€‚</p>
<p>æ‰€ä»¥ç®€è€Œè¨€ä¹‹ï¼Œ SafeMath çš„ <code>add</code>ï¼Œ <code>sub</code>ï¼Œ <code>mul</code>ï¼Œ å’Œ <code>div</code> æ–¹æ³•åªåšç®€å•çš„å››åˆ™è¿ç®—ï¼Œç„¶ååœ¨å‘ç”Ÿæº¢å‡ºæˆ–ä¸‹æº¢çš„æ—¶å€™æŠ›å‡ºé”™è¯¯ã€‚</p>
<h2 id="åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨-SafeMathã€‚"><a href="#åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨-SafeMathã€‚" class="headerlink" title="åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨ SafeMathã€‚"></a>åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨ SafeMathã€‚</h2><p>ä¸ºäº†é˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œæ‰¾ <code>+</code>ï¼Œ <code>-</code>ï¼Œ <code>*</code>ï¼Œ æˆ– <code>/</code>ï¼Œç„¶åæ›¿æ¢ä¸º <code>add</code>, <code>sub</code>, <code>mul</code>, <code>div</code>.</p>
<p>æ¯”å¦‚ï¼Œä¸å…¶è¿™æ ·åš:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myUint++;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿™æ ·åšï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myUint = myUint.add(1);</span><br></pre></td></tr></table></figure>

<h2 id="å®æˆ˜æ¼”ä¹ -9"><a href="#å®æˆ˜æ¼”ä¹ -9" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>åœ¨ <code>ZombieOwnership</code> ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹ç”¨åˆ°äº†æ•°å­¦è¿ç®—ï¼Œæ¥æ›¿æ¢æˆ SafeMath æ–¹æ³•æŠŠã€‚</p>
<ol>
<li>å°† <code>++</code> æ›¿æ¢æˆ SafeMath æ–¹æ³•ã€‚</li>
<li>å°† <code>--</code> æ›¿æ¢æˆ SafeMath æ–¹æ³•ã€‚</li>
</ol>
<h2 id="åˆçº¦ä¿®æ”¹-2"><a href="#åˆçº¦ä¿®æ”¹-2" class="headerlink" title="åˆçº¦ä¿®æ”¹"></a>åˆçº¦ä¿®æ”¹</h2><p>zombieownership.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombieattack.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./erc721.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./safemath.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath <span class="keyword">for</span> uint256;</span><br><span class="line"></span><br><span class="line">  mapping (<span class="function"><span class="params">uint</span> =&gt;</span> address) zombieApprovals;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">balanceOf</span>(<span class="params">address _owner</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint256 _balance</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ownerZombieCount[_owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ownerOf</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">address _owner</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> zombieToOwner[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_transfer</span>(<span class="params">address _from, address _to, uint256 _tokenId</span>) <span class="title">private</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. æ›¿æ¢æˆ SafeMath çš„ `add`</span></span><br><span class="line">    <span class="comment">//ownerZombieCount[_to]++;</span></span><br><span class="line">    ownerZombieCount[_to] = ownerZombieCount[_to].add(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 2. æ›¿æ¢æˆ SafeMath çš„ `sub`</span></span><br><span class="line">    <span class="comment">//ownerZombieCount[_from]--;</span></span><br><span class="line">    ownerZombieCount[_from] = ownerZombieCount[_from].sub(<span class="number">1</span>);</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> <span class="title">onlyOwnerOf</span>(<span class="params">_tokenId</span>) </span>&#123;</span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">approve</span>(<span class="params">address _to, uint256 _tokenId</span>) <span class="title">public</span> <span class="title">onlyOwnerOf</span>(<span class="params">_tokenId</span>) </span>&#123;</span><br><span class="line">    zombieApprovals[_tokenId] = _to;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">takeOwnership</span>(<span class="params">uint256 _tokenId</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(zombieApprovals[_tokenId] == msg.sender);</span><br><span class="line">    address owner = ownerOf(_tokenId);</span><br><span class="line">    _transfer(owner, msg.sender, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="SafeMath-ç¬¬ä¸‰éƒ¨åˆ†"><a href="#SafeMath-ç¬¬ä¸‰éƒ¨åˆ†" class="headerlink" title="SafeMath ç¬¬ä¸‰éƒ¨åˆ†"></a>SafeMath ç¬¬ä¸‰éƒ¨åˆ†</h1><p>å¤ªå¥½äº†ï¼Œè¿™ä¸‹æˆ‘ä»¬çš„ ERC721 å®ç°ä¸ä¼šæœ‰æº¢å‡ºæˆ–è€…ä¸‹æº¢äº†ã€‚</p>
<p>å›å¤´çœ‹çœ‹æˆ‘ä»¬åœ¨ä¹‹å‰è¯¾ç¨‹å†™çš„ä»£ç ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªåœ°æ–¹ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æº¢å‡ºæˆ–ä¸‹æº¢ã€‚</p>
<p>æ¯”å¦‚ï¼Œ åœ¨ ZombieAttack é‡Œé¢æˆ‘ä»¬æœ‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myZombie.winCount++;</span><br><span class="line">myZombie.level++;</span><br><span class="line">enemyZombie.lossCount++;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åŒæ ·åº”è¯¥åœ¨è¿™äº›åœ°æ–¹é˜²æ­¢æº¢å‡ºã€‚ï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼Œæ€»æ˜¯ä½¿ç”¨ SafeMath è€Œä¸æ˜¯æ™®é€šæ•°å­¦è¿ç®—æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä¹Ÿè®¸åœ¨ä»¥å Solidity çš„æ–°ç‰ˆæœ¬é‡Œè¿™ç‚¹ä¼šè¢«é»˜è®¤å®ç°ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¾—è‡ªå·±åœ¨ä»£ç é‡Œå®ç°è¿™äº›é¢å¤–çš„å®‰å…¨æªæ–½ï¼‰ã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬é‡åˆ°ä¸ªå°é—®é¢˜ â€” <code>winCount</code> å’Œ <code>lossCount</code> æ˜¯ <code>uint16</code>ï¼Œ è€Œ <code>level</code> æ˜¯ <code>uint32</code>ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç”¨è¿™äº›ä½œä¸ºå‚æ•°ä¼ å…¥ SafeMath çš„ <code>add</code> æ–¹æ³•ã€‚ å®ƒå®é™…ä¸Šå¹¶ä¸ä¼šé˜²æ­¢æº¢å‡ºï¼Œå› ä¸ºå®ƒä¼šæŠŠè¿™äº›å˜é‡éƒ½è½¬æ¢æˆ <code>uint256</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">uint256 a, uint256 b</span>) <span class="title">internal</span> <span class="title">pure</span> <span class="title">returns</span> (<span class="params">uint256</span>) </span>&#123;</span><br><span class="line">  uint256 c = a + b;</span><br><span class="line">  assert(c &gt;= a);</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœæˆ‘ä»¬åœ¨`uint8` ä¸Šè°ƒç”¨ `.add`ã€‚å®ƒå°†ä¼šè¢«è½¬æ¢æˆ `uint256`.</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥å®ƒä¸ä¼šåœ¨ 2^8 æ—¶æº¢å‡ºï¼Œå› ä¸º 256 æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ `uint256`.</span></span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬éœ€è¦å†å®ç°ä¸¤ä¸ªåº“æ¥é˜²æ­¢ <code>uint16</code> å’Œ <code>uint32</code> æº¢å‡ºæˆ–ä¸‹æº¢ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶å‘½åä¸º <code>SafeMath16</code> å’Œ <code>SafeMath32</code>ã€‚</p>
<p>ä»£ç å°†å’Œ SafeMath å®Œå…¨ç›¸åŒï¼Œé™¤äº†æ‰€æœ‰çš„ <code>uint256</code> å®ä¾‹éƒ½å°†è¢«æ›¿æ¢æˆ <code>uint32</code> æˆ– <code>uint16</code>ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å°†è¿™äº›ä»£ç å¸®ä½ å†™å¥½äº†ï¼Œæ‰“å¼€ <code>safemath.sol</code> åˆçº¦çœ‹çœ‹ä»£ç å§ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ ZombieFactory é‡Œä½¿ç”¨å®ƒä»¬ã€‚</p>
<h2 id="Putting-it-to-the-Test"><a href="#Putting-it-to-the-Test" class="headerlink" title="Putting it to the Test"></a>Putting it to the Test</h2><p>åˆ†é…ï¼š</p>
<ol>
<li>å£°æ˜æˆ‘ä»¬å°†ä¸º <code>uint32</code> ä½¿ç”¨<code>SafeMath32</code>ã€‚</li>
<li>å£°æ˜æˆ‘ä»¬å°†ä¸º <code>uint16</code> ä½¿ç”¨<code>SafeMath16</code>ã€‚</li>
<li>åœ¨ ZombieFactory é‡Œè¿˜æœ‰ä¸€å¤„æˆ‘ä»¬ä¹Ÿåº”è¯¥ä½¿ç”¨ SafeMath çš„æ–¹æ³•ï¼Œ æˆ‘ä»¬å·²ç»åœ¨é‚£é‡Œç•™äº†æ³¨é‡Šæé†’ä½ ã€‚</li>
</ol>
<h2 id="åˆçº¦ä¿®æ”¹-3"><a href="#åˆçº¦ä¿®æ”¹-3" class="headerlink" title="åˆçº¦ä¿®æ”¹"></a>åˆçº¦ä¿®æ”¹</h2><p>zombiefactory.sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./ownable.sol"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./safemath.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath <span class="keyword">for</span> uint256;</span><br><span class="line">  <span class="comment">// 1. ä¸º uint32 å£°æ˜ ä½¿ç”¨ SafeMath32</span></span><br><span class="line">  using SafeMath32 <span class="keyword">for</span> uint32;</span><br><span class="line">  <span class="comment">// 2. ä¸º uint16 å£°æ˜ ä½¿ç”¨ SafeMath16</span></span><br><span class="line">  using SafeMath16 <span class="keyword">for</span> uint16;</span><br><span class="line"></span><br><span class="line">  event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">  uint dnaDigits = <span class="number">16</span>;</span><br><span class="line">  uint dnaModulus = <span class="number">10</span> ** dnaDigits;</span><br><span class="line">  uint cooldownTime = <span class="number">1</span> days;</span><br><span class="line"></span><br><span class="line">  struct Zombie &#123;</span><br><span class="line">    string name;</span><br><span class="line">    uint dna;</span><br><span class="line">    uint32 level;</span><br><span class="line">    uint32 readyTime;</span><br><span class="line">    uint16 winCount;</span><br><span class="line">    uint16 lossCount;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">  mapping (<span class="function"><span class="params">uint</span> =&gt;</span> address) public zombieToOwner;</span><br><span class="line">  mapping (<span class="function"><span class="params">address</span> =&gt;</span> uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_createZombie</span>(<span class="params">string _name, uint _dna</span>) <span class="title">internal</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„: æˆ‘ä»¬é€‰æ‹©ä¸å¤„ç†2038å¹´é—®é¢˜ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒ readyTime çš„æº¢å‡º</span></span><br><span class="line">    <span class="comment">// åæ­£åœ¨2038å¹´æˆ‘ä»¬çš„APPæ—©å®Œè›‹äº†</span></span><br><span class="line">    uint id = zombies.push(Zombie(_name, _dna, <span class="number">1</span>, uint32(now + cooldownTime), <span class="number">0</span>, <span class="number">0</span>)) - <span class="number">1</span>;</span><br><span class="line">    zombieToOwner[id] = msg.sender;</span><br><span class="line">    <span class="comment">// 3. åœ¨è¿™é‡Œä½¿ç”¨ SafeMath çš„ `add` æ–¹æ³•:</span></span><br><span class="line">    <span class="comment">//ownerZombieCount[msg.sender]++;</span></span><br><span class="line">    ownerZombieCount[msg.sender] = ownerZombieCount[msg.sender].add(<span class="number">1</span>);</span><br><span class="line">    NewZombie(id, _name, _dna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">_generateRandomDna</span>(<span class="params">string _str</span>) <span class="title">private</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    uint rand = uint(keccak256(_str));</span><br><span class="line">    <span class="keyword">return</span> rand % dnaModulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">createRandomZombie</span>(<span class="params">string _name</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(ownerZombieCount[msg.sender] == <span class="number">0</span>);</span><br><span class="line">    uint randDna = _generateRandomDna(_name);</span><br><span class="line">    randDna = randDna - randDna % <span class="number">100</span>;</span><br><span class="line">    _createZombie(_name, randDna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="SafeMath-ç¬¬4éƒ¨åˆ†"><a href="#SafeMath-ç¬¬4éƒ¨åˆ†" class="headerlink" title="SafeMath ç¬¬4éƒ¨åˆ†"></a>SafeMath ç¬¬4éƒ¨åˆ†</h1><p>çœŸæ£’ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„ DApp é‡Œé¢ç”¨åˆ°çš„ <code>uint</code> æ•°æ®ç±»å‹éƒ½å®ç°äº† SafeMath äº†ã€‚</p>
<p>è®©æˆ‘ä»¬æŠŠ <code>ZombieAttack</code> é‡Œæ‰€æœ‰æ½œåœ¨çš„é—®é¢˜éƒ½ä¿®å¤äº†å§ã€‚ ï¼ˆå…¶å®åœ¨ <code>ZombieHelper</code> é‡Œä¹Ÿæœ‰ä¸€å¤„ <code>zombies[_zombieId].level++;</code> éœ€è¦ä¿®å¤ï¼Œä¸è¿‡æˆ‘ä»¬å·²ç»å¸®ä½ åšå¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†æ¥ä¸€ç« äº† ğŸ˜‰ï¼‰ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -10"><a href="#å®æˆ˜æ¼”ä¹ -10" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æ”¾å¿ƒå¤§èƒ†å»å¯¹ <code>ZombieAttack</code> é‡Œæ‰€æœ‰çš„ <code>++</code> æ“ä½œéƒ½ä½¿ç”¨ SafeMath æ–¹æ³•å§ã€‚ä¸ºäº†æ–¹ä¾¿ä½ æ‰¾ï¼Œæˆ‘ä»¬å·²ç»åœ¨ç›¸åº”çš„åœ°æ–¹ç•™äº†æ³¨é‡Šç»™ä½ ã€‚</p>
<h2 id="åˆçº¦ä¿®æ”¹-4"><a href="#åˆçº¦ä¿®æ”¹-4" class="headerlink" title="åˆçº¦ä¿®æ”¹"></a>åˆçº¦ä¿®æ”¹</h2><p>ZombieAttack .sol</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./zombiehelper.sol"</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper &#123;</span><br><span class="line">  uint randNonce = <span class="number">0</span>;</span><br><span class="line">  uint attackVictoryProbability = <span class="number">70</span>;</span><br><span class="line">  <span class="comment">//using SafeMath for uint256;</span></span><br><span class="line">  <span class="comment">//using SafeMath32 for uint32;</span></span><br><span class="line">  <span class="comment">//using SafeMath16 for uint16;</span></span><br><span class="line">  <span class="comment">//ZombieBattleçš„çˆ¶ç±»æ˜¯ZombieHelperï¼ŒZombieHelperçš„çˆ¶ç±»æ˜¯ZombieFeedingï¼ŒZombieFeedingçš„çˆ¶ç±»æ˜¯ZombieFactoryã€‚åœ¨ZombieFactoryä¸­å¼•ç”¨è¿‡SafeMarhã€SafeMarh32ã€SafeMarh16ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¸éœ€è¦é‡å¤å¼•ç”¨ã€‚</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">randMod</span>(<span class="params">uint _modulus</span>) <span class="title">internal</span> <span class="title">returns</span>(<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™å„¿æœ‰ä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">//randNonce++;</span></span><br><span class="line">    randNonce = randNonce.add(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">attack</span>(<span class="params">uint _zombieId, uint _targetId</span>) <span class="title">external</span> <span class="title">onlyOwnerOf</span>(<span class="params">_zombieId</span>) </span>&#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">if</span> (rand &lt;= attackVictoryProbability) &#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œæœ‰ä¸‰ä¸ª</span></span><br><span class="line">      <span class="comment">//myZombie.winCount++;</span></span><br><span class="line">      myZombie.winCount = myZombie.winCount.add(<span class="number">1</span>);</span><br><span class="line">      <span class="comment">//myZombie.level++;</span></span><br><span class="line">      myZombie.level = myZombie.level.add(<span class="number">1</span>);</span><br><span class="line">      <span class="comment">//enemyZombie.lossCount++;</span></span><br><span class="line">      enemyZombie.lossCount = enemyZombie.lossCount.add(<span class="number">1</span>);</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, <span class="string">"zombie"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// è¿™å„¿è¿˜æœ‰ä¿©å“¦</span></span><br><span class="line">      <span class="comment">//myZombie.lossCount++;</span></span><br><span class="line">      myZombie.lossCount = myZombie.lossCount.add(<span class="number">1</span>);</span><br><span class="line">      <span class="comment">//enemyZombie.winCount++;</span></span><br><span class="line">      enemyZombie.winCount = enemyZombie.winCount.add(<span class="number">1</span>);</span><br><span class="line">      _triggerCooldown(myZombie);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h1><p>åƒµå°¸æ¸¸æˆçš„ Solidity ä»£ç ç»ˆäºå®Œæˆå•¦ã€‚</p>
<p>åœ¨ä»¥åçš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†æ¸¸æˆéƒ¨ç½²åˆ°ä»¥å¤ªåŠï¼Œä»¥åŠå¦‚ä½•å’Œ Web3.js äº¤äº’ã€‚</p>
<p>ä¸è¿‡åœ¨ä½ ç¦»å¼€ç¬¬äº”è¯¾ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆå¦‚ä½• <strong>ç»™ä½ çš„ä»£ç æ·»åŠ æ³¨é‡Š</strong>.</p>
<h2 id="æ³¨é‡Šè¯­æ³•"><a href="#æ³¨é‡Šè¯­æ³•" class="headerlink" title="æ³¨é‡Šè¯­æ³•"></a>æ³¨é‡Šè¯­æ³•</h2><p>Solidity é‡Œçš„æ³¨é‡Šå’Œ JavaScript ç›¸åŒã€‚åœ¨æˆ‘ä»¬çš„è¯¾ç¨‹ä¸­ä½ å·²ç»çœ‹åˆ°äº†ä¸å°‘å•è¡Œæ³¨é‡Šäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Šï¼Œå¯ä»¥ç†è§£ä¸ºç»™è‡ªå·±æˆ–è€…åˆ«äººçœ‹çš„ç¬”è®°</span><br></pre></td></tr></table></figure>

<p>åªè¦åœ¨ä»»ä½•åœ°æ–¹æ·»åŠ ä¸€ä¸ª <code>//</code> å°±æ„å‘³ç€ä½ åœ¨æ³¨é‡Šã€‚å¦‚æ­¤ç®€å•æ‰€ä»¥ä½ åº”è¯¥ç»å¸¸è¿™ä¹ˆåšã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬ä¹ŸçŸ¥é“ä½ çš„æƒ³æ³•ï¼šæœ‰æ—¶å€™å•è¡Œæ³¨é‡Šæ˜¯ä¸å¤Ÿçš„ã€‚æ¯•ç«Ÿä½ ç”Ÿæ¥è¯ç—¨ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æœ‰äº†å¤šè¡Œæ³¨é‡Šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">contract CryptoZombies &#123; </span><br><span class="line">  /* è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šã€‚æˆ‘æƒ³å¯¹æ‰€æœ‰èŠ±æ—¶é—´æ¥å°è¯•è¿™ä¸ªç¼–ç¨‹è¯¾ç¨‹çš„äººè¯´å£°è°¢è°¢ã€‚</span><br><span class="line">  å®ƒæ˜¯å…è´¹çš„ï¼Œå¹¶å°†æ°¸è¿œå…è´¹ã€‚ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å€¾æ³¨äº†æˆ‘ä»¬çš„å¿ƒè¡€æ¥è®©å®ƒå˜å¾—æ›´å¥½ã€‚</span><br><span class="line"></span><br><span class="line">   è¦çŸ¥é“è¿™ä¾ç„¶åªæ˜¯åŒºå—é“¾å¼€å‘çš„å¼€å§‹è€Œå·²ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»èµ°äº†å¾ˆè¿œï¼Œ</span><br><span class="line">   ä»ç„¶æœ‰å¾ˆå¤šç§æ–¹å¼æ¥è®©æˆ‘ä»¬çš„ç¤¾åŒºå˜å¾—æ›´å¥½ã€‚</span><br><span class="line">   å¦‚æœæˆ‘ä»¬åœ¨å“ªä¸ªåœ°æ–¹å‡ºäº†é”™ï¼Œæ¬¢è¿åœ¨æˆ‘ä»¬çš„ github æäº¤ PR æˆ–è€… issue æ¥å¸®åŠ©æˆ‘ä»¬æ”¹è¿›ï¼š</span><br><span class="line">    https://github.com/loomnetwork/cryptozombie-lessons</span><br><span class="line"></span><br><span class="line">    æˆ–è€…ï¼Œå¦‚æœä½ æœ‰ä»»ä½•çš„æƒ³æ³•ã€å»ºè®®ç”šè‡³ä»…ä»…æƒ³å’Œæˆ‘ä»¬æ‰“å£°æ‹›å‘¼ï¼Œæ¬¢è¿æ¥æˆ‘ä»¬çš„ç”µæŠ¥ç¾¤ï¼š</span><br><span class="line">     https://t.me/loomnetworkcn</span><br><span class="line">  */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç‰¹åˆ«æ˜¯ï¼Œæœ€å¥½ä¸ºä½ åˆçº¦ä¸­æ¯ä¸ªæ–¹æ³•æ·»åŠ æ³¨é‡Šæ¥è§£é‡Šå®ƒçš„é¢„æœŸè¡Œä¸ºã€‚è¿™æ ·å…¶ä»–å¼€å‘è€…ï¼ˆæˆ–è€…ä½ è‡ªå·±ï¼Œåœ¨6ä¸ªæœˆä»¥åå†å›åˆ°è¿™ä¸ªé¡¹ç›®ä¸­ï¼‰å¯ä»¥å¾ˆå¿«åœ°ç†è§£ä½ çš„ä»£ç è€Œä¸éœ€è¦é€è¡Œé˜…è¯»æ‰€æœ‰ä»£ç ã€‚</p>
<p>Solidity ç¤¾åŒºæ‰€ä½¿ç”¨çš„ä¸€ä¸ªæ ‡å‡†æ˜¯ä½¿ç”¨ä¸€ç§è¢«ç§°ä½œ <strong><em>natspec\</em></strong> çš„æ ¼å¼ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/// @title ä¸€ä¸ªç®€å•çš„åŸºç¡€è¿ç®—åˆçº¦</span><br><span class="line">/// @author H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</span><br><span class="line">/// @notice ç°åœ¨ï¼Œè¿™ä¸ªåˆçº¦åªæ·»åŠ ä¸€ä¸ªä¹˜æ³•</span><br><span class="line">contract Math &#123;</span><br><span class="line">  /// @notice ä¸¤ä¸ªæ•°ç›¸ä¹˜</span><br><span class="line">  /// @param x ç¬¬ä¸€ä¸ª uint</span><br><span class="line">  /// @param y  ç¬¬äºŒä¸ª uint</span><br><span class="line">  /// @return z  (x * y) çš„ç»“æœ</span><br><span class="line">  /// @dev ç°åœ¨è¿™ä¸ªæ–¹æ³•ä¸æ£€æŸ¥æº¢å‡º</span><br><span class="line">  function multiply(uint x, uint y) returns (uint z) &#123;</span><br><span class="line">    // è¿™åªæ˜¯ä¸ªæ™®é€šçš„æ³¨é‡Šï¼Œä¸ä¼šè¢« natspec è§£é‡Š</span><br><span class="line">    z = x * y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@title</code>ï¼ˆæ ‡é¢˜ï¼‰ å’Œ <code>@author</code> ï¼ˆä½œè€…ï¼‰å¾ˆç›´æ¥äº†.</p>
<p><code>@notice</code> ï¼ˆé¡»çŸ¥ï¼‰å‘ <strong>ç”¨æˆ·</strong> è§£é‡Šè¿™ä¸ªæ–¹æ³•æˆ–è€…åˆçº¦æ˜¯åšä»€ä¹ˆçš„ã€‚ <code>@dev</code> ï¼ˆå¼€å‘è€…ï¼‰ æ˜¯å‘å¼€å‘è€…è§£é‡Šæ›´å¤šçš„ç»†èŠ‚ã€‚</p>
<p><code>@param</code> ï¼ˆå‚æ•°ï¼‰å’Œ <code>@return</code> ï¼ˆè¿”å›ï¼‰ ç”¨æ¥æè¿°è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä»€ä¹ˆå‚æ•°ä»¥åŠè¿”å›ä»€ä¹ˆå€¼ã€‚</p>
<p>æ³¨æ„ä½ å¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½ç”¨ä¸Šæ‰€æœ‰çš„æ ‡ç­¾ï¼Œå®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚ä¸è¿‡æœ€å°‘ï¼Œå†™ä¸‹ä¸€ä¸ª <code>@dev</code> æ³¨é‡Šæ¥è§£é‡Šæ¯ä¸ªæ–¹æ³•æ˜¯åšä»€ä¹ˆçš„ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -11"><a href="#å®æˆ˜æ¼”ä¹ -11" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>å¦‚æœä½ è¿˜æ²¡æ³¨æ„åˆ°ï¼šCryptoZombies çš„ç­”æ¡ˆæ£€æŸ¥å™¨åœ¨å·¥ä½œçš„æ—¶å€™å°†å¿½ç•¥æ‰€æœ‰çš„æ³¨é‡Šã€‚æ‰€ä»¥è¿™ä¸€ç« æˆ‘ä»¬å…¶å®æ— æ³•æ£€æŸ¥ä½ çš„ natspec æ³¨é‡Šäº†ã€‚å…¨é ä½ è‡ªå·±å’¯ã€‚</p>
<p>è¯è¯´å›æ¥ï¼Œåˆ°ç°åœ¨ä½ åº”è¯¥å·²ç»æ˜¯ä¸€ä¸ª Solidity å°èƒ½æ‰‹äº†ã€‚æˆ‘ä»¬å°±å‡å®šä½ å·²ç»å­¦ä¼šè¿™äº›äº†ã€‚</p>
<p>å¤§èƒ†å»åšäº›å°è¯•æŠŠï¼Œç»™ <code>ZombieOwnership</code> åŠ ä¸Šä¸€äº› natspec æ ‡ç­¾:</p>
<ol>
<li><code>@title</code> â€” ä¾‹å¦‚ï¼šä¸€ä¸ªç®¡ç†è½¬ç§»åƒµå°¸æ‰€æœ‰æƒçš„åˆçº¦</li>
<li><code>@author</code> â€” ä½ çš„åå­—</li>
<li><code>@dev</code> â€” ä¾‹å¦‚ï¼šç¬¦åˆ OpenZeppelin å¯¹ ERC721 æ ‡å‡†è‰æ¡ˆçš„å®ç°</li>
</ol>
<h1 id="æ”¾åœ¨ä¸€èµ·"><a href="#æ”¾åœ¨ä¸€èµ·" class="headerlink" title="æ”¾åœ¨ä¸€èµ·"></a>æ”¾åœ¨ä¸€èµ·</h1><p>æ­å–œä½ ï¼è¿™äº›å°±æ˜¯ç¬¬äº”è¯¾çš„å…¨éƒ¨å•¦ã€‚</p>
<p>ä½œä¸ºå¥–èµï¼Œæˆ‘ä»¬é€ç»™ä½ äº†ä¸€ä¸ª10çº§åƒµå°¸ï¼š<strong>H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</strong> ï¼</p>
<p>ï¼ˆå¤©å•Šï¼Œä¼ å¥‡çš„<strong>H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</strong> åƒµå°¸ï¼ï¼‰</p>
<p>è¿™ä¸‹ä½ çš„åƒµå°¸å¤§å†›æœ‰4ä¸ªåƒµå°¸å•¦ã€‚</p>
<p>åœ¨ä½ ç»§ç»­å‰ï¼Œä½ å¯ä»¥ç‚¹å‡»æ¯ä¸ªåƒµå°¸æ¥ç»™å®ƒä»¬èµ·ä¸€ä¸ªæ–°åå­—ï¼Œ ï¼ˆæ³¨ï¼š <strong>H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</strong> è¿™ä¸ªæ¢—æ¥è‡ªäºä¸€ä¸ªåœ¨2000å¹´å·¦å³æµè¡Œçš„å¤è€æ¸¸æˆï¼Œæˆ‘ä»¬çš„å¼€å‘è€…è§‰å¾—å®ƒå¾ˆé…·ï¼Œä½ ä¹Ÿå¯ä»¥ç»™å®ƒèµ·ä¸€ä¸ªä½ è§‰å¾—å¾ˆé…·çš„åå­—ï¼Œæ¯”å¦‚â€œéš”å£è€ç‹â€æˆ–è€…â€œç»¿å¸½åƒµå°¸â€ğŸ˜ï¼‰ã€‚</p>
<h2 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a>æ€»ç»“ä¸€ä¸‹</h2><p>è¿™èŠ‚è¯¾é‡Œé¢æˆ‘ä»¬å­¦åˆ°äº†</p>
<ul>
<li>ä»£å¸, ERC721 æ ‡å‡†ï¼Œä»¥åŠå¯äº¤æ˜“çš„ç‰©ä»¶/åƒµå°¸</li>
<li>åº“ä»¥åŠå¦‚ä½•ä½¿ç”¨åº“</li>
<li>å¦‚ä½•åˆ©ç”¨ SafeMath æ¥é˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢</li>
<li>ä»£ç æ³¨é‡Šå’Œ natspec æ ‡å‡†</li>
</ul>
<p>è¿™èŠ‚æ•™ç¨‹å®Œæˆäº†æˆ‘ä»¬æ¸¸æˆçš„ Solidity ä»£ç ï¼ˆä»…é’ˆå¯¹å½“ä¸‹æ¥è¯´ï¼Œæœªæ¥çš„è¯¾ç¨‹æˆ‘ä»¬ä¹Ÿè®¸ä¼šåŠ å…¥æ›´å¤šè¿›å»ï¼‰ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„ä¸¤èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†æ¸¸æˆéƒ¨ç½²åˆ°ä»¥å¤ªåŠä»¥åŠå’Œ <strong><em>web3.js\</em></strong> äº¤äº’ ï¼ˆè¿™æ ·ä½ å°±èƒ½ä¸ºä½ çš„ DApp æ‰“é€ ä¸€ä¸ªç•Œé¢äº† ï¼‰ã€‚</p>
<p>ç»§ç»­ç©å„¿æˆ–è€…é‡å‘½åä½ çš„åƒµå°¸ï¼Œç„¶åå°±å¯ä»¥ç‚¹å‡»ä¸‹ä¸€ç« æ¥ç»“æŸæœ¬èŠ‚æ•™ç¨‹äº†ã€‚</p>
<p><img src="https://i.loli.net/2020/06/29/OwCBJ4kfo8W9RpM.png" alt="image-20200629232202703"></p>
<h1 id="ç¬¬äº”è¯¾æ‰“å¡"><a href="#ç¬¬äº”è¯¾æ‰“å¡" class="headerlink" title="ç¬¬äº”è¯¾æ‰“å¡"></a>ç¬¬äº”è¯¾æ‰“å¡</h1><p><img src="https://i.loli.net/2020/06/29/Rt1SieE7unND4zc.png" alt="image-20200629233354077"></p>
<p><a href="https://share.cryptozombies.io/zh/lesson/5/share/H4XF13LD_MORRIS_%F0%9F%92%AF%F0%9F%92%AF%F0%9F%98%8E%F0%9F%92%AF%F0%9F%92%AF" target="_blank" rel="noopener">æˆ‘çš„åƒµå°¸å¤§å†›5</a></p>

    </div>

    
    
    
      
        <div class="reward-container">
  <div>æ‚¨çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="ææ¾æŸ å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="ææ¾æŸ æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>ææ¾æŸ
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://lisongbai.top/2020/06/29/ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81/" title="ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“">http://lisongbai.top/2020/06/29/ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/solidity/" rel="tag"># solidity</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2020/06/27/%E5%83%B5%E5%B0%B8%E4%BD%9C%E6%88%98%E7%B3%BB%E7%BB%9F/" rel="next" title="åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ">
                  <i class="fa fa-chevron-left"></i> åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2020/06/30/web3-js/" rel="prev" title="web3.js">
                  web3.js <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-livere">livere</a></li>
            <li class="tab"><a href="#comment-disqus">disqus</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane livere" id="comment-livere">
              
  <div class="comments" id="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC80NzY2MC8yNDE1OA=="></div>
  </div>
  
            </div>
            <div class="tab-pane disqus" id="comment-disqus">
              
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  
            </div>
        </div>
      </div>
      <script>
        window.addEventListener('tabs:register', () => {
          let activeClass = '';
            activeClass = localStorage.getItem('comments_active') || activeClass;
          if (activeClass) {
            let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
            if (activeTab) {
              activeTab.click();
            }
          }
        });
        window.addEventListener('tabs:click', event => {
          let commentClass = event.target.classList[1];
          localStorage.setItem('comments_active', commentClass);
        });
      </script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ä»¥å¤ªåŠä¸Šçš„ä»£å¸"><span class="nav-number">1.</span> <span class="nav-text">ä»¥å¤ªåŠä¸Šçš„ä»£å¸</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ"><span class="nav-number">1.1.</span> <span class="nav-text">å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å…¶ä»–ä»£å¸æ ‡å‡†"><span class="nav-number">1.2.</span> <span class="nav-text">å…¶ä»–ä»£å¸æ ‡å‡†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ "><span class="nav-number">1.3.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦åˆ›å»º"><span class="nav-number">1.4.</span> <span class="nav-text">åˆçº¦åˆ›å»º</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿"><span class="nav-number">2.</span> <span class="nav-text">ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®ç°ä¸€ä¸ªä»£å¸åˆçº¦"><span class="nav-number">2.1.</span> <span class="nav-text">å®ç°ä¸€ä¸ªä»£å¸åˆçº¦</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -1"><span class="nav-number">2.2.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦å®Œå–„"><span class="nav-number">2.3.</span> <span class="nav-text">åˆçº¦å®Œå–„</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#balanceOf-å’Œ-ownerOf"><span class="nav-number">3.</span> <span class="nav-text">balanceOf å’Œ ownerOf</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#balanceOf"><span class="nav-number">3.1.</span> <span class="nav-text">balanceOf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ownerOf"><span class="nav-number">3.2.</span> <span class="nav-text">ownerOf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -2"><span class="nav-number">3.3.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦å®Œå–„-1"><span class="nav-number">3.4.</span> <span class="nav-text">åˆçº¦å®Œå–„</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#é‡æ„"><span class="nav-number">4.</span> <span class="nav-text">é‡æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -3"><span class="nav-number">4.1.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦ä¿®æ”¹"><span class="nav-number">4.2.</span> <span class="nav-text">åˆçº¦ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ERC721-è½¬ç§»æ ‡å‡†"><span class="nav-number">5.</span> <span class="nav-text">ERC721: è½¬ç§»æ ‡å‡†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -4"><span class="nav-number">5.1.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦å®Œå–„-2"><span class="nav-number">5.2.</span> <span class="nav-text">åˆçº¦å®Œå–„</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ERC721-è½¬ç§»-ç»­"><span class="nav-number">6.</span> <span class="nav-text">ERC721: è½¬ç§»-ç»­</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -5"><span class="nav-number">6.1.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦å®Œå–„-3"><span class="nav-number">6.2.</span> <span class="nav-text">åˆçº¦å®Œå–„</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ERC721-æ‰¹å‡†"><span class="nav-number">7.</span> <span class="nav-text">ERC721: æ‰¹å‡†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -6"><span class="nav-number">7.1.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦å®Œå–„-4"><span class="nav-number">7.2.</span> <span class="nav-text">åˆçº¦å®Œå–„</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ERC721-takeOwnership"><span class="nav-number">8.</span> <span class="nav-text">ERC721: takeOwnership</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -7"><span class="nav-number">8.1.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦å®Œå–„-5"><span class="nav-number">8.2.</span> <span class="nav-text">åˆçº¦å®Œå–„</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#é¢„é˜²æº¢å‡º"><span class="nav-number">9.</span> <span class="nav-text">é¢„é˜²æº¢å‡º</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦å®‰å…¨å¢å¼º-æº¢å‡ºå’Œä¸‹æº¢"><span class="nav-number">9.1.</span> <span class="nav-text">åˆçº¦å®‰å…¨å¢å¼º: æº¢å‡ºå’Œä¸‹æº¢</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨-SafeMath"><span class="nav-number">9.2.</span> <span class="nav-text">ä½¿ç”¨ SafeMath</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -8"><span class="nav-number">9.3.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦ä¿®æ”¹-1"><span class="nav-number">9.4.</span> <span class="nav-text">åˆçº¦ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SafeMath-ç¬¬äºŒéƒ¨åˆ†"><span class="nav-number">10.</span> <span class="nav-text">SafeMath ç¬¬äºŒéƒ¨åˆ†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨-SafeMathã€‚"><span class="nav-number">10.1.</span> <span class="nav-text">åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨ SafeMathã€‚</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -9"><span class="nav-number">10.2.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦ä¿®æ”¹-2"><span class="nav-number">10.3.</span> <span class="nav-text">åˆçº¦ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SafeMath-ç¬¬ä¸‰éƒ¨åˆ†"><span class="nav-number">11.</span> <span class="nav-text">SafeMath ç¬¬ä¸‰éƒ¨åˆ†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Putting-it-to-the-Test"><span class="nav-number">11.1.</span> <span class="nav-text">Putting it to the Test</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦ä¿®æ”¹-3"><span class="nav-number">11.2.</span> <span class="nav-text">åˆçº¦ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SafeMath-ç¬¬4éƒ¨åˆ†"><span class="nav-number">12.</span> <span class="nav-text">SafeMath ç¬¬4éƒ¨åˆ†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -10"><span class="nav-number">12.1.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦ä¿®æ”¹-4"><span class="nav-number">12.2.</span> <span class="nav-text">åˆçº¦ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ³¨é‡Š"><span class="nav-number">13.</span> <span class="nav-text">æ³¨é‡Š</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ³¨é‡Šè¯­æ³•"><span class="nav-number">13.1.</span> <span class="nav-text">æ³¨é‡Šè¯­æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -11"><span class="nav-number">13.2.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ”¾åœ¨ä¸€èµ·"><span class="nav-number">14.</span> <span class="nav-text">æ”¾åœ¨ä¸€èµ·</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“ä¸€ä¸‹"><span class="nav-number">14.1.</span> <span class="nav-text">æ€»ç»“ä¸€ä¸‹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬äº”è¯¾æ‰“å¡"><span class="nav-number">15.</span> <span class="nav-text">ç¬¬äº”è¯¾æ‰“å¡</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="ææ¾æŸ"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">ææ¾æŸ</p>
  <div class="site-description" itemprop="description">è®°å½•å­¦ä¹ çš„æŠ€èƒ½å’Œé‡åˆ°çš„é—®é¢˜</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yym08090809" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;yym08090809" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:songbai0112@163.com" title="E-Mail &amp;rarr; mailto:songbai0112@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 â€“ 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ¾æŸ</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.2
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>






  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': '',
            'X-LC-Key': '',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>






        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

<script>
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://visitor.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "http://lisongbai.top/2020/06/29/ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81/",
            identifier: "2020/06/29/ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“/",
            title: "ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://visitor.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    window.addEventListener('load', loadComments, false);
</script>

 
</body>
</html>
