<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'å¤åˆ¶',
      copy_success: 'å¤åˆ¶æˆåŠŸ',
      copy_failure: 'å¤åˆ¶å¤±è´¥'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="ä»‹ç» Web3.jså®Œæˆç¬¬äº”è¯¾ä»¥åï¼Œæˆ‘ä»¬çš„åƒµå°¸ DApp çš„ Solidity åˆçº¦éƒ¨åˆ†å°±å®Œæˆäº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥åšä¸€ä¸ªåŸºæœ¬çš„ç½‘é¡µå¥½è®©ä½ çš„ç”¨æˆ·èƒ½ç©å®ƒã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥å¤ªåŠåŸºé‡‘å‘å¸ƒçš„ JavaScript åº“ â€”â€” Web3.js\.ä»€ä¹ˆæ˜¯ Web3.js?è¿˜è®°å¾—ä¹ˆï¼Ÿä»¥å¤ªåŠç½‘ç»œæ˜¯ç”±èŠ‚ç‚¹ç»„æˆçš„ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†åŒºå—é“¾çš„ä¸€ä»½æ‹·è´ã€‚å½“ä½ æƒ³è¦è°ƒç”¨ä¸€ä»½æ™ºèƒ½åˆçº¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½ éœ€è¦ä»å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸­æŸ¥æ‰¾å¹¶å‘Š">
<meta name="keywords" content="web3.js">
<meta property="og:type" content="article">
<meta property="og:title" content="web3.js">
<meta property="og:url" content="http:&#x2F;&#x2F;lisongbai.top&#x2F;2020&#x2F;06&#x2F;30&#x2F;web3-js&#x2F;index.html">
<meta property="og:site_name" content="å°æã®åšå®¢">
<meta property="og:description" content="ä»‹ç» Web3.jså®Œæˆç¬¬äº”è¯¾ä»¥åï¼Œæˆ‘ä»¬çš„åƒµå°¸ DApp çš„ Solidity åˆçº¦éƒ¨åˆ†å°±å®Œæˆäº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥åšä¸€ä¸ªåŸºæœ¬çš„ç½‘é¡µå¥½è®©ä½ çš„ç”¨æˆ·èƒ½ç©å®ƒã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥å¤ªåŠåŸºé‡‘å‘å¸ƒçš„ JavaScript åº“ â€”â€” Web3.js\.ä»€ä¹ˆæ˜¯ Web3.js?è¿˜è®°å¾—ä¹ˆï¼Ÿä»¥å¤ªåŠç½‘ç»œæ˜¯ç”±èŠ‚ç‚¹ç»„æˆçš„ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†åŒºå—é“¾çš„ä¸€ä»½æ‹·è´ã€‚å½“ä½ æƒ³è¦è°ƒç”¨ä¸€ä»½æ™ºèƒ½åˆçº¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½ éœ€è¦ä»å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸­æŸ¥æ‰¾å¹¶å‘Š">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;30&#x2F;HMZXOmk7bAvPoIS.png">
<meta property="og:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;30&#x2F;k35KTEDdXcHyVzM.png">
<meta property="og:updated_time" content="2020-06-30T06:44:35.723Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;06&#x2F;30&#x2F;HMZXOmk7bAvPoIS.png">

<link rel="canonical" href="http://lisongbai.top/2020/06/30/web3-js/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>web3.js | å°æã®åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="å°æã®åšå®¢" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å°æã®åšå®¢</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">æˆ‘æœ‰ä¸€å£¶é…’ï¼Œè¶³ä»¥æ…°å¹³ç”Ÿã€‚</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="æœç´¢..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/yym08090809" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://lisongbai.top/2020/06/30/web3-js/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ææ¾æŸ">
      <meta itemprop="description" content="è®°å½•å­¦ä¹ çš„æŠ€èƒ½å’Œé‡åˆ°çš„é—®é¢˜">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°æã®åšå®¢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          web3.js
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-06-30 00:03:22 / ä¿®æ”¹æ—¶é—´ï¼š14:44:35" itemprop="dateCreated datePublished" datetime="2020-06-30T00:03:22+08:00">2020-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Solidity-Path/" itemprop="url" rel="index">
                    <span itemprop="name">Solidity Path</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020/06/30/web3-js/" class="post-meta-item leancloud_visitors" data-flag-title="web3.js" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2020/06/30/web3-js/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/06/30/web3-js/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="ä»‹ç»-Web3-js"><a href="#ä»‹ç»-Web3-js" class="headerlink" title="ä»‹ç» Web3.js"></a>ä»‹ç» Web3.js</h1><p>å®Œæˆç¬¬äº”è¯¾ä»¥åï¼Œæˆ‘ä»¬çš„åƒµå°¸ DApp çš„ Solidity åˆçº¦éƒ¨åˆ†å°±å®Œæˆäº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥åšä¸€ä¸ªåŸºæœ¬çš„ç½‘é¡µå¥½è®©ä½ çš„ç”¨æˆ·èƒ½ç©å®ƒã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥å¤ªåŠåŸºé‡‘å‘å¸ƒçš„ JavaScript åº“ â€”â€” <strong><em>Web3.js\</em></strong>.</p><h2 id="ä»€ä¹ˆæ˜¯-Web3-js"><a href="#ä»€ä¹ˆæ˜¯-Web3-js" class="headerlink" title="ä»€ä¹ˆæ˜¯ Web3.js?"></a>ä»€ä¹ˆæ˜¯ Web3.js?</h2><p>è¿˜è®°å¾—ä¹ˆï¼Ÿä»¥å¤ªåŠç½‘ç»œæ˜¯ç”±èŠ‚ç‚¹ç»„æˆçš„ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†åŒºå—é“¾çš„ä¸€ä»½æ‹·è´ã€‚å½“ä½ æƒ³è¦è°ƒç”¨ä¸€ä»½æ™ºèƒ½åˆçº¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½ éœ€è¦ä»å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸­æŸ¥æ‰¾å¹¶å‘Šè¯‰å®ƒ:</p><a id="more"></a>

<ol>
<li>æ™ºèƒ½åˆçº¦çš„åœ°å€</li>
<li>ä½ æƒ³è°ƒç”¨çš„æ–¹æ³•ï¼Œä»¥åŠ</li>
<li>ä½ æƒ³ä¼ å…¥é‚£ä¸ªæ–¹æ³•çš„å‚æ•°</li>
</ol>
<p>ä»¥å¤ªåŠèŠ‚ç‚¹åªèƒ½è¯†åˆ«ä¸€ç§å«åš <strong><em>JSON-RPC\</em></strong> çš„è¯­è¨€ã€‚è¿™ç§è¯­è¨€ç›´æ¥è¯»èµ·æ¥å¹¶ä¸å¥½æ‡‚ã€‚å½“ä½ ä½ æƒ³è°ƒç”¨ä¸€ä¸ªåˆçº¦çš„æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦å‘é€çš„æŸ¥è¯¢è¯­å¥å°†ä¼šæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// å“ˆâ€¦â€¦ç¥ä½ å†™æ‰€æœ‰è¿™æ ·çš„å‡½æ•°è°ƒç”¨çš„æ—¶å€™éƒ½ä¸€æ¬¡é€šè¿‡</span><br><span class="line">// å¾€å³è¾¹æ‹‰â€¦â€¦ ==&gt;</span><br><span class="line">&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_sendTransaction&quot;,&quot;params&quot;:[&#123;&quot;from&quot;:&quot;0xb60e8dd61c5d32be8058bb8eb970870f07233155&quot;,&quot;to&quot;:&quot;0xd46e8dd67c5d32be8058bb8eb970870f07244567&quot;,&quot;gas&quot;:&quot;0x76c0&quot;,&quot;gasPrice&quot;:&quot;0x9184e72a000&quot;,&quot;value&quot;:&quot;0x9184e72a&quot;,&quot;data&quot;:&quot;0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675&quot;&#125;],&quot;id&quot;:1&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¸è¿çš„æ˜¯ Web3.js æŠŠè¿™äº›ä»¤äººè®¨åŒçš„æŸ¥è¯¢è¯­å¥éƒ½éšè—èµ·æ¥äº†ï¼Œ æ‰€ä»¥ä½ åªéœ€è¦ä¸æ–¹ä¾¿æ˜“æ‡‚çš„ JavaScript ç•Œé¢è¿›è¡Œäº¤äº’å³å¯ã€‚</p>
<p>ä½ ä¸éœ€è¦æ„å»ºä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ï¼Œåœ¨ä½ çš„ä»£ç ä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°çœ‹èµ·æ¥å°†æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CryptoZombies.methods.createRandomZombie(&quot;Vitalik Nakamoto ğŸ¤”&quot;)</span><br><span class="line">  .send(&#123; from: &quot;0xb60e8dd61c5d32be8058bb8eb970870f07233155&quot;, gas: &quot;3000000&quot; &#125;)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„å‡ ç« è¯¦ç»†è§£é‡Šè¿™äº›è¯­å¥ï¼Œä¸è¿‡é¦–å…ˆæˆ‘ä»¬æ¥æŠŠ Web3.js ç¯å¢ƒæ­å»ºèµ·æ¥ã€‚</p>
<h2 id="å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ"><a href="#å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ" class="headerlink" title="å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ"></a>å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ</h2><p>å–å†³äºä½ çš„é¡¹ç›®å·¥ä½œæµç¨‹å’Œä½ çš„çˆ±å¥½ï¼Œä½ å¯ä»¥ç”¨ä¸€äº›å¸¸ç”¨å·¥å…·æŠŠ Web3.js æ·»åŠ è¿›æ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// ç”¨ NPM</span><br><span class="line">npm install web3</span><br><span class="line"></span><br><span class="line">// ç”¨ Yarn</span><br><span class="line">yarn add web3</span><br><span class="line"></span><br><span class="line">// ç”¨ Bower</span><br><span class="line">bower install web3</span><br><span class="line"></span><br><span class="line">// ...æˆ–è€…å…¶ä»–ã€‚</span><br></pre></td></tr></table></figure>

<p>ç”šè‡³ï¼Œä½ å¯ä»¥ä» <a href="https://github.com/ethereum/web3.js/blob/1.0/dist/web3.min.js" target="_blank" rel="noopener">github</a> ç›´æ¥ä¸‹è½½å‹ç¼©åçš„ <code>.js</code> æ–‡ä»¶ ç„¶ååŒ…å«åˆ°ä½ çš„é¡¹ç›®æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;web3.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬ä¸æƒ³è®©ä½ èŠ±å¤ªå¤šåœ¨é¡¹ç›®ç¯å¢ƒæ­å»ºä¸Šï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬å°†ä½¿ç”¨ä¸Šé¢çš„ <code>script</code> æ ‡ç­¾æ¥å°† Web3.js å¼•å…¥ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ "><a href="#å®æˆ˜æ¼”ä¹ " class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬ä¸ºä½ å»ºç«‹äº†ä¸€ä¸ªHTML é¡¹ç›®ç©ºå£³ â€”â€” <code>index.html</code>ã€‚å‡è®¾åœ¨å’Œ <code>index.html</code> åŒä¸ªæ–‡ä»¶å¤¹é‡Œæœ‰ä¸€ä»½ <code>web3.min.js</code></p>
<ol>
<li>ä½¿ç”¨ä¸Šé¢çš„ <code>script</code> æ ‡ç­¾ä»£ç æŠŠ <code>web3.js</code> æ·»åŠ è¿›å»ä»¥å¤‡æ¥ä¸‹æ¥ä½¿ç”¨ã€‚</li>
</ol>
<h2 id="é¡µé¢åˆ›å»º"><a href="#é¡µé¢åˆ›å»º" class="headerlink" title="é¡µé¢åˆ›å»º"></a>é¡µé¢åˆ›å»º</h2><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Include web3.js here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Web3-æä¾›è€…"><a href="#Web3-æä¾›è€…" class="headerlink" title="Web3 æä¾›è€…"></a>Web3 æä¾›è€…</h1><p>å¤ªæ£’äº†ã€‚ç°åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æœ‰äº†Web3.js, æ¥åˆå§‹åŒ–å®ƒç„¶åå’ŒåŒºå—é“¾å¯¹è¯å§ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ <strong><em>Web3 Provider\</em></strong>.</p>
<p>è¦è®°ä½ï¼Œä»¥å¤ªåŠæ˜¯ç”±å…±äº«åŒä¸€ä»½æ•°æ®çš„ç›¸åŒæ‹·è´çš„ <strong><em>èŠ‚ç‚¹</em></strong> æ„æˆçš„ã€‚ åœ¨ Web3.js é‡Œè®¾ç½® Web3 çš„ <code>Provider</code>ï¼ˆæä¾›è€…ï¼‰ å‘Šè¯‰æˆ‘ä»¬çš„ä»£ç åº”è¯¥å’Œ <strong>å“ªä¸ªèŠ‚ç‚¹</strong> äº¤äº’æ¥å¤„ç†æˆ‘ä»¬çš„è¯»å†™ã€‚è¿™å°±å¥½åƒåœ¨ä¼ ç»Ÿçš„ Web åº”ç”¨ç¨‹åºä¸­ä¸ºä½ çš„ API è°ƒç”¨è®¾ç½®è¿œç¨‹ Web æœåŠ¡å™¨çš„ç½‘å€ã€‚</p>
<p>ä½ å¯ä»¥è¿è¡Œä½ è‡ªå·±çš„ä»¥å¤ªåŠèŠ‚ç‚¹æ¥ä½œä¸º Providerã€‚ ä¸è¿‡ï¼Œæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œå¯ä»¥è®©ä½ çš„ç”Ÿæ´»å˜å¾—è½»æ¾ç‚¹ï¼Œè®©ä½ ä¸å¿…ä¸ºäº†ç»™ä½ çš„ç”¨æˆ·æä¾›DAppè€Œç»´æŠ¤ä¸€ä¸ªä»¥å¤ªåŠèŠ‚ç‚¹â€” <strong><em>Infura\</em></strong>.</p>
<h2 id="Infura"><a href="#Infura" class="headerlink" title="Infura"></a>Infura</h2><p><a href="https://infura.io/" target="_blank" rel="noopener">Infura</a> æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒç»´æŠ¤äº†å¾ˆå¤šä»¥å¤ªåŠèŠ‚ç‚¹å¹¶æä¾›äº†ä¸€ä¸ªç¼“å­˜å±‚æ¥å®ç°é«˜é€Ÿè¯»å–ã€‚ä½ å¯ä»¥ç”¨ä»–ä»¬çš„ API æ¥å…è´¹è®¿é—®è¿™ä¸ªæœåŠ¡ã€‚ ç”¨ Infura ä½œä¸ºèŠ‚ç‚¹æä¾›è€…ï¼Œä½ å¯ä»¥ä¸ç”¨è‡ªå·±è¿è¥èŠ‚ç‚¹å°±èƒ½å¾ˆå¯é åœ°å‘ä»¥å¤ªåŠå‘é€ã€æ¥æ”¶ä¿¡æ¯ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡è¿™æ ·æŠŠ Infura ä½œä¸ºä½ çš„ Web3 èŠ‚ç‚¹æä¾›è€…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var web3 = new Web3(new Web3.providers.WebsocketProvider(&quot;wss://mainnet.infura.io/ws&quot;));</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡ï¼Œå› ä¸ºæˆ‘ä»¬çš„ DApp å°†è¢«å¾ˆå¤šäººä½¿ç”¨ï¼Œè¿™äº›ç”¨æˆ·ä¸å•ä¼šä»åŒºå—é“¾è¯»å–ä¿¡æ¯ï¼Œè¿˜ä¼šå‘åŒºå—é“¾ <strong><em>å†™</em></strong> å…¥ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªæ–¹æ³•è®©ç”¨æˆ·å¯ä»¥ç”¨ä»–ä»¬çš„ç§é’¥ç»™äº‹åŠ¡ç­¾åã€‚</p>
<blockquote>
<p>æ³¨æ„: ä»¥å¤ªåŠ (ä»¥åŠé€šå¸¸æ„ä¹‰ä¸Šçš„ blockchains )ä½¿ç”¨ä¸€ä¸ªå…¬é’¥/ç§é’¥å¯¹æ¥å¯¹ç»™äº‹åŠ¡åšæ•°å­—ç­¾åã€‚æŠŠå®ƒæƒ³æˆä¸€ä¸ªæ•°å­—ç­¾åçš„å¼‚å¸¸å®‰å…¨çš„å¯†ç ã€‚è¿™æ ·å½“æˆ‘ä¿®æ”¹åŒºå—é“¾ä¸Šçš„æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘å¯ä»¥ç”¨æˆ‘çš„å…¬é’¥æ¥ <strong>è¯æ˜</strong> æˆ‘å°±æ˜¯ç­¾åçš„é‚£ä¸ªã€‚ä½†æ˜¯å› ä¸ºæ²¡äººçŸ¥é“æˆ‘çš„ç§é’¥ï¼Œæ‰€ä»¥æ²¡äººèƒ½ä¼ªé€ æˆ‘çš„äº‹åŠ¡ã€‚</p>
</blockquote>
<p>åŠ å¯†å­¦éå¸¸å¤æ‚ï¼Œæ‰€ä»¥é™¤éä½ æ˜¯ä¸ªä¸“å®¶å¹¶ä¸”çš„ç¡®çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œä½ æœ€å¥½ä¸è¦åœ¨ä½ åº”ç”¨çš„å‰ç«¯ä¸­ç®¡ç†ä½ ç”¨æˆ·çš„ç§é’¥ã€‚</p>
<p>ä¸è¿‡å¹¸è¿çš„æ˜¯ï¼Œä½ å¹¶ä¸éœ€è¦ï¼Œå·²ç»æœ‰å¯ä»¥å¸®ä½ å¤„ç†è¿™ä»¶äº‹çš„æœåŠ¡äº†ï¼š <strong><em>Metamask\</em></strong>.</p>
<h2 id="Metamask"><a href="#Metamask" class="headerlink" title="Metamask"></a>Metamask</h2><p><a href="https://metamask.io/" target="_blank" rel="noopener">Metamask</a> æ˜¯ Chrome å’Œ Firefox çš„æµè§ˆå™¨æ‰©å±•ï¼Œ å®ƒèƒ½è®©ç”¨æˆ·å®‰å…¨åœ°ç»´æŠ¤ä»–ä»¬çš„ä»¥å¤ªåŠè´¦æˆ·å’Œç§é’¥ï¼Œ å¹¶ç”¨ä»–ä»¬çš„è´¦æˆ·å’Œä½¿ç”¨ Web3.js çš„ç½‘ç«™äº’åŠ¨ï¼ˆå¦‚æœä½ è¿˜æ²¡ç”¨è¿‡å®ƒï¼Œä½ è‚¯å®šä¼šæƒ³å»å®‰è£…çš„â€”â€”è¿™æ ·ä½ çš„æµè§ˆå™¨å°±èƒ½ä½¿ç”¨ Web3.js äº†ï¼Œç„¶åä½ å°±å¯ä»¥å’Œä»»ä½•ä¸ä»¥å¤ªåŠåŒºå—é“¾é€šä¿¡çš„ç½‘ç«™äº¤äº’äº†ï¼‰</p>
<p>ä½œä¸ºå¼€å‘è€…ï¼Œå¦‚æœä½ æƒ³è®©ç”¨æˆ·ä»ä»–ä»¬çš„æµè§ˆå™¨é‡Œé€šè¿‡ç½‘ç«™å’Œä½ çš„DAppäº¤äº’ï¼ˆå°±åƒæˆ‘ä»¬åœ¨ CryptoZombies æ¸¸æˆé‡Œä¸€æ ·ï¼‰ï¼Œä½ è‚¯å®šä¼šæƒ³è¦å…¼å®¹ Metamask çš„ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>: Metamask é»˜è®¤ä½¿ç”¨ Infura çš„æœåŠ¡å™¨åšä¸º web3 æä¾›è€…ã€‚ å°±åƒæˆ‘ä»¬ä¸Šé¢åšçš„é‚£æ ·ã€‚ä¸è¿‡å®ƒè¿˜ä¸ºç”¨æˆ·æä¾›äº†é€‰æ‹©ä»–ä»¬è‡ªå·± Web3 æä¾›è€…çš„é€‰é¡¹ã€‚æ‰€ä»¥ä½¿ç”¨ Metamask çš„ web3 æä¾›è€…ï¼Œä½ å°±ç»™äº†ç”¨æˆ·é€‰æ‹©æƒï¼Œè€Œè‡ªå·±æ— éœ€æ“å¿ƒè¿™ä¸€å—ã€‚</p>
</blockquote>
<h2 id="ä½¿ç”¨-Metamask-çš„-web3-æä¾›è€…"><a href="#ä½¿ç”¨-Metamask-çš„-web3-æä¾›è€…" class="headerlink" title="ä½¿ç”¨ Metamask çš„ web3 æä¾›è€…"></a>ä½¿ç”¨ Metamask çš„ web3 æä¾›è€…</h2><p>Metamask æŠŠå®ƒçš„ web3 æä¾›è€…æ³¨å…¥åˆ°æµè§ˆå™¨çš„å…¨å±€ JavaScriptå¯¹è±¡<code>web3</code>ä¸­ã€‚æ‰€ä»¥ä½ çš„åº”ç”¨å¯ä»¥æ£€æŸ¥ <code>web3</code> æ˜¯å¦å­˜åœ¨ã€‚è‹¥å­˜åœ¨å°±ä½¿ç”¨ <code>web3.currentProvider</code> ä½œä¸ºå®ƒçš„æä¾›è€…ã€‚</p>
<p>è¿™é‡Œæ˜¯ä¸€äº› Metamask æä¾›çš„ç¤ºä¾‹ä»£ç ï¼Œç”¨æ¥æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å®‰è£…äº†MetaMaskï¼Œå¦‚æœæ²¡æœ‰å®‰è£…å°±å‘Šè¯‰ç”¨æˆ·éœ€è¦å®‰è£…MetaMaskæ¥ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&apos;load&apos;, function() &#123;</span><br><span class="line"></span><br><span class="line">  // æ£€æŸ¥web3æ˜¯å¦å·²ç»æ³¨å…¥åˆ°(Mist/MetaMask)</span><br><span class="line">  if (typeof web3 !== &apos;undefined&apos;) &#123;</span><br><span class="line">    // ä½¿ç”¨ Mist/MetaMask çš„æä¾›è€…</span><br><span class="line">    web3js = new Web3(web3.currentProvider);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // å¤„ç†ç”¨æˆ·æ²¡å®‰è£…çš„æƒ…å†µï¼Œ æ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªæ¶ˆæ¯</span><br><span class="line">    // å‘Šè¯‰ä»–ä»¬è¦å®‰è£… MetaMask æ¥ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ç°åœ¨ä½ å¯ä»¥å¯åŠ¨ä½ çš„åº”ç”¨å¹¶è‡ªç”±è®¿é—® Web3.js:</span><br><span class="line">  startApp()</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥åœ¨ä½ æ‰€æœ‰çš„åº”ç”¨ä¸­ä½¿ç”¨è¿™æ®µæ ·æ¿ä»£ç ï¼Œå¥½æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å®‰è£…ä»¥åŠå‘Šè¯‰ç”¨æˆ·å®‰è£… MetaMaskã€‚</p>
<blockquote>
<p>æ³¨æ„: é™¤äº†MetaMaskï¼Œä½ çš„ç”¨æˆ·ä¹Ÿå¯èƒ½åœ¨ä½¿ç”¨å…¶ä»–ä»–çš„ç§é’¥ç®¡ç†åº”ç”¨ï¼Œæ¯”å¦‚ <strong>Mist</strong> æµè§ˆå™¨ã€‚ä¸è¿‡ï¼Œå®ƒä»¬éƒ½å®ç°äº†ç›¸åŒçš„æ¨¡å¼æ¥æ³¨å…¥ <code>web3</code> å˜é‡ã€‚æ‰€ä»¥æˆ‘è¿™é‡Œæè¿°çš„æ–¹æ³•å¯¹ä¸¤è€…æ˜¯é€šç”¨çš„ã€‚</p>
</blockquote>
<h2 id="å®æˆ˜æ¼”ä¹ -1"><a href="#å®æˆ˜æ¼”ä¹ -1" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬åœ¨HTMLæ–‡ä»¶ä¸­çš„ <code>&lt;/body&gt;</code> æ ‡ç­¾å‰é¢æ”¾ç½®äº†ä¸€ä¸ªç©ºçš„ <code>script</code> æ ‡ç­¾ã€‚å¯ä»¥æŠŠè¿™èŠ‚è¯¾çš„ JavaScript ä»£ç å†™åœ¨é‡Œé¢ã€‚</p>
<ol>
<li>æŠŠä¸Šé¢ç”¨æ¥æ£€æµ‹ MetaMask æ˜¯å¦å®‰è£…çš„æ¨¡æ¿ä»£ç ç²˜è´´è¿›æ¥ã€‚è¯·ç²˜è´´åˆ°ä»¥ <code>window.addEventListener</code> å¼€å¤´çš„ä»£ç å—ä¸­ã€‚</li>
</ol>
<h2 id="é¡µé¢ä¿®æ”¹"><a href="#é¡µé¢ä¿®æ”¹" class="headerlink" title="é¡µé¢ä¿®æ”¹"></a>é¡µé¢ä¿®æ”¹</h2><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// Start here</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">  <span class="comment">// æ£€æŸ¥web3æ˜¯å¦å·²ç»æ³¨å…¥åˆ°(Mist/MetaMask)</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// ä½¿ç”¨ Mist/MetaMask çš„æä¾›è€…</span></span></span><br><span class="line"><span class="actionscript">    web3js = <span class="keyword">new</span> Web3(web3.currentProvider);</span></span><br><span class="line"><span class="actionscript">  &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// å¤„ç†ç”¨æˆ·æ²¡å®‰è£…çš„æƒ…å†µï¼Œ æ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªæ¶ˆæ¯</span></span></span><br><span class="line"><span class="actionscript">    <span class="comment">// å‘Šè¯‰ä»–ä»¬è¦å®‰è£… MetaMask æ¥ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">  <span class="comment">// ç°åœ¨ä½ å¯ä»¥å¯åŠ¨ä½ çš„åº”ç”¨å¹¶è‡ªç”±è®¿é—® Web3.js:</span></span></span><br><span class="line">  startApp()</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="å’Œåˆçº¦å¯¹è¯"><a href="#å’Œåˆçº¦å¯¹è¯" class="headerlink" title="å’Œåˆçº¦å¯¹è¯"></a>å’Œåˆçº¦å¯¹è¯</h1><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç”¨ MetaMask çš„ Web3 æä¾›è€…åˆå§‹åŒ–äº† Web3.jsã€‚æ¥ä¸‹æ¥å°±è®©å®ƒå’Œæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å¯¹è¯å§ã€‚</p>
<p>Web3.js éœ€è¦ä¸¤ä¸ªä¸œè¥¿æ¥å’Œä½ çš„åˆçº¦å¯¹è¯: å®ƒçš„ <strong><em>åœ°å€</em></strong> å’Œå®ƒçš„ <strong><em>ABI\</em></strong>ã€‚</p>
<h2 id="åˆçº¦åœ°å€"><a href="#åˆçº¦åœ°å€" class="headerlink" title="åˆçº¦åœ°å€"></a>åˆçº¦åœ°å€</h2><p>åœ¨ä½ å†™å®Œäº†ä½ çš„æ™ºèƒ½åˆçº¦åï¼Œä½ éœ€è¦ç¼–è¯‘å®ƒå¹¶æŠŠå®ƒéƒ¨ç½²åˆ°ä»¥å¤ªåŠã€‚æˆ‘ä»¬å°†åœ¨<strong>ä¸‹ä¸€è¯¾</strong>ä¸­è¯¦è¿°<strong>éƒ¨ç½²</strong>ï¼Œå› ä¸ºå®ƒå’Œå†™ä»£ç æ˜¯æˆªç„¶ä¸åŒçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šæ‰“ä¹±é¡ºåºï¼Œå…ˆæ¥è®² Web3.jsã€‚</p>
<p>åœ¨ä½ éƒ¨ç½²æ™ºèƒ½åˆçº¦ä»¥åï¼Œå®ƒå°†è·å¾—ä¸€ä¸ªä»¥å¤ªåŠä¸Šçš„æ°¸ä¹…åœ°å€ã€‚å¦‚æœä½ è¿˜è®°å¾—ç¬¬äºŒè¯¾ï¼ŒCryptoKitties åœ¨ä»¥å¤ªåŠä¸Šçš„åœ°å€æ˜¯ <code>0x06012c8cf97BEaD5deAe237070F9587f8E7A266d</code>ã€‚</p>
<p>ä½ éœ€è¦åœ¨éƒ¨ç½²åå¤åˆ¶è¿™ä¸ªåœ°å€ä»¥æ¥å’Œä½ çš„æ™ºèƒ½åˆçº¦å¯¹è¯ã€‚</p>
<h2 id="åˆçº¦-ABI"><a href="#åˆçº¦-ABI" class="headerlink" title="åˆçº¦ ABI"></a>åˆçº¦ ABI</h2><p>å¦ä¸€ä¸ª Web3.js ä¸ºäº†è¦å’Œä½ çš„æ™ºèƒ½åˆçº¦å¯¹è¯è€Œéœ€è¦çš„ä¸œè¥¿æ˜¯ <strong><em>ABI\</em></strong>ã€‚</p>
<p>ABI æ„ä¸ºåº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼‰ã€‚ åŸºæœ¬ä¸Šï¼Œå®ƒæ˜¯ä»¥ JSON æ ¼å¼è¡¨ç¤ºåˆçº¦çš„æ–¹æ³•ï¼Œå‘Šè¯‰ Web3.js å¦‚ä½•ä»¥åˆåŒç†è§£çš„æ–¹å¼æ ¼å¼åŒ–å‡½æ•°è°ƒç”¨ã€‚</p>
<p>å½“ä½ ç¼–è¯‘ä½ çš„åˆçº¦å‘ä»¥å¤ªåŠéƒ¨ç½²æ—¶(æˆ‘ä»¬å°†åœ¨ç¬¬ä¸ƒè¯¾è¯¦è¿°)ï¼Œ Solidity ç¼–è¯‘å™¨ä¼šç»™ä½  ABIï¼Œæ‰€ä»¥é™¤äº†åˆçº¦åœ°å€ï¼Œä½ è¿˜éœ€è¦æŠŠè¿™ä¸ªä¹Ÿå¤åˆ¶ä¸‹æ¥ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬è¿™ä¸€è¯¾ä¸ä¼šè®²è¿°éƒ¨ç½²ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬å·²ç»å¸®ä½ ç¼–è¯‘äº† ABI å¹¶æ”¾åœ¨äº†åä¸º<code>cryptozombies_abi.js</code>ï¼Œæ–‡ä»¶ä¸­ï¼Œä¿å­˜åœ¨ä¸€ä¸ªåä¸º <code>cryptoZombiesABI</code> çš„å˜é‡ä¸­ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°†<code>cryptozombies_abi.js</code> åŒ…å«è¿›æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡é‚£ä¸ªå˜é‡è®¿é—® CryptoZombies ABI ã€‚</p>
<h2 id="å®ä¾‹åŒ–-Web3-js"><a href="#å®ä¾‹åŒ–-Web3-js" class="headerlink" title="å®ä¾‹åŒ– Web3.js"></a>å®ä¾‹åŒ– Web3.js</h2><p>ä¸€æ—¦ä½ æœ‰äº†åˆçº¦çš„åœ°å€å’Œ ABIï¼Œä½ å¯ä»¥åƒè¿™æ ·æ¥å®ä¾‹åŒ– Web3.jsã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å®ä¾‹åŒ– myContract</span><br><span class="line">var myContract = new web3js.eth.Contract(myABI, myContractAddress);</span><br></pre></td></tr></table></figure>

<h2 id="å®æˆ˜æ¼”ä¹ -2"><a href="#å®æˆ˜æ¼”ä¹ -2" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><ol>
<li>åœ¨æ–‡ä»¶çš„ <code>&lt;head&gt;</code> æ ‡ç­¾å—ä¸­ï¼Œç”¨ <code>script</code> æ ‡ç­¾å¼•å…¥<code>cryptozombies_abi.js</code>ï¼Œå¥½æŠŠ ABI çš„å®šä¹‰å¼•å…¥é¡¹ç›®ã€‚</li>
<li>åœ¨ <code>&lt;body&gt;</code> é‡Œçš„ <code>&lt;script&gt;</code> å¼€å¤´ , å®šä¹‰ä¸€ä¸ª<code>var</code>ï¼Œå–å <code>cryptoZombies</code>ï¼Œ ä¸è¿‡ä¸è¦å¯¹å…¶èµ‹å€¼ï¼Œç¨åæˆ‘ä»¬å°†ç”¨è¿™ä¸ªè¿™ä¸ªå˜é‡æ¥å­˜å‚¨æˆ‘ä»¬å®ä¾‹åŒ–åˆçº¦ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>startApp()</code> çš„ <code>function</code>ã€‚ æ¥ä¸‹æ¥ä¸¤æ­¥æ¥å®Œæˆè¿™ä¸ªæ–¹æ³•ã€‚</li>
<li><code>startApp()</code> é‡Œåº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å®šä¹‰ä¸€ä¸ªåä¸º<code>cryptoZombiesAddress</code> çš„å˜é‡å¹¶èµ‹å€¼ä¸º<code>&quot;ä½ çš„åˆçº¦åœ°å€&quot;</code> (è¿™æ˜¯ä½ çš„åˆçº¦åœ¨ä»¥å¤ªåŠä¸»ç½‘ä¸Šçš„åœ°å€)ã€‚</li>
<li>æœ€åï¼Œæ¥å®ä¾‹åŒ–æˆ‘ä»¬çš„åˆçº¦ã€‚æ¨¡ä»¿æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ï¼Œå°† <code>cryptoZombies</code> èµ‹å€¼ä¸º <code>new</code> <code>web3js.eth.Contract</code> (ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢ä»£ç ä¸­é€šè¿‡ <code>script</code> å¼•å…¥çš„ <code>cryptoZombiesABI</code> å’Œ <code>cryptoZombiesAddress</code>)ã€‚</li>
</ol>
<h2 id="é¡µé¢ä¿®æ”¹-1"><a href="#é¡µé¢ä¿®æ”¹-1" class="headerlink" title="é¡µé¢ä¿®æ”¹"></a>é¡µé¢ä¿®æ”¹</h2><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- Include cryptozombies_abi.js here --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"cryptozombies_abi.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// 2. Start code here</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> cryptoZombies;</span></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">startApp</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"ä½ çš„åˆçº¦åœ°å€"</span>;</span></span><br><span class="line"><span class="actionscript">        cryptoZombies = <span class="keyword">new</span> web3js.eth.Contract(cryptoZombiesABI,cryptoZombiesAddress);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Checking if Web3 has been injected by the browser (Mist/MetaMask)</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Use Mist/MetaMask's provider</span></span></span><br><span class="line"><span class="actionscript">          web3js = <span class="keyword">new</span> Web3(web3.currentProvider);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Handle the case where the user doesn't have Metamask installed</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Probably show them a message prompting them to install Metamask</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Now you can start your app &amp; access web3 freely:</span></span></span><br><span class="line">        startApp()</span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="è°ƒç”¨å’Œåˆçº¦å‡½æ•°"><a href="#è°ƒç”¨å’Œåˆçº¦å‡½æ•°" class="headerlink" title="è°ƒç”¨å’Œåˆçº¦å‡½æ•°"></a>è°ƒç”¨å’Œåˆçº¦å‡½æ•°</h1><p>æˆ‘ä»¬çš„åˆçº¦é…ç½®å¥½äº†ï¼ç°åœ¨æ¥ç”¨ Web3.js å’Œå®ƒå¯¹è¯ã€‚</p>
<p>Web3.js æœ‰ä¸¤ä¸ªæ–¹æ³•æ¥è°ƒç”¨æˆ‘ä»¬åˆçº¦çš„å‡½æ•°: <code>call</code> and <code>send</code>.</p>
<h3 id="Call"><a href="#Call" class="headerlink" title="Call"></a>Call</h3><p><code>call</code> ç”¨æ¥è°ƒç”¨ <code>view</code> å’Œ <code>pure</code> å‡½æ•°ã€‚å®ƒåªè¿è¡Œåœ¨æœ¬åœ°èŠ‚ç‚¹ï¼Œä¸ä¼šåœ¨åŒºå—é“¾ä¸Šåˆ›å»ºäº‹åŠ¡ã€‚</p>
<blockquote>
<p><strong>å¤ä¹ :</strong> <code>view</code> å’Œ <code>pure</code> å‡½æ•°æ˜¯åªè¯»çš„å¹¶ä¸ä¼šæ”¹å˜åŒºå—é“¾çš„çŠ¶æ€ã€‚å®ƒä»¬ä¹Ÿä¸ä¼šæ¶ˆè€—ä»»ä½•gasã€‚ç”¨æˆ·ä¹Ÿä¸ä¼šè¢«è¦æ±‚ç”¨MetaMaskå¯¹äº‹åŠ¡ç­¾åã€‚</p>
</blockquote>
<p>ä½¿ç”¨ Web3.jsï¼Œä½ å¯ä»¥å¦‚ä¸‹ <code>call</code> ä¸€ä¸ªåä¸º<code>myMethod</code>çš„æ–¹æ³•å¹¶ä¼ å…¥ä¸€ä¸ª <code>123</code> ä½œä¸ºå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myContract.methods.myMethod(123).call()</span><br></pre></td></tr></table></figure>

<h3 id="Send"><a href="#Send" class="headerlink" title="Send"></a>Send</h3><p><code>send</code> å°†åˆ›å»ºä¸€ä¸ªäº‹åŠ¡å¹¶æ”¹å˜åŒºå—é“¾ä¸Šçš„æ•°æ®ã€‚ä½ éœ€è¦ç”¨ <code>send</code> æ¥è°ƒç”¨ä»»ä½•é <code>view</code> æˆ–è€… <code>pure</code> çš„å‡½æ•°ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„:</strong> <code>send</code> ä¸€ä¸ªäº‹åŠ¡å°†è¦æ±‚ç”¨æˆ·æ”¯ä»˜gasï¼Œå¹¶ä¼šè¦æ±‚å¼¹å‡ºå¯¹è¯æ¡†è¯·æ±‚ç”¨æˆ·ä½¿ç”¨ Metamask å¯¹äº‹åŠ¡ç­¾åã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨ Metamask ä½œä¸ºæˆ‘ä»¬çš„ web3 æä¾›è€…çš„æ—¶å€™ï¼Œæ‰€æœ‰è¿™ä¸€åˆ‡éƒ½ä¼šåœ¨æˆ‘ä»¬è°ƒç”¨ <code>send()</code> çš„æ—¶å€™è‡ªåŠ¨å‘ç”Ÿã€‚è€Œæˆ‘ä»¬è‡ªå·±æ— éœ€åœ¨ä»£ç ä¸­æ“å¿ƒè¿™ä¸€åˆ‡ï¼ŒæŒºçˆ½çš„å§ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ Web3.js, ä½ å¯ä»¥åƒè¿™æ · <code>send</code> ä¸€ä¸ªäº‹åŠ¡è°ƒç”¨<code>myMethod</code> å¹¶ä¼ å…¥ <code>123</code> ä½œä¸ºå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myContract.methods.myMethod(123).send()</span><br></pre></td></tr></table></figure>

<p>è¯­æ³•å‡ ä¹ <code>call()</code>ä¸€æ¨¡ä¸€æ ·ã€‚</p>
<h2 id="è·å–åƒµå°¸æ•°æ®"><a href="#è·å–åƒµå°¸æ•°æ®" class="headerlink" title="è·å–åƒµå°¸æ•°æ®"></a>è·å–åƒµå°¸æ•°æ®</h2><p>æ¥çœ‹ä¸€ä¸ªä½¿ç”¨ <code>call</code> è¯»å–æˆ‘ä»¬åˆçº¦æ•°æ®çš„çœŸå®ä¾‹å­</p>
<p>å›å¿†ä¸€ä¸‹ï¼Œæˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„åƒµå°¸æ•°ç»„ä¸º <code>å…¬å¼€</code>(public):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Zombie[] public zombies;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Solidity é‡Œï¼Œå½“ä½ å®šä¹‰ä¸€ä¸ª <code>public</code>å˜é‡çš„æ—¶å€™ï¼Œ å®ƒå°†è‡ªåŠ¨å®šä¹‰ä¸€ä¸ªå…¬å¼€çš„ â€œgetterâ€ åŒåæ–¹æ³•ï¼Œ æ‰€ä»¥å¦‚æœä½ åƒè¦æŸ¥çœ‹ id ä¸º <code>15</code> çš„åƒµå°¸ï¼Œä½ å¯ä»¥åƒä¸€ä¸ªå‡½æ•°ä¸€æ ·è°ƒç”¨å®ƒï¼š <code>zombies(15)</code>.</p>
<p>è¿™æ˜¯å¦‚ä½•åœ¨å¤–é¢çš„å‰ç«¯ç•Œé¢ä¸­å†™ä¸€ä¸ª JavaScript æ–¹æ³•æ¥ä¼ å…¥ä¸€ä¸ªåƒµå°¸ idï¼Œåœ¨æˆ‘ä»¬çš„åˆåŒä¸­æŸ¥è¯¢é‚£ä¸ªåƒµå°¸å¹¶è¿”å›ç»“æœ</p>
<blockquote>
<p>æ³¨æ„: æœ¬è¯¾ä¸­æ‰€æœ‰çš„ç¤ºä¾‹ä»£ç éƒ½ä½¿ç”¨ Web3.js çš„ <strong>1.0 ç‰ˆ</strong>ï¼Œæ­¤ç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯ Promises è€Œä¸æ˜¯å›è°ƒå‡½æ•°ã€‚ä½ åœ¨çº¿ä¸Šçœ‹åˆ°çš„å…¶ä»–æ•™ç¨‹å¯èƒ½è¿˜åœ¨ä½¿ç”¨è€ç‰ˆçš„ Web3.jsã€‚åœ¨1.0ç‰ˆä¸­ï¼Œè¯­æ³•æ”¹å˜äº†ä¸å°‘ã€‚å¦‚æœä½ ä»å…¶ä»–æ•™ç¨‹ä¸­å¤åˆ¶ä»£ç ï¼Œå…ˆç¡®ä¿ä½ ä»¬ä½¿ç”¨çš„æ˜¯ç›¸åŒç‰ˆæœ¬çš„Web3.jsã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function getZombieDetails(id) &#123;</span><br><span class="line">  return cryptoZombies.methods.zombies(id).call()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨å‡½æ•°å¹¶åšä¸€äº›å…¶ä»–äº‹æƒ…</span><br><span class="line">getZombieDetails(15)</span><br><span class="line">.then(function(result) &#123;</span><br><span class="line">  console.log(&quot;Zombie 15: &quot; + JSON.stringify(result));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™é‡Œéƒ½åšäº†ä»€ä¹ˆ</p>
<p><code>cryptoZombies.methods.zombies(id).call()</code> å°†å’Œ Web3 æä¾›è€…èŠ‚ç‚¹é€šä¿¡ï¼Œå‘Šè¯‰å®ƒè¿”å›ä»æˆ‘ä»¬çš„åˆçº¦ä¸­çš„ <code>Zombie[] public zombies</code>ï¼Œ<code>id</code>ä¸ºä¼ å…¥å‚æ•°çš„åƒµå°¸ä¿¡æ¯ã€‚</p>
<p>æ³¨æ„è¿™æ˜¯ <strong>å¼‚æ­¥çš„</strong>ï¼Œå°±åƒä»å¤–éƒ¨æœåŠ¡å™¨ä¸­è°ƒç”¨APIã€‚æ‰€ä»¥ Web3 åœ¨è¿™é‡Œè¿”å›äº†ä¸€ä¸ª Promises. (å¦‚æœä½ å¯¹ JavaScriptçš„ Promises ä¸äº†è§£ï¼Œæœ€å¥½å…ˆå»å­¦ä¹ ä¸€ä¸‹è¿™æ–¹é¢çŸ¥è¯†å†ç»§ç»­)ã€‚</p>
<p>ä¸€æ—¦é‚£ä¸ª <code>promise</code> è¢« <code>resolve</code>, (æ„å‘³ç€æˆ‘ä»¬ä» Web3 æä¾›è€…é‚£é‡Œè·å¾—äº†å“åº”)ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä»£ç å°†æ‰§è¡Œ <code>then</code> è¯­å¥ä¸­çš„ä»£ç ï¼Œåœ¨æ§åˆ¶å°æ‰“å‡º <code>result</code>ã€‚</p>
<p><code>result</code> æ˜¯ä¸€ä¸ªåƒè¿™æ ·çš„ JavaScript å¯¹è±¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;H4XF13LD MORRIS&apos;S COOLER OLDER BROTHER&quot;,</span><br><span class="line">  &quot;dna&quot;: &quot;1337133713371337&quot;,</span><br><span class="line">  &quot;level&quot;: &quot;9999&quot;,</span><br><span class="line">  &quot;readyTime&quot;: &quot;1522498671&quot;,</span><br><span class="line">  &quot;winCount&quot;: &quot;999999999&quot;,</span><br><span class="line">  &quot;lossCount&quot;: &quot;0&quot; // Obviously.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›å‰ç«¯é€»è¾‘ä»£ç æ¥è§£æè¿™ä¸ªå¯¹è±¡å¹¶åœ¨å‰ç«¯ç•Œé¢å‹å¥½å±•ç¤ºã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -3"><a href="#å®æˆ˜æ¼”ä¹ -3" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬å·²ç»å¸®ä½ æŠŠ <code>getZombieDetails</code> å¤åˆ¶è¿›äº†ä»£ç ã€‚</p>
<ol>
<li><p>å…ˆä¸º<code>zombieToOwner</code> åˆ›å»ºä¸€ä¸ªç±»ä¼¼çš„å‡½æ•°ã€‚å¦‚æœä½ è¿˜è®°å¾— <code>ZombieFactory.sol</code>ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé•¿è¿™æ ·çš„æ˜ å°„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapping (uint =&gt; address) public zombieToOwner;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰ä¸€ä¸ª JavaScript æ–¹æ³•ï¼Œèµ·åä¸º <code>zombieToOwner</code>ã€‚å’Œä¸Šé¢çš„ <code>getZombieDetails</code> ç±»ä¼¼ï¼Œ å®ƒå°†æ¥æ”¶ä¸€ä¸ª<code>id</code> ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª Web3.js <code>call</code> æˆ‘ä»¬åˆçº¦é‡Œçš„<code>zombieToOwner</code> ã€‚</p>
</li>
<li><p>ä¹‹ååœ¨ä¸‹é¢ï¼Œä¸º <code>getZombiesByOwner</code> å®šä¹‰ä¸€ä¸ªæ–¹æ³•ã€‚å¦‚æœä½ è¿˜èƒ½è®°èµ· <code>ZombieHelper.sol</code>ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰åƒè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çš„ <code>getZombiesByOwner</code> æ–¹æ³•å°†æ¥æ”¶ <code>owner</code> ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹æˆ‘ä»¬å‡½æ•° <code>getZombiesByOwner</code>çš„ Web3.js <code>call</code></p>
</li>
</ol>
<h2 id="é¡µé¢ä¿®æ”¹-2"><a href="#é¡µé¢ä¿®æ”¹-2" class="headerlink" title="é¡µé¢ä¿®æ”¹"></a>é¡µé¢ä¿®æ”¹</h2><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"cryptozombies_abi.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> cryptoZombies;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">startApp</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"YOUR_CONTRACT_ADDRESS"</span>;</span></span><br><span class="line"><span class="actionscript">        cryptoZombies = <span class="keyword">new</span> web3js.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombieDetails</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombies(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// 1. Define `zombieToOwner` here</span></span></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">zombieToOwner</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombieToOwner(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// 2. Define `getZombiesByOwner` here</span></span></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombiesByOwner</span><span class="params">(owner)</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.getZombiesByOwner(owner).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Checking if Web3 has been injected by the browser (Mist/MetaMask)</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Use Mist/MetaMask's provider</span></span></span><br><span class="line"><span class="actionscript">          web3js = <span class="keyword">new</span> Web3(web3.currentProvider);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Handle the case where the user doesn't have Metamask installed</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Probably show them a message prompting them to install Metamask</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Now you can start your app &amp; access web3 freely:</span></span></span><br><span class="line">        startApp()</span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="MetaMask-å’Œè´¦æˆ·"><a href="#MetaMask-å’Œè´¦æˆ·" class="headerlink" title="MetaMask å’Œè´¦æˆ·"></a>MetaMask å’Œè´¦æˆ·</h1><p>å¤ªæ£’äº†ï¼ä½ æˆåŠŸåœ°å†™äº†ä¸€äº›å‰ç«¯ä»£ç æ¥å’Œä½ çš„ç¬¬ä¸€ä¸ªæ™ºèƒ½åˆçº¦äº¤äº’ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»¼åˆä¸€ä¸‹â€”â€”æ¯”å¦‚æˆ‘ä»¬æƒ³è®©æˆ‘ä»¬åº”ç”¨çš„é¦–é¡µæ˜¾ç¤ºç”¨æˆ·çš„æ•´ä¸ªåƒµå°¸å¤§å†›ã€‚</p>
<p>æ¯«æ— ç–‘é—®æˆ‘ä»¬é¦–å…ˆéœ€è¦ç”¨ <code>getZombiesByOwner(owner)</code> æ¥æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„æ‰€æœ‰åƒµå°¸IDã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬çš„ Solidity åˆçº¦éœ€è¦ <code>owner</code> ä½œä¸º Solidity <code>address</code>ã€‚æˆ‘ä»¬å¦‚ä½•èƒ½çŸ¥é“åº”ç”¨ç”¨æˆ·çš„åœ°å€å‘¢ï¼Ÿ</p>
<h2 id="è·å¾—-MetaMaskä¸­çš„ç”¨æˆ·è´¦æˆ·"><a href="#è·å¾—-MetaMaskä¸­çš„ç”¨æˆ·è´¦æˆ·" class="headerlink" title="è·å¾— MetaMaskä¸­çš„ç”¨æˆ·è´¦æˆ·"></a>è·å¾— MetaMaskä¸­çš„ç”¨æˆ·è´¦æˆ·</h2><p>MetaMask å…è®¸ç”¨æˆ·åœ¨æ‰©å±•ä¸­ç®¡ç†å¤šä¸ªè´¦æˆ·ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ ·æ¥è·å– <code>web3</code> å˜é‡ä¸­æ¿€æ´»çš„å½“å‰è´¦æˆ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var userAccount = web3.eth.accounts[0]</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºç”¨æˆ·å¯ä»¥éšæ—¶åœ¨ MetaMask ä¸­åˆ‡æ¢è´¦æˆ·ï¼Œæˆ‘ä»¬çš„åº”ç”¨éœ€è¦ç›‘æ§è¿™ä¸ªå˜é‡ï¼Œä¸€æ—¦æ”¹å˜å°±è¦ç›¸åº”æ›´æ–°ç•Œé¢ã€‚ä¾‹å¦‚ï¼Œè‹¥ç”¨æˆ·çš„é¦–é¡µå±•ç¤ºå®ƒä»¬çš„åƒµå°¸å¤§å†›ï¼Œå½“ä»–ä»¬åœ¨ MetaMask ä¸­åˆ‡æ¢äº†è´¦å·ï¼Œæˆ‘ä»¬å°±éœ€è¦æ›´æ–°é¡µé¢æ¥å±•ç¤ºæ–°é€‰æ‹©çš„è´¦æˆ·çš„åƒµå°¸å¤§å†›ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>setInterval</code> æ–¹æ³•æ¥åš:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var accountInterval = setInterval(function() &#123;</span><br><span class="line">  // æ£€æŸ¥è´¦æˆ·æ˜¯å¦åˆ‡æ¢</span><br><span class="line">  if (web3.eth.accounts[0] !== userAccount) &#123;</span><br><span class="line">    userAccount = web3.eth.accounts[0];</span><br><span class="line">    // è°ƒç”¨ä¸€äº›æ–¹æ³•æ¥æ›´æ–°ç•Œé¢</span><br><span class="line">    updateInterface();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, 100);</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç åšçš„æ˜¯ï¼Œæ¯100æ¯«ç§’æ£€æŸ¥ä¸€æ¬¡ <code>userAccount</code> æ˜¯å¦è¿˜ç­‰äº <code>web3.eth.accounts[0]</code> (æ¯”å¦‚ï¼šç”¨æˆ·æ˜¯å¦è¿˜æ¿€æ´»äº†é‚£ä¸ªè´¦æˆ·)ã€‚è‹¥ä¸ç­‰ï¼Œåˆ™å°† å½“å‰æ¿€æ´»ç”¨æˆ·èµ‹å€¼ç»™ <code>userAccount</code>ï¼Œç„¶åè°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥æ›´æ–°ç•Œé¢ã€‚</p>
<h2 id="å®æˆ˜æ¼”ä¹ -4"><a href="#å®æˆ˜æ¼”ä¹ -4" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬æ¥è®©åº”ç”¨åœ¨é¡µé¢ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™æ˜¾ç¤ºç”¨æˆ·çš„åƒµå°¸å¤§å†›ï¼Œç›‘æ§å½“å‰ MetaMask ä¸­çš„æ¿€æ´»è´¦æˆ·ï¼Œå¹¶åœ¨è´¦æˆ·å‘ç”Ÿæ”¹å˜çš„æ—¶å€™åˆ·æ–°æ˜¾ç¤ºã€‚</p>
<ol>
<li><p>å®šä¹‰ä¸€ä¸ªåä¸º<code>userAccount</code>çš„å˜é‡ï¼Œä¸ç»™ä»»ä½•åˆå§‹å€¼ã€‚</p>
</li>
<li><p>åœ¨ <code>startApp()</code>å‡½æ•°çš„æœ€åï¼Œå¤åˆ¶ç²˜è´´ä¸Šé¢æ ·æ¿ä»£ç ä¸­çš„ <code>accountInterval</code> æ–¹æ³•è¿›å»ã€‚</p>
</li>
<li><p>å°† <code>updateInterface();</code>æ›¿æ¢æˆä¸€ä¸ª <code>getZombiesByOwner</code> çš„ <code>call</code> å‡½æ•°ï¼Œå¹¶ä¼ å…¥ <code>userAccount</code>ã€‚</p>
</li>
<li><p>åœ¨ <code>getZombiesByOwner</code> åé¢é“¾å¼è°ƒç”¨<code>then</code> è¯­å¥ï¼Œå¹¶å°†è¿”å›çš„ç»“æœä¼ å…¥åä¸º <code>displayZombies</code> çš„å‡½æ•°ã€‚ (è¯­å¥åƒè¿™æ ·: <code>.then(displayZombies);</code>).</p>
<p>æˆ‘ä»¬è¿˜æ²¡æœ‰ <code>displayZombies</code> å‡½æ•°ï¼Œå°†äºä¸‹ä¸€ç« å®ç°ã€‚</p>
</li>
</ol>
<h2 id="é¡µé¢ä¿®æ”¹-3"><a href="#é¡µé¢ä¿®æ”¹-3" class="headerlink" title="é¡µé¢ä¿®æ”¹"></a>é¡µé¢ä¿®æ”¹</h2><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"cryptozombies_abi.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> cryptoZombies;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">// 1. declare `userAccount` here</span></span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> userAccount;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">startApp</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"YOUR_CONTRACT_ADDRESS"</span>;</span></span><br><span class="line"><span class="actionscript">        cryptoZombies = <span class="keyword">new</span> web3js.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 2. Create `setInterval` code here</span></span></span><br><span class="line"><span class="actionscript">       <span class="keyword">var</span> accountInterval = setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// æ£€æŸ¥è´¦æˆ·æ˜¯å¦åˆ‡æ¢</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (web3.eth.accounts[<span class="number">0</span>] !== userAccount) &#123;</span></span><br><span class="line">            userAccount = web3.eth.accounts[0];</span><br><span class="line"><span class="actionscript">            <span class="comment">// è°ƒç”¨ä¸€äº›æ–¹æ³•æ¥æ›´æ–°ç•Œé¢</span></span></span><br><span class="line"><span class="vbscript">            getZombiesByOwner(userAccount).<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, 100);</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombieDetails</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombies(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">zombieToOwner</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombieToOwner(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombiesByOwner</span><span class="params">(owner)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.getZombiesByOwner(owner).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Checking if Web3 has been injected by the browser (Mist/MetaMask)</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Use Mist/MetaMask's provider</span></span></span><br><span class="line"><span class="actionscript">          web3js = <span class="keyword">new</span> Web3(web3.currentProvider);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Handle the case where the user doesn't have Metamask installed</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Probably show them a message prompting them to install Metamask</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Now you can start your app &amp; access web3 freely:</span></span></span><br><span class="line">        startApp()</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="æ˜¾ç¤ºåƒµå°¸å¤§å†›"><a href="#æ˜¾ç¤ºåƒµå°¸å¤§å†›" class="headerlink" title="æ˜¾ç¤ºåƒµå°¸å¤§å†›"></a>æ˜¾ç¤ºåƒµå°¸å¤§å†›</h1><p>å¦‚æœæˆ‘ä»¬ä¸å‘ä½ å±•ç¤ºå¦‚ä½•æ˜¾ç¤ºä½ ä»åˆçº¦è·å–çš„æ•°æ®ï¼Œé‚£è¿™ä¸ªæ•™ç¨‹å°±å¤ªä¸å®Œæ•´äº†ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ è‚¯å®šæƒ³è¦åœ¨åº”ç”¨ä¸­ä½¿ç”¨è¯¸å¦‚ React æˆ– Vue.js è¿™æ ·çš„å‰ç«¯æ¡†æ¶æ¥è®©ä½ çš„å‰ç«¯å¼€å‘å˜å¾—è½»æ¾ä¸€äº›ã€‚ä¸è¿‡è¦æ•™æˆ React æˆ–è€… Vue.js çŸ¥è¯†çš„è¯ï¼Œå°±å¤§å¤§è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒç•´â€”â€”å®ƒä»¬æœ¬èº«å°±éœ€è¦å‡ èŠ‚è¯¾ç”šè‡³ä¸€æ•´ä¸ªæ•™ç¨‹æ¥æ•™å­¦ã€‚</p>
<p>æ‰€ä»¥ä¸ºäº†è®© CryptoZombies.io ä¸“æ³¨äºä»¥å¤ªåŠå’Œæ™ºèƒ½åˆçº¦ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ JQuery æ¥åšä¸€ä¸ªå¿«é€Ÿç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•è§£æå’Œå±•ç¤ºä»æ™ºèƒ½åˆçº¦ä¸­æ‹¿åˆ°çš„æ•°æ®ã€‚</p>
<h2 id="æ˜¾ç¤ºåƒµå°¸æ•°æ®-â€”-ä¸€ä¸ªç²—ç•¥çš„ä¾‹å­"><a href="#æ˜¾ç¤ºåƒµå°¸æ•°æ®-â€”-ä¸€ä¸ªç²—ç•¥çš„ä¾‹å­" class="headerlink" title="æ˜¾ç¤ºåƒµå°¸æ•°æ® â€” ä¸€ä¸ªç²—ç•¥çš„ä¾‹å­"></a>æ˜¾ç¤ºåƒµå°¸æ•°æ® â€” ä¸€ä¸ªç²—ç•¥çš„ä¾‹å­</h2><p>æˆ‘ä»¬å·²ç»åœ¨ä»£ç ä¸­æ·»åŠ äº†ä¸€ä¸ªç©ºçš„ä»£ç å— <code>&lt;div id=&quot;zombies&quot;&gt;&lt;/div&gt;</code>ï¼Œ åœ¨ <code>displayZombies</code> æ–¹æ³•ä¸­ä¹ŸåŒæ ·æœ‰ä¸€ä¸ªã€‚</p>
<p>å›å¿†ä¸€ä¸‹åœ¨ä¹‹å‰ç« èŠ‚ä¸­æˆ‘ä»¬åœ¨ <code>startApp()</code> æ–¹æ³•å†…éƒ¨è°ƒç”¨äº† <code>displayZombies</code> å¹¶ä¼ å…¥äº† <code>call</code> <code>getZombiesByOwner</code> è·å¾—çš„ç»“æœï¼Œå®ƒå°†è¢«ä¼ å…¥ä¸€ä¸ªåƒµå°¸IDæ•°ç»„ï¼Œåƒè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[0, 13, 47]</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„ <code>displayZombies</code> æ–¹æ³•åšè¿™äº›äº‹:</p>
<ol>
<li>é¦–å…ˆæ¸…é™¤ <code>#zombies</code> çš„å†…å®¹ä»¥é˜²é‡Œé¢å·²ç»æœ‰ä»€ä¹ˆå†…å®¹ï¼ˆè¿™æ ·å½“ç”¨æˆ·åˆ‡æ¢è´¦å·çš„æ—¶å€™ï¼Œä¹‹å‰è´¦å·çš„åƒµå°¸å¤§å†›æ•°æ®å°±ä¼šè¢«æ¸…é™¤ï¼‰</li>
<li>å¾ªç¯éå† <code>id</code>ï¼Œå¯¹æ¯ä¸€ä¸ªidè°ƒç”¨ <code>getZombieDetails(id)</code>ï¼Œ ä»æˆ‘ä»¬çš„åˆçº¦ä¸­è·å¾—è¿™ä¸ªåƒµå°¸çš„æ•°æ®ã€‚</li>
<li>å°†è·å¾—çš„åƒµå°¸æ•°æ®æ”¾è¿›ä¸€ä¸ªHTMLæ¨¡æ¿ä¸­ä»¥æ ¼å¼åŒ–æ˜¾ç¤ºï¼Œè¿½åŠ è¿› <code>#zombies</code> é‡Œé¢ã€‚</li>
</ol>
<p>å†æ¬¡å£°æ˜ï¼Œæˆ‘ä»¬åªç”¨äº† JQueryï¼Œæ²¡æœ‰ä»»ä½•æ¨¡æ¿å¼•æ“ï¼Œæ‰€ä»¥ä¼šéå¸¸ä¸‘ã€‚ä¸è¿‡è¿™åªæ˜¯ä¸€ä¸ªå¦‚ä½•å±•ç¤ºåƒµå°¸æ•°æ®çš„ç¤ºä¾‹è€Œå·²ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨åˆçº¦ä¸­æŸ¥æ‰¾åƒµå°¸æ•°æ®ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡</span><br><span class="line">getZombieDetails(id)</span><br><span class="line">.then(function(zombie) &#123;</span><br><span class="line">  // ç”¨ ES6 çš„æ¨¡æ¿è¯­æ³•æ¥å‘HTMLä¸­æ³¨å…¥å˜é‡</span><br><span class="line">  // æŠŠæ¯ä¸€ä¸ªéƒ½è¿½åŠ è¿› #zombies div</span><br><span class="line">  $(&quot;#zombies&quot;).append(`&lt;div class=&quot;zombie&quot;&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;Name: $&#123;zombie.name&#125;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;DNA: $&#123;zombie.dna&#125;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;Level: $&#123;zombie.level&#125;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;Wins: $&#123;zombie.winCount&#125;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;Losses: $&#123;zombie.lossCount&#125;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;Ready Time: $&#123;zombie.readyTime&#125;&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;`);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="å¦‚ä½•æ¥å±•ç¤ºåƒµå°¸å…ƒç´ å‘¢ï¼Ÿ"><a href="#å¦‚ä½•æ¥å±•ç¤ºåƒµå°¸å…ƒç´ å‘¢ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ¥å±•ç¤ºåƒµå°¸å…ƒç´ å‘¢ï¼Ÿ"></a>å¦‚ä½•æ¥å±•ç¤ºåƒµå°¸å…ƒç´ å‘¢ï¼Ÿ</h2><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°ç”¨å­—ç¬¦ä¸²æ¥æ˜¾ç¤º DNAã€‚ä¸è¿‡åœ¨ä½ çš„ DApp ä¸­ï¼Œä½ å°†éœ€è¦æŠŠ DNA è½¬æ¢æˆå›¾ç‰‡æ¥æ˜¾ç¤ºä½ çš„åƒµå°¸ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡æŠŠ DNA å­—ç¬¦ä¸²åˆ†å‰²æˆå°çš„å­—ç¬¦ä¸²æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ¯2ä½æ•°å­—ä»£è¡¨ä¸€ä¸ªå›¾ç‰‡ï¼Œç±»ä¼¼è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å¾—åˆ°ä¸€ä¸ª 1-7 çš„æ•°å­—æ¥è¡¨ç¤ºåƒµå°¸çš„å¤´:</span><br><span class="line">var head = parseInt(zombie.dna.substring(0, 2)) % 7 + 1</span><br><span class="line"></span><br><span class="line">// æˆ‘ä»¬æœ‰7å¼ å¤´éƒ¨å›¾ç‰‡ï¼š</span><br><span class="line">var headSrc = &quot;../assets/zombieparts/head-&quot; + i + &quot;.png&quot;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€ä¸ªæ¨¡å—éƒ½ç”¨ CSS ç»å¯¹å®šä½æ¥æ˜¾ç¤ºï¼Œåœ¨ä¸€ä¸ªä¸Šé¢å åŠ å¦å¤–ä¸€ä¸ªã€‚</p>
<p>å¦‚æœä½ æƒ³çœ‹æˆ‘ä»¬çš„å…·ä½“å®ç°ï¼Œæˆ‘ä»¬å°†ç”¨æ¥å±•ç¤ºåƒµå°¸å½¢è±¡çš„ Vue.js æ¨¡å—å¼€æºäº†ï¼š <a href="https://github.com/loomnetwork/zombie-char-component" target="_blank" rel="noopener">ç‚¹å‡»è¿™é‡Œ</a>.</p>
<p>ä¸è¿‡ï¼Œå› ä¸ºé‚£ä¸ªæ–‡ä»¶ä¸­æœ‰å¤ªå¤šè¡Œä»£ç ï¼Œ è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„è®¨è®ºèŒƒå›´ã€‚æˆ‘ä»¬ä¾ç„¶è¿˜æ˜¯ä½¿ç”¨ä¸Šé¢è¶…çº§ç®€å•çš„ JQuery å®ç°ï¼ŒæŠŠç¾åŒ–åƒµå°¸çš„å·¥ä½œä½œä¸ºå®¶åº­ä½œä¸šç•™ç»™ä½ äº†ğŸ˜‰</p>
<h2 id="å®æˆ˜æ¼”ä¹ -5"><a href="#å®æˆ˜æ¼”ä¹ -5" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬ä¸ºä½ åˆ›å»ºäº†ä¸€ä¸ªç©ºçš„ <code>displayZombies</code> æ–¹æ³•ã€‚æ¥ä¸€èµ·å®ç°å®ƒã€‚</p>
<ol>
<li>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ¸…ç©º <code>#zombies</code> çš„å†…å®¹ã€‚ ç”¨JQueryï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š <code>$(&quot;#zombies&quot;).empty();</code>ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦å¾ªç¯éå†æ‰€æœ‰çš„ idï¼Œå¾ªç¯è¿™æ ·ç”¨ï¼š <code>for (id of ids) {</code></li>
<li>åœ¨å¾ªç¯å†…éƒ¨ï¼Œå¤åˆ¶ç²˜è´´ä¸Šé¢çš„ä»£ç ï¼Œå¯¹æ¯ä¸€ä¸ªidè°ƒç”¨ <code>getZombieDetails(id)</code>ï¼Œç„¶åç”¨ <code>$(&quot;#zombies&quot;).append(...)</code> æŠŠå†…å®¹è¿½åŠ è¿›æˆ‘ä»¬çš„ HTML é‡Œé¢ã€‚</li>
</ol>
<h2 id="é¡µé¢ä¿®æ”¹-4"><a href="#é¡µé¢ä¿®æ”¹-4" class="headerlink" title="é¡µé¢ä¿®æ”¹"></a>é¡µé¢ä¿®æ”¹</h2><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"cryptozombies_abi.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"zombies"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> cryptoZombies;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> userAccount;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">startApp</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"YOUR_CONTRACT_ADDRESS"</span>;</span></span><br><span class="line"><span class="actionscript">        cryptoZombies = <span class="keyword">new</span> web3js.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> accountInterval = setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Check if account has changed</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (web3.eth.accounts[<span class="number">0</span>] !== userAccount) &#123;</span></span><br><span class="line">            userAccount = web3.eth.accounts[0];</span><br><span class="line"><span class="actionscript">            <span class="comment">// Call a function to update the UI with the new account</span></span></span><br><span class="line">            getZombiesByOwner(userAccount)</span><br><span class="line"><span class="vbscript">            .<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, 100);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">displayZombies</span><span class="params">(ids)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// Start here</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#zombies"</span>).empty();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (id <span class="keyword">of</span> ids) &#123;</span></span><br><span class="line"><span class="actionscript">          getZombieDetails(id).then(<span class="function"><span class="keyword">function</span><span class="params">(zombie)</span> </span>&#123;</span></span><br><span class="line"><span class="vbscript">                        $(<span class="string">"#zombies"</span>).append(`&lt;div <span class="keyword">class</span>=<span class="string">"zombie"</span>&gt;</span></span><br><span class="line"><span class="handlebars"><span class="xml">              <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Name: $&#123;zombie.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>DNA: $&#123;zombie.dna&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Level: $&#123;zombie.level&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Wins: $&#123;zombie.winCount&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Losses: $&#123;zombie.lossCount&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Ready Time: $&#123;zombie.readyTime&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">              <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`);</span></span></span><br><span class="line">          &#125;); </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombieDetails</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombies(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">zombieToOwner</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombieToOwner(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombiesByOwner</span><span class="params">(owner)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.getZombiesByOwner(owner).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Checking if Web3 has been injected by the browser (Mist/MetaMask)</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Use Mist/MetaMask's provider</span></span></span><br><span class="line"><span class="actionscript">          web3js = <span class="keyword">new</span> Web3(web3.currentProvider);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Handle the case where the user doesn't have Metamask installed</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Probably show them a message prompting them to install Metamask</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Now you can start your app &amp; access web3 freely:</span></span></span><br><span class="line">        startApp()</span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="å‘é€äº‹åŠ¡"><a href="#å‘é€äº‹åŠ¡" class="headerlink" title="å‘é€äº‹åŠ¡"></a>å‘é€äº‹åŠ¡</h1><p>è¿™ä¸‹æˆ‘ä»¬çš„ç•Œé¢èƒ½æ£€æµ‹ç”¨æˆ·çš„ MetaMask è´¦æˆ·ï¼Œå¹¶è‡ªåŠ¨åœ¨é¦–é¡µæ˜¾ç¤ºå®ƒä»¬çš„åƒµå°¸å¤§å†›äº†ï¼Œæœ‰æ²¡æœ‰å¾ˆæ£’ï¼Ÿ</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ç”¨ <code>send</code> å‡½æ•°æ¥ä¿®æ”¹æˆ‘ä»¬æ™ºèƒ½åˆçº¦é‡Œé¢çš„æ•°æ®ã€‚</p>
<p>ç›¸å¯¹ <code>call</code> å‡½æ•°ï¼Œ<code>send</code> å‡½æ•°æœ‰å¦‚ä¸‹ä¸»è¦åŒºåˆ«:</p>
<ol>
<li><p><code>send</code> ä¸€ä¸ªäº‹åŠ¡éœ€è¦ä¸€ä¸ª <code>from</code> åœ°å€æ¥è¡¨æ˜è°åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯ä½  Solidity ä»£ç é‡Œçš„ <code>msg.sender</code> )ã€‚ æˆ‘ä»¬éœ€è¦è¿™æ˜¯æˆ‘ä»¬ DApp çš„ç”¨æˆ·ï¼Œè¿™æ ·ä¸€æ¥ MetaMask æ‰ä¼šå¼¹å‡ºæç¤ºè®©ä»–ä»¬å¯¹äº‹åŠ¡ç­¾åã€‚</p>
</li>
<li><p><code>send</code> ä¸€ä¸ªäº‹åŠ¡å°†èŠ±è´¹ gas</p>
</li>
<li><p>åœ¨ç”¨æˆ· <code>send</code> ä¸€ä¸ªäº‹åŠ¡åˆ°è¯¥äº‹åŠ¡å¯¹åŒºå—é“¾äº§ç”Ÿå®é™…å½±å“ä¹‹é—´æœ‰ä¸€ä¸ªä¸å¯å¿½ç•¥çš„å»¶è¿Ÿã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¿…é¡»ç­‰å¾…äº‹åŠ¡è¢«åŒ…å«è¿›ä¸€ä¸ªåŒºå—é‡Œï¼Œä»¥å¤ªåŠä¸Šä¸€ä¸ªåŒºå—çš„æ—¶é—´å¹³å‡ä¸‹æ¥æ˜¯15ç§’å·¦å³ã€‚å¦‚æœå½“å‰åœ¨ä»¥å¤ªåŠä¸Šæœ‰å¤§é‡æŒ‚èµ·äº‹åŠ¡æˆ–è€…ç”¨æˆ·å‘é€äº†è¿‡ä½çš„ gas ä»·æ ¼ï¼Œæˆ‘ä»¬çš„äº‹åŠ¡å¯èƒ½éœ€è¦ç­‰å¾…æ•°ä¸ªåŒºå—æ‰èƒ½è¢«åŒ…å«è¿›å»ï¼Œå¾€å¾€å¯èƒ½èŠ±è´¹æ•°åˆ†é’Ÿã€‚</p>
<p>æ‰€ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­æˆ‘ä»¬éœ€è¦ç¼–å†™é€»è¾‘æ¥å¤„ç†è¿™éƒ¨åˆ†å¼‚æ­¥ç‰¹æ€§ã€‚</p>
</li>
</ol>
<h2 id="ç”Ÿæˆä¸€ä¸ªåƒµå°¸"><a href="#ç”Ÿæˆä¸€ä¸ªåƒµå°¸" class="headerlink" title="ç”Ÿæˆä¸€ä¸ªåƒµå°¸"></a>ç”Ÿæˆä¸€ä¸ªåƒµå°¸</h2><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªåˆçº¦ä¸­ä¸€ä¸ªæ–°ç”¨æˆ·å°†è¦è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‡½æ•°: <code>createRandomZombie</code>.</p>
<p>ä½œä¸ºå¤ä¹ ï¼Œè¿™é‡Œæ˜¯åˆçº¦ä¸­çš„ Solidity ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function createRandomZombie(string _name) public &#123;</span><br><span class="line">  require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">  uint randDna = _generateRandomDna(_name);</span><br><span class="line">  randDna = randDna - randDna % 100;</span><br><span class="line">  _createZombie(_name, randDna);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å¦‚ä½•åœ¨ç”¨ MetaMask åœ¨ Web3.js ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„ç¤ºä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function createRandomZombie(name) &#123;</span><br><span class="line">  // è¿™å°†éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥åœ¨ç•Œé¢ä¸­å‘Šè¯‰ç”¨æˆ·è¿™ä¸€ç‚¹</span><br><span class="line">  // äº‹åŠ¡è¢«å‘é€å‡ºå»äº†</span><br><span class="line">  $(&quot;#txStatus&quot;).text(&quot;æ­£åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºåƒµå°¸ï¼Œè¿™å°†éœ€è¦ä¸€ä¼šå„¿...&quot;);</span><br><span class="line">  // æŠŠäº‹åŠ¡å‘é€åˆ°æˆ‘ä»¬çš„åˆçº¦:</span><br><span class="line">  return cryptoZombies.methods.createRandomZombie(name)</span><br><span class="line">  .send(&#123; from: userAccount &#125;)</span><br><span class="line">  .on(&quot;receipt&quot;, function(receipt) &#123;</span><br><span class="line">    $(&quot;#txStatus&quot;).text(&quot;æˆåŠŸç”Ÿæˆäº† &quot; + name + &quot;!&quot;);</span><br><span class="line">    // äº‹åŠ¡è¢«åŒºå—é“¾æ¥å—äº†ï¼Œé‡æ–°æ¸²æŸ“ç•Œé¢</span><br><span class="line">    getZombiesByOwner(userAccount).then(displayZombies);</span><br><span class="line">  &#125;)</span><br><span class="line">  .on(&quot;error&quot;, function(error) &#123;</span><br><span class="line">    // å‘Šè¯‰ç”¨æˆ·åˆçº¦å¤±è´¥äº†</span><br><span class="line">    $(&quot;#txStatus&quot;).text(error);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çš„å‡½æ•° <code>send</code> ä¸€ä¸ªäº‹åŠ¡åˆ°æˆ‘ä»¬çš„ Web3 æä¾›è€…ï¼Œç„¶åé“¾å¼æ·»åŠ ä¸€äº›äº‹ä»¶ç›‘å¬:</p>
<ul>
<li><code>receipt</code> å°†åœ¨åˆçº¦è¢«åŒ…å«è¿›ä»¥å¤ªåŠåŒºå—ä¸Šä»¥åè¢«è§¦å‘ï¼Œè¿™æ„å‘³ç€åƒµå°¸è¢«åˆ›å»ºå¹¶ä¿å­˜è¿›æˆ‘ä»¬çš„åˆçº¦äº†ã€‚</li>
<li><code>error</code> å°†åœ¨äº‹åŠ¡æœªè¢«æˆåŠŸåŒ…å«è¿›åŒºå—åè§¦å‘ï¼Œæ¯”å¦‚ç”¨æˆ·æœªæ”¯ä»˜è¶³å¤Ÿçš„ gasã€‚æˆ‘ä»¬éœ€è¦åœ¨ç•Œé¢ä¸­é€šçŸ¥ç”¨æˆ·äº‹åŠ¡å¤±è´¥ä»¥ä¾¿ä»–ä»¬å¯ä»¥å†æ¬¡å°è¯•ã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„:ä½ å¯ä»¥åœ¨è°ƒç”¨ <code>send</code> æ—¶é€‰æ‹©æŒ‡å®š <code>gas</code> å’Œ <code>gasPrice</code>ï¼Œ ä¾‹å¦‚ï¼š <code>.send({ from: userAccount, gas: 3000000 })</code>ã€‚å¦‚æœä½ ä¸æŒ‡å®šï¼ŒMetaMask å°†è®©ç”¨æˆ·è‡ªå·±é€‰æ‹©æ•°å€¼ã€‚</p>
</blockquote>
<h2 id="å®æˆ˜æ¼”ä¹ -6"><a href="#å®æˆ˜æ¼”ä¹ -6" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª<code>div</code>ï¼Œ æŒ‡å®š ID ä¸º <code>txStatus</code> â€” è¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ–°è¿™ä¸ª div æ¥é€šçŸ¥ç”¨æˆ·äº‹åŠ¡çš„çŠ¶æ€ã€‚</p>
<ol>
<li><p>åœ¨ <code>displayZombies</code>ä¸‹é¢ï¼Œ å¤åˆ¶ç²˜è´´ä¸Šé¢ <code>createRandomZombie</code> çš„ä»£ç ã€‚</p>
</li>
<li><p>æˆ‘ä»¬æ¥å®ç°å¦å¤–ä¸€ä¸ªå‡½æ•° <code>feedOnKitty</code>ï¼š</p>
<p>è°ƒç”¨ <code>feedOnKitty</code> çš„é€»è¾‘å‡ ä¹ä¸€æ · â€” æˆ‘ä»¬å°†å‘é€ä¸€ä¸ªäº‹åŠ¡æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æˆåŠŸçš„äº‹åŠ¡ä¼šä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåƒµå°¸ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›åœ¨æˆåŠŸåé‡æ–°ç»˜åˆ¶ç•Œé¢ã€‚</p>
<p>åœ¨ <code>createRandomZombie</code> ä¸‹é¢å¤åˆ¶ç²˜è´´å®ƒçš„ä»£ç ï¼Œæ”¹åŠ¨è¿™äº›åœ°æ–¹:</p>
<p>a) ç»™å…¶å‘½åä¸º <code>feedOnKitty</code>ï¼Œ å®ƒå°†æ¥æ”¶ä¸¤ä¸ªå‚æ•° <code>zombieId</code> å’Œ <code>kittyId</code></p>
<p>b) <code>#txStatus</code> çš„æ–‡æœ¬å†…å®¹å°†æ›´æ–°ä¸º: <code>&quot;æ­£åœ¨åƒçŒ«å’ªï¼Œè¿™å°†éœ€è¦ä¸€ä¼šå„¿...&quot;</code></p>
<p>c) è®©å…¶è°ƒç”¨æˆ‘ä»¬åˆçº¦é‡Œé¢çš„ <code>feedOnKitty</code> å‡½æ•°å¹¶ä¼ å…¥ç›¸åŒçš„å‚æ•°</p>
<p>d) <code>#txStatus</code> é‡Œé¢çš„çš„æˆåŠŸä¿¡æ¯åº”è¯¥æ˜¯ <code>&quot;åƒäº†ä¸€åªçŒ«å’ªå¹¶ç”Ÿæˆäº†ä¸€åªæ–°åƒµå°¸ï¼&quot;</code></p>
</li>
</ol>
<h2 id="é¡µé¢ä¿®æ”¹-5"><a href="#é¡µé¢ä¿®æ”¹-5" class="headerlink" title="é¡µé¢ä¿®æ”¹"></a>é¡µé¢ä¿®æ”¹</h2><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"cryptozombies_abi.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"txStatus"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"zombies"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> cryptoZombies;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> userAccount;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">startApp</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"YOUR_CONTRACT_ADDRESS"</span>;</span></span><br><span class="line"><span class="actionscript">        cryptoZombies = <span class="keyword">new</span> web3js.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> accountInterval = setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Check if account has changed</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (web3.eth.accounts[<span class="number">0</span>] !== userAccount) &#123;</span></span><br><span class="line">            userAccount = web3.eth.accounts[0];</span><br><span class="line"><span class="actionscript">            <span class="comment">// Call a function to update the UI with the new account</span></span></span><br><span class="line">            getZombiesByOwner(userAccount)</span><br><span class="line"><span class="vbscript">            .<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, 100);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">displayZombies</span><span class="params">(ids)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#zombies"</span>).empty();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (id <span class="keyword">of</span> ids) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Look up zombie details from our contract. Returns a `zombie` object</span></span></span><br><span class="line">          getZombieDetails(id)</span><br><span class="line"><span class="actionscript">          .then(<span class="function"><span class="keyword">function</span><span class="params">(zombie)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// Using ES6's "template literals" to inject variables into the HTML.</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// Append each one to our #zombies div</span></span></span><br><span class="line"><span class="vbscript">            $(<span class="string">"#zombies"</span>).append(`&lt;div <span class="keyword">class</span>=<span class="string">"zombie"</span>&gt;</span></span><br><span class="line"><span class="handlebars"><span class="xml">              <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Name: $&#123;zombie.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>DNA: $&#123;zombie.dna&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Level: $&#123;zombie.level&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Wins: $&#123;zombie.winCount&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Losses: $&#123;zombie.lossCount&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Ready Time: $&#123;zombie.readyTime&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">              <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`);</span></span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="comment">// Start here</span></span></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">createRandomZombie</span><span class="params">(name)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// è¿™å°†éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥åœ¨ç•Œé¢ä¸­å‘Šè¯‰ç”¨æˆ·è¿™ä¸€ç‚¹</span></span></span><br><span class="line"><span class="actionscript">  <span class="comment">// äº‹åŠ¡è¢«å‘é€å‡ºå»äº†</span></span></span><br><span class="line"><span class="javascript">  $(<span class="string">"#txStatus"</span>).text(<span class="string">"æ­£åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºåƒµå°¸ï¼Œè¿™å°†éœ€è¦ä¸€ä¼šå„¿..."</span>);</span></span><br><span class="line"><span class="actionscript">  <span class="comment">// æŠŠäº‹åŠ¡å‘é€åˆ°æˆ‘ä»¬çš„åˆçº¦:</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">return</span> cryptoZombies.methods.createRandomZombie(name)</span></span><br><span class="line">  .send(&#123; from: userAccount &#125;)</span><br><span class="line"><span class="actionscript">  .on(<span class="string">"receipt"</span>, <span class="function"><span class="keyword">function</span><span class="params">(receipt)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#txStatus"</span>).text(<span class="string">"æˆåŠŸç”Ÿæˆäº† "</span> + name + <span class="string">"!"</span>);</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// äº‹åŠ¡è¢«åŒºå—é“¾æ¥å—äº†ï¼Œé‡æ–°æ¸²æŸ“ç•Œé¢</span></span></span><br><span class="line"><span class="vbscript">    getZombiesByOwner(userAccount).<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line">  &#125;)</span><br><span class="line"><span class="actionscript">  .on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span><span class="params">(error)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// å‘Šè¯‰ç”¨æˆ·åˆçº¦å¤±è´¥äº†</span></span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#txStatus"</span>).text(error);</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">feedOnKitty</span><span class="params">(zombieId, kittyId)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">  $(<span class="string">"#txStatus"</span>).text(<span class="string">"æ­£åœ¨åƒçŒ«å’ªï¼Œè¿™å°†éœ€è¦ä¸€ä¼šå„¿..."</span>);</span></span><br><span class="line"><span class="actionscript">  <span class="keyword">return</span> cryptoZombies.methods.feedOnKitty(zombieId, kittyId)</span></span><br><span class="line">  .send(&#123; from: userAccount &#125;)</span><br><span class="line"><span class="actionscript">  .on(<span class="string">"receipt"</span>, <span class="function"><span class="keyword">function</span><span class="params">(receipt)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#txStatus"</span>).text(<span class="string">"åƒäº†ä¸€åªçŒ«å’ªå¹¶ç”Ÿæˆäº†ä¸€åªæ–°åƒµå°¸ï¼"</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="comment">// äº‹åŠ¡è¢«åŒºå—é“¾æ¥å—äº†ï¼Œé‡æ–°æ¸²æŸ“ç•Œé¢</span></span></span><br><span class="line"><span class="vbscript">    getZombiesByOwner(userAccount).<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line">  &#125;)</span><br><span class="line"><span class="actionscript">  .on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span><span class="params">(error)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// å‘Šè¯‰ç”¨æˆ·åˆçº¦å¤±è´¥äº†</span></span></span><br><span class="line"><span class="javascript">    $(<span class="string">"#txStatus"</span>).text(error);</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombieDetails</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombies(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">zombieToOwner</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombieToOwner(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombiesByOwner</span><span class="params">(owner)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.getZombiesByOwner(owner).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Checking if Web3 has been injected by the browser (Mist/MetaMask)</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Use Mist/MetaMask's provider</span></span></span><br><span class="line"><span class="actionscript">          web3js = <span class="keyword">new</span> Web3(web3.currentProvider);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Handle the case where the user doesn't have Metamask installed</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Probably show them a message prompting them to install Metamask</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Now you can start your app &amp; access web3 freely:</span></span></span><br><span class="line">        startApp()</span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="è°ƒç”¨-Payable-å‡½æ•°"><a href="#è°ƒç”¨-Payable-å‡½æ•°" class="headerlink" title="è°ƒç”¨ Payable å‡½æ•°"></a>è°ƒç”¨ Payable å‡½æ•°</h1><p><code>attack</code>, <code>changeName</code>, ä»¥åŠ <code>changeDna</code> çš„é€»è¾‘å°†éå¸¸é›·åŒï¼Œæ‰€ä»¥æœ¬è¯¾å°†ä¸ä¼šèŠ±æ—¶é—´åœ¨ä¸Šé¢ã€‚</p>
<blockquote>
<p>å®é™…ä¸Šï¼Œåœ¨è°ƒç”¨è¿™äº›å‡½æ•°çš„æ—¶å€™å·²ç»æœ‰äº†éå¸¸å¤šçš„é‡å¤é€»è¾‘ã€‚æ‰€ä»¥æœ€å¥½æ˜¯é‡æ„ä»£ç æŠŠç›¸åŒçš„ä»£ç å†™æˆä¸€ä¸ªå‡½æ•°ã€‚ï¼ˆå¹¶å¯¹<code>txStatus</code>ä½¿ç”¨æ¨¡æ¿ç³»ç»Ÿâ€”â€”æˆ‘ä»¬å·²ç»çœ‹åˆ°ç”¨ç±»ä¼¼ Vue.js ç±»çš„æ¡†æ¶æ˜¯å¤šä¹ˆæ•´æ´ï¼‰</p>
</blockquote>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦å¤–ä¸€ç§ Web3.js ä¸­éœ€è¦ç‰¹æ®Šå¯¹å¾…çš„å‡½æ•° â€” <code>payable</code> å‡½æ•°ã€‚</p>
<h2 id="å‡çº§ï¼"><a href="#å‡çº§ï¼" class="headerlink" title="å‡çº§ï¼"></a>å‡çº§ï¼</h2><p>å›å¿†ä¸€ä¸‹åœ¨ <code>ZombieHelper</code> é‡Œé¢ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª payable å‡½æ•°ï¼Œç”¨æˆ·å¯ä»¥ç”¨æ¥å‡çº§:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function levelUp(uint _zombieId) external payable &#123;</span><br><span class="line">  require(msg.value == levelUpFee);</span><br><span class="line">  zombies[_zombieId].level++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å’Œå‡½æ•°ä¸€èµ·å‘é€ä»¥å¤ªéå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼š æˆ‘ä»¬éœ€è¦æŒ‡å®šå‘é€å¤šå°‘ <code>wei</code>ï¼Œè€Œä¸æ˜¯ä»¥å¤ªã€‚</p>
<h2 id="å•¥æ˜¯-Wei"><a href="#å•¥æ˜¯-Wei" class="headerlink" title="å•¥æ˜¯ Wei?"></a>å•¥æ˜¯ Wei?</h2><p>ä¸€ä¸ª <code>wei</code> æ˜¯ä»¥å¤ªçš„æœ€å°å•ä½ â€” 1 <code>ether</code> ç­‰äº 10^18 <code>wei</code></p>
<p>å¤ªå¤š0è¦æ•°äº†ï¼Œä¸è¿‡å¹¸è¿çš„æ˜¯ Web3.js æœ‰ä¸€ä¸ªè½¬æ¢å·¥å…·æ¥å¸®æˆ‘ä»¬åšè¿™ä»¶äº‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// æŠŠ 1 ETH è½¬æ¢æˆ Wei</span><br><span class="line">web3js.utils.toWei(&quot;1&quot;, &quot;ether&quot;);</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬çš„ DApp é‡Œï¼Œ æˆ‘ä»¬è®¾ç½®äº† <code>levelUpFee = 0.001 ether</code>ï¼Œæ‰€ä»¥è°ƒç”¨ <code>levelUp</code> æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç”¨æˆ·ç”¨ä»¥ä¸‹çš„ä»£ç åŒæ—¶å‘é€ <code>0.001</code> ä»¥å¤ª:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cryptoZombies.methods.levelUp(zombieId)</span><br><span class="line">.send(&#123; from: userAccount, value: web3js.utils.toWei(&quot;0.001&quot;,&quot;ether&quot;) &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="å®æˆ˜æ¼”ä¹ -7"><a href="#å®æˆ˜æ¼”ä¹ -7" class="headerlink" title="å®æˆ˜æ¼”ä¹ "></a>å®æˆ˜æ¼”ä¹ </h2><p>åœ¨ <code>feedOnKitty</code> ä¸‹é¢æ·»åŠ ä¸€ä¸ª <code>levelUp</code> æ–¹æ³•ã€‚ä»£ç å’Œ <code>feedOnKitty</code> å°†éå¸¸ç›¸ä¼¼ã€‚ä¸è¿‡ï¼š</p>
<ol>
<li>å‡½æ•°å°†æ¥æ”¶ä¸€ä¸ªå‚æ•°, <code>zombieId</code></li>
<li>åœ¨å‘é€äº‹åŠ¡ä¹‹å‰ï¼Œ<code>txStatus</code> çš„æ–‡æœ¬åº”è¯¥æ˜¯ <code>&quot;æ­£åœ¨å‡çº§æ‚¨çš„åƒµå°¸...&quot;</code></li>
<li>å½“å®ƒè°ƒç”¨åˆçº¦é‡Œçš„<code>levelUp</code>æ—¶ï¼Œå®ƒåº”è¯¥å‘é€<code>&quot;0.001&quot;</code> ETHï¼Œå¹¶ç”¨ <code>toWei</code> è½¬æ¢ï¼Œå¦‚åŒä¸Šé¢ä¾‹å­é‡Œé‚£æ ·ã€‚</li>
<li>æˆåŠŸä¹‹ååº”è¯¥æ˜¾ç¤º <code>&quot;ä¸å¾—äº†äº†ï¼åƒµå°¸æˆåŠŸå‡çº§å•¦ï¼&quot;</code></li>
<li>æˆ‘ä»¬ <strong>ä¸</strong> éœ€è¦åœ¨è°ƒç”¨ <code>getZombiesByOwner</code> åé‡æ–°ç»˜åˆ¶ç•Œé¢ â€” å› ä¸ºåœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯ä¿®æ”¹äº†åƒµå°¸çš„çº§åˆ«è€Œå·²ã€‚</li>
</ol>
<h2 id="é¡µé¢ä¿®æ”¹-6"><a href="#é¡µé¢ä¿®æ”¹-6" class="headerlink" title="é¡µé¢ä¿®æ”¹"></a>é¡µé¢ä¿®æ”¹</h2><p>index.html</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;CryptoZombies front-end&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script language="javascript" type="text/</span>javascript<span class="string">" src="</span>https:<span class="comment">//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"&gt;&lt;/script&gt;</span></span><br><span class="line">    &lt;script language=<span class="string">"javascript"</span> type=<span class="string">"text/javascript"</span> src=<span class="string">"web3.min.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">    &lt;script language=<span class="string">"javascript"</span> type=<span class="string">"text/javascript"</span> src=<span class="string">"cryptozombies_abi.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">  &lt;<span class="regexp">/head&gt;</span></span><br><span class="line"><span class="regexp">  &lt;body&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div id="txStatus"&gt;&lt;/</span>div&gt;</span><br><span class="line">    &lt;div id=<span class="string">"zombies"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      <span class="keyword">var</span> cryptoZombies;</span><br><span class="line">      <span class="keyword">var</span> userAccount;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">startApp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"YOUR_CONTRACT_ADDRESS"</span>;</span><br><span class="line">        cryptoZombies = <span class="keyword">new</span> web3js.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> accountInterval = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="comment">// Check if account has changed</span></span><br><span class="line">          <span class="keyword">if</span> (web3.eth.accounts[<span class="number">0</span>] !== userAccount) &#123;</span><br><span class="line">            userAccount = web3.eth.accounts[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// Call a function to update the UI with the new account</span></span><br><span class="line">            getZombiesByOwner(userAccount)</span><br><span class="line">            .then(displayZombies);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">displayZombies</span>(<span class="params">ids</span>) </span>&#123;</span><br><span class="line">        $(<span class="string">"#zombies"</span>).empty();</span><br><span class="line">        <span class="keyword">for</span> (id <span class="keyword">of</span> ids) &#123;</span><br><span class="line">          <span class="comment">// Look up zombie details from our contract. Returns a `zombie` object</span></span><br><span class="line">          getZombieDetails(id)</span><br><span class="line">          .then(<span class="function"><span class="keyword">function</span>(<span class="params">zombie</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// Using ES6's "template literals" to inject variables into the HTML.</span></span><br><span class="line">            <span class="comment">// Append each one to our #zombies div</span></span><br><span class="line">            $(<span class="string">"#zombies"</span>).append(<span class="string">`&lt;div class="zombie"&gt;</span></span><br><span class="line"><span class="string">              &lt;ul&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;Name: <span class="subst">$&#123;zombie.name&#125;</span>&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;DNA: <span class="subst">$&#123;zombie.dna&#125;</span>&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;Level: <span class="subst">$&#123;zombie.level&#125;</span>&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;Wins: <span class="subst">$&#123;zombie.winCount&#125;</span>&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;Losses: <span class="subst">$&#123;zombie.lossCount&#125;</span>&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;Ready Time: <span class="subst">$&#123;zombie.readyTime&#125;</span>&lt;/li&gt;</span></span><br><span class="line"><span class="string">              &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;`</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">createRandomZombie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// This is going to take a while, so update the UI to let the user know</span></span><br><span class="line">        <span class="comment">// the transaction has been sent</span></span><br><span class="line">        $(<span class="string">"#txStatus"</span>).text(<span class="string">"Creating new zombie on the blockchain. This may take a while..."</span>);</span><br><span class="line">        <span class="comment">// Send the tx to our contract:</span></span><br><span class="line">        <span class="keyword">return</span> cryptoZombies.methods.createRandomZombie(name)</span><br><span class="line">        .send(&#123; <span class="attr">from</span>: userAccount &#125;)</span><br><span class="line">        .on(<span class="string">"receipt"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>) </span>&#123;</span><br><span class="line">          $(<span class="string">"#txStatus"</span>).text(<span class="string">"Successfully created "</span> + name + <span class="string">"!"</span>);</span><br><span class="line">          <span class="comment">// Transaction was accepted into the blockchain, let's redraw the UI</span></span><br><span class="line">          getZombiesByOwner(userAccount).then(displayZombies);</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// Do something to alert the user their transaction has failed</span></span><br><span class="line">          $(<span class="string">"#txStatus"</span>).text(error);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">feedOnKitty</span>(<span class="params">zombieId, kittyId</span>) </span>&#123;</span><br><span class="line">        $(<span class="string">"#txStatus"</span>).text(<span class="string">"Eating a kitty. This may take a while..."</span>);</span><br><span class="line">        <span class="keyword">return</span> cryptoZombies.methods.feedOnKitty(zombieId, kittyId)</span><br><span class="line">        .send(&#123; <span class="attr">from</span>: userAccount &#125;)</span><br><span class="line">        .on(<span class="string">"receipt"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>) </span>&#123;</span><br><span class="line">          $(<span class="string">"#txStatus"</span>).text(<span class="string">"Ate a kitty and spawned a new Zombie!"</span>);</span><br><span class="line">          getZombiesByOwner(userAccount).then(displayZombies);</span><br><span class="line">        &#125;)</span><br><span class="line">        .on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">          $(<span class="string">"#txStatus"</span>).text(error);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Start here</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">levelUp</span>(<span class="params">zombieId</span>) </span>&#123;</span><br><span class="line">         $(<span class="string">"#txStatus"</span>).text(<span class="string">"æ­£åœ¨å‡çº§æ‚¨çš„åƒµå°¸..."</span>);</span><br><span class="line">         <span class="keyword">return</span> cryptoZombies.methods.levelUp(zombieId)</span><br><span class="line">         .send(&#123; <span class="attr">from</span>: userAccount, <span class="attr">value</span>: web3js.utils.toWei(<span class="string">"0.001"</span>,<span class="string">"ether"</span>) &#125;)</span><br><span class="line">         .on(<span class="string">"receipt"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>) </span>&#123;</span><br><span class="line">         $(<span class="string">"#txStatus"</span>).text(<span class="string">"ä¸å¾—äº†äº†ï¼åƒµå°¸æˆåŠŸå‡çº§å•¦ï¼"</span>);</span><br><span class="line">         &#125;)</span><br><span class="line">         .on(<span class="string">"error"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">           $(<span class="string">"#txStatus"</span>).text(error);</span><br><span class="line">         &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">getZombieDetails</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cryptoZombies.methods.zombies(id).call()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">zombieToOwner</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cryptoZombies.methods.zombieToOwner(id).call()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">getZombiesByOwner</span>(<span class="params">owner</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cryptoZombies.methods.getZombiesByOwner(owner).call()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Checking if Web3 has been injected by the browser (Mist/MetaMask)</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">          <span class="comment">// Use Mist/MetaMask's provider</span></span><br><span class="line">          web3js = <span class="keyword">new</span> Web3(web3.currentProvider);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// Handle the case where the user doesn't have Metamask installed</span></span><br><span class="line">          <span class="comment">// Probably show them a message prompting them to install Metamask</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Now you can start your app &amp; access web3 freely:</span></span><br><span class="line">        startApp()</span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="è®¢é˜…äº‹ä»¶"><a href="#è®¢é˜…äº‹ä»¶" class="headerlink" title="è®¢é˜…äº‹ä»¶"></a>è®¢é˜…äº‹ä»¶</h1><p>å¦‚ä½ æ‰€è§ï¼Œé€šè¿‡ Web3.js å’Œåˆçº¦äº¤äº’éå¸¸ç®€å•ç›´æ¥â€”â€”ä¸€æ—¦ä½ çš„ç¯å¢ƒå»ºç«‹èµ·æ¥ï¼Œ <code>call</code> å‡½æ•°å’Œ <code>send</code> äº‹åŠ¡å’Œæ™®é€šçš„ç½‘ç»œAPIå¹¶æ²¡æœ‰å¤šå°‘ä¸åŒã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ä¸œè¥¿æˆ‘ä»¬æƒ³è¦è®²åˆ°â€”â€”è®¢é˜…åˆçº¦äº‹ä»¶</p>
<h2 id="ç›‘å¬æ–°åƒµå°¸äº‹ä»¶"><a href="#ç›‘å¬æ–°åƒµå°¸äº‹ä»¶" class="headerlink" title="ç›‘å¬æ–°åƒµå°¸äº‹ä»¶"></a>ç›‘å¬æ–°åƒµå°¸äº‹ä»¶</h2><p>å¦‚æœä½ è¿˜è®°å¾— <code>zombiefactory.sol</code>ï¼Œæ¯æ¬¡æ–°å»ºä¸€ä¸ªåƒµå°¸åï¼Œæˆ‘ä»¬ä¼šè§¦å‘ä¸€ä¸ª <code>NewZombie</code> äº‹ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event NewZombie(uint zombieId, string name, uint dna);</span><br></pre></td></tr></table></figure>

<p>åœ¨ Web3.jsé‡Œï¼Œ ä½ å¯ä»¥ <strong>è®¢é˜…</strong> ä¸€ä¸ªäº‹ä»¶ï¼Œè¿™æ ·ä½ çš„ Web3 æä¾›è€…å¯ä»¥åœ¨æ¯æ¬¡äº‹ä»¶å‘ç”Ÿåè§¦å‘ä½ çš„ä¸€äº›ä»£ç é€»è¾‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cryptoZombies.events.NewZombie()</span><br><span class="line">.on(&quot;data&quot;, function(event) &#123;</span><br><span class="line">  let zombie = event.returnValues;</span><br><span class="line">  console.log(&quot;ä¸€ä¸ªæ–°åƒµå°¸è¯ç”Ÿäº†ï¼&quot;, zombie.zombieId, zombie.name, zombie.dna);</span><br><span class="line">&#125;).on(&apos;error&apos;, console.error);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™æ®µä»£ç å°†åœ¨ <strong>ä»»ä½•</strong> åƒµå°¸ç”Ÿæˆçš„æ—¶å€™æ¿€å‘ä¸€ä¸ªè­¦å‘Šä¿¡æ¯â€”â€”è€Œä¸ä»…ä»…æ˜¯å½“å‰ç”¨ç”¨æˆ·çš„åƒµå°¸ã€‚å¦‚æœæˆ‘ä»¬åªæƒ³å¯¹å½“å‰ç”¨æˆ·å‘å‡ºæé†’å‘¢ï¼Ÿ</p>
<h2 id="ä½¿ç”¨-indexed"><a href="#ä½¿ç”¨-indexed" class="headerlink" title="ä½¿ç”¨ indexed"></a>ä½¿ç”¨ <code>indexed</code></h2><p>ä¸ºäº†ç­›é€‰ä»…å’Œå½“å‰ç”¨æˆ·ç›¸å…³çš„äº‹ä»¶ï¼Œæˆ‘ä»¬çš„ Solidity åˆçº¦å°†å¿…é¡»ä½¿ç”¨ <code>indexed</code> å…³é”®å­—ï¼Œå°±åƒæˆ‘ä»¬åœ¨ ERC721 å®ç°ä¸­çš„<code>Transfer</code> äº‹ä»¶ä¸­é‚£æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ å› ä¸º<code>_from</code> å’Œ <code>_to</code> éƒ½æ˜¯ <code>indexed</code>ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯äº‹ä»¶ç›‘å¬ä¸­è¿‡æ»¤äº‹ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cryptoZombies.events.Transfer(&#123; filter: &#123; _to: userAccount &#125; &#125;)</span><br><span class="line">.on(&quot;data&quot;, function(event) &#123;</span><br><span class="line">  let data = event.returnValues;</span><br><span class="line">  // å½“å‰ç”¨æˆ·æ›´æ–°äº†ä¸€ä¸ªåƒµå°¸ï¼æ›´æ–°ç•Œé¢æ¥æ˜¾ç¤º</span><br><span class="line">&#125;).on(&apos;error&apos;, console.error);</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°äº†å§ï¼Œ ä½¿ç”¨ <code>event</code> å’Œ <code>indexed</code> å­—æ®µå¯¹äºç›‘å¬åˆçº¦ä¸­çš„æ›´æ”¹å¹¶å°†å…¶åæ˜ åˆ° DApp çš„å‰ç«¯ç•Œé¢ä¸­æ˜¯éå¸¸æœ‰ç”¨çš„åšæ³•ã€‚</p>
<h2 id="æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶"><a href="#æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶" class="headerlink" title="æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶"></a>æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶</h2><p>æˆ‘ä»¬ç”šè‡³å¯ä»¥ç”¨ <code>getPastEvents</code> æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶ï¼Œå¹¶ç”¨è¿‡æ»¤å™¨ <code>fromBlock</code> å’Œ <code>toBlock</code> ç»™ Solidity ä¸€ä¸ªäº‹ä»¶æ—¥å¿—çš„æ—¶é—´èŒƒå›´(â€œblockâ€ åœ¨è¿™é‡Œä»£è¡¨ä»¥å¤ªåŠåŒºå—ç¼–å·ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cryptoZombies.getPastEvents(&quot;NewZombie&quot;, &#123; fromBlock: 0, toBlock: &apos;latest&apos; &#125;)</span><br><span class="line">.then(function(events) &#123;</span><br><span class="line">  // events æ˜¯å¯ä»¥ç”¨æ¥éå†çš„ `event` å¯¹è±¡ </span><br><span class="line">  // è¿™æ®µä»£ç å°†è¿”å›ç»™æˆ‘ä»¬ä»å¼€å§‹ä»¥æ¥åˆ›å»ºçš„åƒµå°¸åˆ—è¡¨</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºä½ å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥æŸ¥è¯¢ä»æœ€å¼€å§‹èµ·çš„äº‹ä»¶æ—¥å¿—ï¼Œè¿™å°±æœ‰äº†ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç”¨ä¾‹ï¼š <strong>ç”¨äº‹ä»¶æ¥ä½œä¸ºä¸€ç§æ›´ä¾¿å®œçš„å­˜å‚¨</strong>ã€‚</p>
<p>è‹¥ä½ è¿˜èƒ½è®°å¾—ï¼Œåœ¨åŒºå—é“¾ä¸Šä¿å­˜æ•°æ®æ˜¯ Solidity ä¸­æœ€è´µçš„æ“ä½œä¹‹ä¸€ã€‚ä½†æ˜¯ç”¨äº‹ä»¶å°±ä¾¿å®œå¤ªå¤šå¤ªå¤šäº†ã€‚</p>
<p>è¿™é‡Œçš„çŸ­æ¿æ˜¯ï¼Œäº‹ä»¶ä¸èƒ½ä»æ™ºèƒ½åˆçº¦æœ¬èº«è¯»å–ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æœ‰ä¸€äº›æ•°æ®éœ€è¦æ°¸ä¹…æ€§åœ°è®°å½•åœ¨åŒºå—é“¾ä¸­ä»¥ä¾¿å¯ä»¥åœ¨åº”ç”¨çš„å‰ç«¯ä¸­è¯»å–ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹ã€‚è¿™äº›æ•°æ®ä¸ä¼šå½±å“æ™ºèƒ½åˆçº¦å‘å‰çš„çŠ¶æ€ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨äº‹ä»¶æ¥ä½œä¸ºåƒµå°¸æˆ˜æ–—çš„å†å²çºªå½•â€”â€”æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡åƒµå°¸æ”»å‡»åˆ«äººä»¥åŠæœ‰ä¸€æ–¹èƒœå‡ºçš„æ—¶å€™äº§ç”Ÿä¸€ä¸ªäº‹ä»¶ã€‚æ™ºèƒ½åˆçº¦ä¸éœ€è¦è¿™äº›æ•°æ®æ¥è®¡ç®—ä»»ä½•æ¥ä¸‹æ¥çš„äº‹æƒ…ï¼Œä½†æ˜¯è¿™å¯¹æˆ‘ä»¬åœ¨å‰ç«¯å‘ç”¨æˆ·å±•ç¤ºæ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ä¸œè¥¿ã€‚</p>
<h2 id="Web3-js-äº‹ä»¶-å’Œ-MetaMask"><a href="#Web3-js-äº‹ä»¶-å’Œ-MetaMask" class="headerlink" title="Web3.js äº‹ä»¶ å’Œ MetaMask"></a>Web3.js äº‹ä»¶ å’Œ MetaMask</h2><p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç æ˜¯é’ˆå¯¹ Web3.js æœ€æ–°ç‰ˆ1.0çš„ï¼Œæ­¤ç‰ˆæœ¬ä½¿ç”¨äº† <strong><em>WebSockets\</em></strong> æ¥è®¢é˜…äº‹ä»¶ã€‚</p>
<p>ä½†æ˜¯ï¼ŒMetaMask å°šä¸”ä¸æ”¯æŒæœ€æ–°çš„äº‹ä»¶ API (å°½ç®¡å¦‚æ­¤ï¼Œä»–ä»¬å·²ç»åœ¨å®ç°è¿™éƒ¨åˆ†åŠŸèƒ½äº†ï¼Œ <a href="https://github.com/MetaMask/metamask-extension/issues/3642" target="_blank" rel="noopener">ç‚¹å‡»è¿™é‡Œ</a> æŸ¥çœ‹è¿›åº¦)</p>
<p>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå•ç‹¬ Web3 æä¾›è€…ï¼Œå®ƒé’ˆå¯¹äº‹ä»¶æä¾›äº†WebSocketsæ”¯æŒã€‚ æˆ‘ä»¬å¯ä»¥ç”¨ Infura æ¥åƒå®ä¾‹åŒ–ç¬¬äºŒä»½æ‹·è´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var web3Infura = new Web3(new Web3.providers.WebsocketProvider(&quot;wss://mainnet.infura.io/ws&quot;));</span><br><span class="line">var czEvents = new web3Infura.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å°†ä½¿ç”¨ <code>czEvents.events.Transfer</code> æ¥ç›‘å¬äº‹ä»¶ï¼Œè€Œä¸å†ä½¿ç”¨ <code>cryptoZombies.events.Transfer</code>ã€‚æˆ‘ä»¬å°†ç»§ç»­åœ¨è¯¾ç¨‹çš„å…¶ä»–éƒ¨åˆ†ä½¿ç”¨ <code>cryptoZombies.methods</code>ã€‚</p>
<p>å°†æ¥ï¼Œåœ¨ MetaMask å‡çº§äº† API æ”¯æŒ Web3.js åï¼Œæˆ‘ä»¬å°±ä¸ç”¨è¿™ä¹ˆåšäº†ã€‚ä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ˜¯è¦è¿™ä¹ˆåšï¼Œä»¥ä½¿ç”¨ Web3.js æ›´å¥½çš„æœ€æ–°è¯­æ³•æ¥ç›‘å¬äº‹ä»¶ã€‚</p>
<h2 id="æ”¾åœ¨ä¸€èµ·"><a href="#æ”¾åœ¨ä¸€èµ·" class="headerlink" title="æ”¾åœ¨ä¸€èµ·"></a>æ”¾åœ¨ä¸€èµ·</h2><p>æ¥æ·»åŠ ä¸€äº›ä»£ç ç›‘å¬ <code>Transfer</code> äº‹ä»¶ï¼Œå¹¶åœ¨å½“å‰ç”¨æˆ·è·å¾—ä¸€ä¸ªæ–°åƒµå°¸çš„æ—¶å€™ä¸ºä»–æ›´æ–°ç•Œé¢ã€‚</p>
<p>æˆ‘ä»¬å°†éœ€è¦åœ¨ <code>startApp</code> åº•éƒ¨æ·»åŠ ä»£ç ï¼Œä»¥ä¿è¯åœ¨æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ä¹‹å‰ <code>cryptoZombies</code> å·²ç»åˆå§‹åŒ–äº†ã€‚</p>
<ol>
<li>åœ¨ <code>startApp()</code>åº•éƒ¨ï¼Œä¸º <code>cryptoZombies.events.Transfer</code> å¤åˆ¶ç²˜è´´ä¸Šé¢çš„2è¡Œäº‹ä»¶ç›‘å¬ä»£ç å—</li>
<li>å¤åˆ¶ç›‘å¬ <code>Transfer</code> äº‹ä»¶çš„ä»£ç å—ï¼Œå¹¶ç”¨ <code>_to: userAccount</code> è¿‡æ»¤ã€‚è¦è®°å¾—æŠŠ <code>cryptoZombies</code> æ¢æˆ <code>czEvents</code> å¥½åœ¨è¿™ é‡Œä½¿ç”¨ Infura è€Œä¸æ˜¯ MetaMask æ¥ä½œä¸ºæä¾›è€…ã€‚</li>
<li>ç”¨ <code>getZombiesByOwner(userAccount).then(displayZombies);</code> æ¥æ›´æ–°ç•Œé¢</li>
</ol>
<h2 id="é¡µé¢ä¿®æ”¹-7"><a href="#é¡µé¢ä¿®æ”¹-7" class="headerlink" title="é¡µé¢ä¿®æ”¹"></a>é¡µé¢ä¿®æ”¹</h2><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"cryptozombies_abi.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"txStatus"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"zombies"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> cryptoZombies;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">var</span> userAccount;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">startApp</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"YOUR_CONTRACT_ADDRESS"</span>;</span></span><br><span class="line"><span class="actionscript">        cryptoZombies = <span class="keyword">new</span> web3js.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> accountInterval = setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Check if account has changed</span></span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (web3.eth.accounts[<span class="number">0</span>] !== userAccount) &#123;</span></span><br><span class="line">            userAccount = web3.eth.accounts[0];</span><br><span class="line"><span class="actionscript">            <span class="comment">// Call a function to update the UI with the new account</span></span></span><br><span class="line">            getZombiesByOwner(userAccount)</span><br><span class="line"><span class="vbscript">            .<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, 100);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Start here</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> web3Infura = <span class="keyword">new</span> Web3(<span class="keyword">new</span> Web3.providers.WebsocketProvider(<span class="string">"wss://mainnet.infura.io/ws"</span>));<span class="string">")</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> czEvents = <span class="keyword">new</span> web3Infura.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span></span><br><span class="line">        </span><br><span class="line"><span class="vbscript">        czEvents.events.Transfer(&#123; <span class="built_in">filter</span>: &#123; _to: userAccount &#125; &#125;)</span></span><br><span class="line"><span class="actionscript">        .on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">let</span> data = event.returnValues;</span></span><br><span class="line"><span class="vbscript">          getZombiesByOwner(userAccount).<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line"><span class="javascript">        &#125;).on(<span class="string">'error'</span>, <span class="built_in">console</span>.error);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">displayZombies</span><span class="params">(ids)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#zombies"</span>).empty();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (id <span class="keyword">of</span> ids) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Look up zombie details from our contract. Returns a `zombie` object</span></span></span><br><span class="line">          getZombieDetails(id)</span><br><span class="line"><span class="actionscript">          .then(<span class="function"><span class="keyword">function</span><span class="params">(zombie)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// Using ES6's "template literals" to inject variables into the HTML.</span></span></span><br><span class="line"><span class="actionscript">            <span class="comment">// Append each one to our #zombies div</span></span></span><br><span class="line"><span class="vbscript">            $(<span class="string">"#zombies"</span>).append(`&lt;div <span class="keyword">class</span>=<span class="string">"zombie"</span>&gt;</span></span><br><span class="line"><span class="handlebars"><span class="xml">              <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Name: $&#123;zombie.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>DNA: $&#123;zombie.dna&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Level: $&#123;zombie.level&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Wins: $&#123;zombie.winCount&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Losses: $&#123;zombie.lossCount&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span>Ready Time: $&#123;zombie.readyTime&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">              <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`);</span></span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">createRandomZombie</span><span class="params">(name)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// This is going to take a while, so update the UI to let the user know</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// the transaction has been sent</span></span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#txStatus"</span>).text(<span class="string">"Creating new zombie on the blockchain. This may take a while..."</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// Send the tx to our contract:</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.createRandomZombie(name)</span></span><br><span class="line">        .send(&#123; from: userAccount &#125;)</span><br><span class="line"><span class="actionscript">        .on(<span class="string">"receipt"</span>, <span class="function"><span class="keyword">function</span><span class="params">(receipt)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          $(<span class="string">"#txStatus"</span>).text(<span class="string">"Successfully created "</span> + name + <span class="string">"!"</span>);</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Transaction was accepted into the blockchain, let's redraw the UI</span></span></span><br><span class="line"><span class="vbscript">          getZombiesByOwner(userAccount).<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="actionscript">        .on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span><span class="params">(error)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Do something to alert the user their transaction has failed</span></span></span><br><span class="line"><span class="javascript">          $(<span class="string">"#txStatus"</span>).text(error);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">feedOnKitty</span><span class="params">(zombieId, kittyId)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#txStatus"</span>).text(<span class="string">"Eating a kitty. This may take a while..."</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.feedOnKitty(zombieId, kittyId)</span></span><br><span class="line">        .send(&#123; from: userAccount &#125;)</span><br><span class="line"><span class="actionscript">        .on(<span class="string">"receipt"</span>, <span class="function"><span class="keyword">function</span><span class="params">(receipt)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          $(<span class="string">"#txStatus"</span>).text(<span class="string">"Ate a kitty and spawned a new Zombie!"</span>);</span></span><br><span class="line"><span class="vbscript">          getZombiesByOwner(userAccount).<span class="keyword">then</span>(displayZombies);</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="actionscript">        .on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span><span class="params">(error)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          $(<span class="string">"#txStatus"</span>).text(error);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">levelUp</span><span class="params">(zombieId)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#txStatus"</span>).text(<span class="string">"Leveling up your zombie..."</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.levelUp(zombieId)</span></span><br><span class="line"><span class="actionscript">        .send(&#123; from: userAccount, value: web3.utils.toWei(<span class="string">"0.001"</span>, <span class="string">"ether"</span>) &#125;)</span></span><br><span class="line"><span class="actionscript">        .on(<span class="string">"receipt"</span>, <span class="function"><span class="keyword">function</span><span class="params">(receipt)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          $(<span class="string">"#txStatus"</span>).text(<span class="string">"Power overwhelming! Zombie successfully leveled up"</span>);</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="actionscript">        .on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span><span class="params">(error)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          $(<span class="string">"#txStatus"</span>).text(error);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombieDetails</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombies(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">zombieToOwner</span><span class="params">(id)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.zombieToOwner(id).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="function"><span class="keyword">function</span> <span class="title">getZombiesByOwner</span><span class="params">(owner)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> cryptoZombies.methods.getZombiesByOwner(owner).call()</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Checking if Web3 has been injected by the browser (Mist/MetaMask)</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Use Mist/MetaMask's provider</span></span></span><br><span class="line"><span class="actionscript">          web3js = <span class="keyword">new</span> Web3(web3.currentProvider);</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Handle the case where the user doesn't have Metamask installed</span></span></span><br><span class="line"><span class="actionscript">          <span class="comment">// Probably show them a message prompting them to install Metamask</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Now you can start your app &amp; access web3 freely:</span></span></span><br><span class="line">        startApp()</span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="æ”¾åœ¨ä¸€èµ·-1"><a href="#æ”¾åœ¨ä¸€èµ·-1" class="headerlink" title="æ”¾åœ¨ä¸€èµ·"></a>æ”¾åœ¨ä¸€èµ·</h1><p>æ­å–œå•Šå°‘å¹´ï¼Œä½ å·²ç»æˆåŠŸç¼–å†™äº†ä¸€ä¸ª Web3.js å‰ç«¯ç•Œé¢æ¥å’Œä½ çš„æ™ºèƒ½åˆçº¦äº¤äº’</p>
<h2 id="æ¥ä¸‹æ¥çš„æ­¥éª¤"><a href="#æ¥ä¸‹æ¥çš„æ­¥éª¤" class="headerlink" title="æ¥ä¸‹æ¥çš„æ­¥éª¤"></a>æ¥ä¸‹æ¥çš„æ­¥éª¤</h2><p>è¿™èŠ‚è¯¾çš„å†…å®¹éå¸¸åŸºç¡€ã€‚æˆ‘ä»¬æƒ³è¦ç»™ä½ å±•ç¤ºå’Œæ™ºèƒ½åˆçº¦äº¤äº’çš„æ ¸å¿ƒå†…å®¹ï¼Œè€Œå¹¶ä¸æƒ³ç”¨å¤ªå¤šçš„æ—¶é—´æ¥æ•™ä½ å®Œæ•´å®ç°ã€‚æˆ‘ä»¬ä¹Ÿä¸æƒ³èŠ±å¤ªå¤šæ—¶é—´åœ¨HTML/CSSä¸Šï¼Œå› ä¸ºå¤§éƒ¨åˆ†äººéƒ½å·²ç»çŸ¥é“äº†ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æŠŠä¸€äº›å®ç°ç•¥å»äº†ã€‚è¿™é‡Œæ˜¯ä½ è¦å®Œæ•´å®ç°æ‰€éœ€è¦å®Œæˆçš„åŸºæœ¬äº‹é¡¹åˆ—è¡¨ï¼š</p>
<ol>
<li><p>ä¸º <code>attack</code>, <code>changeName</code>, <code>changeDna</code> ä»¥åŠ ERC721 å‡½æ•° <code>transfer</code>, <code>ownerOf</code>, <code>balanceOf</code> ç­‰å®ç°å‰ç«¯å‡½æ•°ã€‚è¿™äº›å‡½æ•°çš„å®ç°å°†å’Œæˆ‘ä»¬è®²è¿‡çš„ <code>send</code>äº‹åŠ¡çš„å‡½æ•°éå¸¸ç›¸ä¼¼ã€‚</p>
</li>
<li><p>å®ç°ä¸€ä¸ªâ€œç®¡ç†ç•Œé¢â€ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥è°ƒç”¨ <code>setKittyContractAddress</code>, <code>setLevelUpFee</code>, ä»¥åŠ <code>withdraw</code>ã€‚å†æ¬¡ï¼Œåœ¨å‰ç«¯è¿™å—æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ä»£ç â€”â€”è¿™äº›å®ç°ä¹‹é—´å°†éå¸¸ç›¸ä¼¼ã€‚ä½ åº”è¯¥ä¿è¯ä»éƒ¨ç½²åˆåŒæ—¶å€™ç›¸åŒçš„ä»¥å¤ªåŠåœ°å€è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œå› ä¸ºä»–ä»¬éƒ½æœ‰<code>onlyOwner</code> ä¿®é¥°ç¬¦ã€‚</p>
</li>
<li><p>åœ¨åº”ç”¨é‡Œæˆ‘ä»¬è¿˜åº”è¯¥å®ç°ä¸€äº›å…¶ä»–çš„ç•Œé¢ï¼š</p>
<p>a. ä¸€ä¸ªåƒµå°¸é¡µé¢ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªç‰¹å®šåƒµå°¸çš„ä¿¡æ¯å¹¶å¯ä»¥åˆ†äº«å®ƒçš„é“¾æ¥ã€‚è¿™ä¸ªé¡µé¢åº”è¯¥æ¸²æŸ“åƒµå°¸çš„å¤–å½¢ï¼Œå±•ç¤ºå®ƒçš„åå­—ï¼Œå®ƒçš„æ‰€æœ‰è€…ï¼ˆä»¥åŠç”¨æˆ·ä¸»é¡µçš„é“¾æ¥ï¼‰ï¼Œå®ƒçš„è¾“èµ¢æ¬¡æ•°ï¼Œå®ƒçš„æˆ˜æ–—è®°å½•ç­‰ç­‰ã€‚</p>
<p>b. ä¸€ä¸ªç”¨æˆ·ç•Œé¢ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥æŸ¥çœ‹ç”¨æˆ·çš„åƒµå°¸å¤§å†›å¹¶åˆ†äº«å®ƒçš„é“¾æ¥ã€‚</p>
<p>c. ä¸€ä¸ªä¸»é¡µï¼Œå°±æ˜¯ç”¨æˆ·é¡µé¢çš„å˜ä½“ï¼Œå¯ä»¥å±•ç¤ºå½“å‰ç”¨æˆ·çš„åƒµå°¸å¤§å†›ï¼ˆæ­£å¦‚æˆ‘ä»¬åœ¨index.htmlï¼‰é‡Œé¢å®ç°çš„é‚£æ ·ã€‚</p>
</li>
<li><p>ç•Œé¢ä¸­çš„ä¸€äº›æ–¹æ³•å…è®¸ç”¨æˆ·ç”¨ CryptoKitties å–‚é£Ÿåƒµå°¸ã€‚æˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸€ä¸ªåƒµå°¸æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œå«åšâ€œç»™æˆ‘æŠ•é£Ÿâ€ï¼Œå†ç»™ä¸€ä¸ªè¾“å…¥æ¡†è®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ªçŒ«å’ªçš„IDï¼ˆæˆ–è€…ä¸€ä¸ªçŒ«å’ªçš„ç½‘å€ï¼Œæ¯”å¦‚<a href="https://www.cryptokitties.co/kitty/578397ï¼‰ï¼Œå®ƒå°†è§¦å‘æˆ‘ä»¬çš„" target="_blank" rel="noopener">https://www.cryptokitties.co/kitty/578397ï¼‰ï¼Œå®ƒå°†è§¦å‘æˆ‘ä»¬çš„</a> <code>feedOnKitty</code> å‡½æ•°ã€‚</p>
</li>
<li><p>ç•Œé¢ä¸­çš„ä¸€äº›æ–¹æ³•å°†è®©ç”¨æˆ·ç”¨æ¥æ”»å‡»å…¶ä»–ç”¨æˆ·çš„åƒµå°¸</p>
<p>å®ç°è¿™ç‚¹çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œå½“ç”¨æˆ·æµè§ˆå…¶ä»–ç”¨æˆ·çš„é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨å¯¹æ–¹åƒµå°¸æ—è¾¹æ˜¾ç¤ºä¸€ä¸ªæŒ‰é’®ï¼Œå«åšâ€œæ”»å‡»è¿™å¤´åƒµå°¸â€ã€‚å½“ç”¨æˆ·ç‚¹å‡»çš„æ—¶å€™ï¼Œå¯ä»¥å¼¹å‡ºä¸€ä¸ªæ¨¡å—ï¼Œå±•ç¤ºå½“å‰ç”¨æˆ·çš„åƒµå°¸å¤§å†›å¹¶è¯¢é—®ç”¨æˆ·â€œä½ æƒ³ç”¨å“ªå¤´åƒµå°¸å‡ºæˆ˜ï¼Ÿâ€</p>
<p>åœ¨ç”¨æˆ·çš„ä¸»é¡µï¼Œä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªåƒµå°¸æ—è¾¹æ˜¾ç¤ºä¸€ä¸ªæŒ‰é’®ï¼Œå«åšâ€œæ”»å‡»ä¸€ä¸ªåƒµå°¸â€ã€‚å½“ç”¨æˆ·ç‚¹å‡»çš„æ—¶å€™ï¼Œå¯ä»¥å¼¹å‡ºä¸€ä¸ªæ¨¡å—ï¼Œå±•ç¤ºä¸€ä¸ªæœç´¢æ¡†ï¼Œå¯ä»¥è®©ç”¨æˆ·è¾“å…¥åƒµå°¸IDæˆ–è€…ç½‘å€æ¥æœç´¢ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªæŒ‰é’®å«åšâ€œéšæœºæ”»å‡»ä¸€å¤´åƒµå°¸â€ï¼Œå°†éšæœºæœç´¢ä¸€å¤´åƒµå°¸æ¥ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå»ºè®®ä½ å°†åœ¨å†·å´æœŸçš„åƒµå°¸ç”¨ç‰¹æ®Šçš„é¢œè‰²æ˜¾ç¤ºï¼Œæ¯”å¦‚ä½¿å…¶å˜æˆç°è‰²ã€‚è¿™æ ·ç•Œé¢å°±èƒ½å‘Šè¯‰ç”¨æˆ·ä¸èƒ½ç”¨å†·å´æœŸçš„åƒµå°¸æ¥è¿›æ”»ã€‚</p>
</li>
<li><p>åœ¨ç”¨æˆ·çš„ä¸»é¡µï¼Œæ¯ä¸€ä¸ªåƒµå°¸ä¹Ÿåº”è¯¥æœ‰é€‰é¡¹å¯ä»¥æ›´æ”¹åå­—ã€DNAã€ä»¥åŠå‡çº§ï¼ˆé€šè¿‡ä»˜è´¹ï¼‰ã€‚è‹¥ç”¨æˆ·ç­‰çº§ä¸åˆ°ï¼Œæ— æ³•ä½¿ç”¨çš„é€‰é¡¹åº”è¯¥æ ‡ç°ã€‚</p>
</li>
<li><p>å¯¹äºæ–°ç”¨æˆ·ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¾ç¤ºä¸€ä¸ªæ¬¢è¿ä¿¡æ¯ï¼Œå¹¶è®©å…¶ç¡®è®¤ç”¨ <code>createRandomZombie()</code>åˆ›å»ºä¸€ä¸ªæ–°åƒµå°¸ã€‚</p>
</li>
<li><p>ä¹Ÿå¯ä»¥ä¸ºæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦æ·»åŠ ä¸€ä¸ªåŒ…å«<code>indexed</code> çš„ç”¨æˆ·åœ°å€å±æ€§çš„ <code>Attack</code> äº‹ä»¶ã€‚è¿™æ ·å°±å¯ä»¥åˆ›å»ºå®æ—¶é€šçŸ¥äº†â€”â€”æˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ·çš„åƒµå°¸é­å—æ”»å‡»çš„æ—¶å€™å¼¹å‡ºä¸€æ¡é€šçŸ¥ï¼Œè¿™æ ·ä»–ä»¬å¯ä»¥çœ‹åˆ°è°åœ¨ç”¨ä»€ä¹ˆåƒµå°¸æ”»å‡»ä»–ä»¬å¹¶åšå‡ºæŠ¥å¤ã€‚</p>
</li>
<li><p>æˆ‘ä»¬ä¹Ÿè®¸è¿˜æƒ³å®ç°ä¸€äº›å‰ç«¯ç¼“å­˜å±‚ï¼Œè¿™æ ·å°±ä¸ç”¨æ€»æ˜¯ä¸ºäº†ç›¸åŒçš„æ•°æ®å»è®¿é—®Infuraã€‚ï¼ˆåœ¨æˆ‘ä»¬å½“å‰å®ç°ä¸­ï¼Œ<code>displayZombies</code> å°†åœ¨æ¯æ¬¡é¡µé¢åˆ·æ–°çš„æ—¶å€™ä¸ºæ¯ä¸€ä¸ªåƒµå°¸è°ƒç”¨ <code>getZombieDetails</code>ï¼Œä½†æ˜¯å®é™…ä¸­æˆ‘ä»¬å°†åªéœ€è¦ä¸ºæ–°åŠ å…¥çš„åƒµå°¸è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼‰</p>
</li>
<li><p>ä¸€ä¸ªå®æ—¶èŠå¤©å®¤ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨ä½ å‡»æºƒåˆ«äººçš„åƒµå°¸å¤§å†›çš„åŒæ—¶å˜²è®½ä»–ä»¬ï¼Ÿ</p>
</li>
</ol>
<p>å› ä¸ºè¿™å°†éœ€è¦å¤§é‡çš„å‰ç«¯ä»£ç æ¥å®ç°å…¨éƒ¨çš„ç•Œé¢ï¼ˆHTMLï¼Œ CSSï¼Œ JavaScript ä»¥åŠè¯¸å¦‚ React å’Œ Vue.js è¿™æ ·çš„æ¡†æ¶ï¼‰ã€‚å…‰å®ç°ä¸€ä¸ªè¿™æ ·çš„å‰ç«¯ç•Œé¢ä¹Ÿè®¸ä¼šèŠ±è´¹å¤šè¾¾10èŠ‚è¯¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¿™ä¸ªå…‰è£çš„ä»»åŠ¡äº¤ç»™ä½ è‡ªå·±å»å®Œæˆã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå°½ç®¡æ™ºèƒ½åˆçº¦æ˜¯å»ä¸­å¿ƒåŒ–çš„ã€‚è¿™ä¸ªç”¨æ¥å’ŒDAppäº¤äº’çš„å‰ç«¯ç•Œé¢ä¾ç„¶éœ€è¦æ”¾åœ¨æˆ‘ä»¬ä¸­å¿ƒåŒ–çš„ç½‘ç»œæœåŠ¡å™¨ä¸Šã€‚ä¸è¿‡ï¼Œæœ‰äº†æˆ‘ä»¬æ­£åœ¨å†…æµ‹çš„<a href="https://medium.com/loom-network-chinese/3d0d686163df" target="_blank" rel="noopener">Loom Network</a> SDKï¼Œå¾ˆå¿«ä½ å°±å¯ä»¥åœ¨åº”ç”¨è‡ªå·±çš„DAppé“¾ä¸Šè¿è¡Œå‰ç«¯ç•Œé¢è€Œä¸æ˜¯ä¸­å¿ƒåŒ–çš„ç½‘ç»œæœåŠ¡å™¨ã€‚è¿™æ ·åœ¨ä»¥å¤ªåŠå’Œ Loom DApp é“¾ä¸Šï¼Œä½ çš„æ•´ä¸ªåº”ç”¨éƒ½100%è¿è¡Œåœ¨åŒºå—é“¾ä¸Šäº†ã€‚</p>
</blockquote>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å­¦å®Œç¬¬å…­è¯¾ã€‚ä½ ç°åœ¨æœ‰äº†ç¼–å†™æ™ºèƒ½åˆçº¦å’Œå‰ç«¯ç•Œé¢æ¥è®©ç”¨æˆ·äº¤äº’çš„æ‰€éœ€æŠ€èƒ½äº†ã€‚</p>
<p>åœ¨ä¸‹ä¸€è¯¾ã€‚ æˆ‘ä»¬å°†æ¶‰åŠè¿™ä¸ªå†ç¨‹ä¸­æœ€åç¼ºå¤±çš„ä¸€éƒ¨åˆ†â€”â€”å°†ä½ çš„æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°ä»¥å¤ªåŠã€‚</p>
<p>çŸ¥é“ä½ å·²ç»æ€¥ä¸å¯è€äº†ï¼Œç‚¹å‡»â€œä¸‹ä¸€ç« â€é¢†å–ä½ çš„å¥–åŠ±å§ã€‚</p>
<p><img src="https://i.loli.net/2020/06/30/HMZXOmk7bAvPoIS.png" alt="image-20200630142837304"></p>
<h1 id="ç¬¬å…­è¯¾æ‰“å¡"><a href="#ç¬¬å…­è¯¾æ‰“å¡" class="headerlink" title="ç¬¬å…­è¯¾æ‰“å¡"></a>ç¬¬å…­è¯¾æ‰“å¡</h1><p><img src="https://i.loli.net/2020/06/30/k35KTEDdXcHyVzM.png" alt="image-20200630143006394"></p>
<p><a href="https://share.cryptozombies.io/zh/lesson/6/share/The_Phantom_of_Web3" target="_blank" rel="noopener">æˆ‘çš„åƒµå°¸å¤§å†›6</a></p>

    </div>

    
    
    
      
        <div class="reward-container">
  <div>æ‚¨çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ›ä½œçš„åŠ¨åŠ›</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="ææ¾æŸ å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="ææ¾æŸ æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>ææ¾æŸ
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="http://lisongbai.top/2020/06/30/web3-js/" title="web3.js">http://lisongbai.top/2020/06/30/web3-js/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/web3-js/" rel="tag"># web3.js</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2020/06/29/ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81/" rel="next" title="ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“">
                  <i class="fa fa-chevron-left"></i> ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2020/06/30/%E4%BD%BF%E7%94%A8truffle%E6%B5%8B%E8%AF%95%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" rel="prev" title="ä½¿ç”¨truffleæµ‹è¯•æ™ºèƒ½åˆçº¦">
                  ä½¿ç”¨truffleæµ‹è¯•æ™ºèƒ½åˆçº¦ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-disqus">disqus</a></li>
            <li class="tab"><a href="#comment-livere">livere</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane disqus" id="comment-disqus">
              
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  
            </div>
            <div class="tab-pane livere" id="comment-livere">
              
  <div class="comments" id="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC80NzY2MC8yNDE1OA=="></div>
  </div>
  
            </div>
        </div>
      </div>
      <script>
        window.addEventListener('tabs:register', () => {
          let activeClass = '';
            activeClass = localStorage.getItem('comments_active') || activeClass;
          if (activeClass) {
            let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
            if (activeTab) {
              activeTab.click();
            }
          }
        });
        window.addEventListener('tabs:click', event => {
          let commentClass = event.target.classList[1];
          localStorage.setItem('comments_active', commentClass);
        });
      </script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ä»‹ç»-Web3-js"><span class="nav-number">1.</span> <span class="nav-text">ä»‹ç» Web3.js</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»€ä¹ˆæ˜¯-Web3-js"><span class="nav-number">1.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯ Web3.js?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ"><span class="nav-number">1.2.</span> <span class="nav-text">å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ "><span class="nav-number">1.3.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢åˆ›å»º"><span class="nav-number">1.4.</span> <span class="nav-text">é¡µé¢åˆ›å»º</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Web3-æä¾›è€…"><span class="nav-number">2.</span> <span class="nav-text">Web3 æä¾›è€…</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Infura"><span class="nav-number">2.1.</span> <span class="nav-text">Infura</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Metamask"><span class="nav-number">2.2.</span> <span class="nav-text">Metamask</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨-Metamask-çš„-web3-æä¾›è€…"><span class="nav-number">2.3.</span> <span class="nav-text">ä½¿ç”¨ Metamask çš„ web3 æä¾›è€…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -1"><span class="nav-number">2.4.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢ä¿®æ”¹"><span class="nav-number">2.5.</span> <span class="nav-text">é¡µé¢ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å’Œåˆçº¦å¯¹è¯"><span class="nav-number">3.</span> <span class="nav-text">å’Œåˆçº¦å¯¹è¯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦åœ°å€"><span class="nav-number">3.1.</span> <span class="nav-text">åˆçº¦åœ°å€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆçº¦-ABI"><span class="nav-number">3.2.</span> <span class="nav-text">åˆçº¦ ABI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®ä¾‹åŒ–-Web3-js"><span class="nav-number">3.3.</span> <span class="nav-text">å®ä¾‹åŒ– Web3.js</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -2"><span class="nav-number">3.4.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢ä¿®æ”¹-1"><span class="nav-number">3.5.</span> <span class="nav-text">é¡µé¢ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è°ƒç”¨å’Œåˆçº¦å‡½æ•°"><span class="nav-number">4.</span> <span class="nav-text">è°ƒç”¨å’Œåˆçº¦å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Call"><span class="nav-number">4.0.1.</span> <span class="nav-text">Call</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Send"><span class="nav-number">4.0.2.</span> <span class="nav-text">Send</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è·å–åƒµå°¸æ•°æ®"><span class="nav-number">4.1.</span> <span class="nav-text">è·å–åƒµå°¸æ•°æ®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -3"><span class="nav-number">4.2.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢ä¿®æ”¹-2"><span class="nav-number">4.3.</span> <span class="nav-text">é¡µé¢ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MetaMask-å’Œè´¦æˆ·"><span class="nav-number">5.</span> <span class="nav-text">MetaMask å’Œè´¦æˆ·</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#è·å¾—-MetaMaskä¸­çš„ç”¨æˆ·è´¦æˆ·"><span class="nav-number">5.1.</span> <span class="nav-text">è·å¾— MetaMaskä¸­çš„ç”¨æˆ·è´¦æˆ·</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -4"><span class="nav-number">5.2.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢ä¿®æ”¹-3"><span class="nav-number">5.3.</span> <span class="nav-text">é¡µé¢ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ˜¾ç¤ºåƒµå°¸å¤§å†›"><span class="nav-number">6.</span> <span class="nav-text">æ˜¾ç¤ºåƒµå°¸å¤§å†›</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ˜¾ç¤ºåƒµå°¸æ•°æ®-â€”-ä¸€ä¸ªç²—ç•¥çš„ä¾‹å­"><span class="nav-number">6.1.</span> <span class="nav-text">æ˜¾ç¤ºåƒµå°¸æ•°æ® â€” ä¸€ä¸ªç²—ç•¥çš„ä¾‹å­</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¦‚ä½•æ¥å±•ç¤ºåƒµå°¸å…ƒç´ å‘¢ï¼Ÿ"><span class="nav-number">6.2.</span> <span class="nav-text">å¦‚ä½•æ¥å±•ç¤ºåƒµå°¸å…ƒç´ å‘¢ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -5"><span class="nav-number">6.3.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢ä¿®æ”¹-4"><span class="nav-number">6.4.</span> <span class="nav-text">é¡µé¢ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å‘é€äº‹åŠ¡"><span class="nav-number">7.</span> <span class="nav-text">å‘é€äº‹åŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ç”Ÿæˆä¸€ä¸ªåƒµå°¸"><span class="nav-number">7.1.</span> <span class="nav-text">ç”Ÿæˆä¸€ä¸ªåƒµå°¸</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -6"><span class="nav-number">7.2.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢ä¿®æ”¹-5"><span class="nav-number">7.3.</span> <span class="nav-text">é¡µé¢ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è°ƒç”¨-Payable-å‡½æ•°"><span class="nav-number">8.</span> <span class="nav-text">è°ƒç”¨ Payable å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‡çº§ï¼"><span class="nav-number">8.1.</span> <span class="nav-text">å‡çº§ï¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å•¥æ˜¯-Wei"><span class="nav-number">8.2.</span> <span class="nav-text">å•¥æ˜¯ Wei?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®æˆ˜æ¼”ä¹ -7"><span class="nav-number">8.3.</span> <span class="nav-text">å®æˆ˜æ¼”ä¹ </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢ä¿®æ”¹-6"><span class="nav-number">8.4.</span> <span class="nav-text">é¡µé¢ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#è®¢é˜…äº‹ä»¶"><span class="nav-number">9.</span> <span class="nav-text">è®¢é˜…äº‹ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ç›‘å¬æ–°åƒµå°¸äº‹ä»¶"><span class="nav-number">9.1.</span> <span class="nav-text">ç›‘å¬æ–°åƒµå°¸äº‹ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨-indexed"><span class="nav-number">9.2.</span> <span class="nav-text">ä½¿ç”¨ indexed</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶"><span class="nav-number">9.3.</span> <span class="nav-text">æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web3-js-äº‹ä»¶-å’Œ-MetaMask"><span class="nav-number">9.4.</span> <span class="nav-text">Web3.js äº‹ä»¶ å’Œ MetaMask</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ”¾åœ¨ä¸€èµ·"><span class="nav-number">9.5.</span> <span class="nav-text">æ”¾åœ¨ä¸€èµ·</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é¡µé¢ä¿®æ”¹-7"><span class="nav-number">9.6.</span> <span class="nav-text">é¡µé¢ä¿®æ”¹</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ”¾åœ¨ä¸€èµ·-1"><span class="nav-number">10.</span> <span class="nav-text">æ”¾åœ¨ä¸€èµ·</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¥ä¸‹æ¥çš„æ­¥éª¤"><span class="nav-number">10.1.</span> <span class="nav-text">æ¥ä¸‹æ¥çš„æ­¥éª¤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">10.2.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬å…­è¯¾æ‰“å¡"><span class="nav-number">11.</span> <span class="nav-text">ç¬¬å…­è¯¾æ‰“å¡</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="ææ¾æŸ"
    src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">ææ¾æŸ</p>
  <div class="site-description" itemprop="description">è®°å½•å­¦ä¹ çš„æŠ€èƒ½å’Œé‡åˆ°çš„é—®é¢˜</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yym08090809" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;yym08090809" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:songbai0112@163.com" title="E-Mail &amp;rarr; mailto:songbai0112@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 â€“ 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ææ¾æŸ</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.2
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>






  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': '',
            'X-LC-Key': '',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>






        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://visitor.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "http://lisongbai.top/2020/06/30/web3-js/",
            identifier: "2020/06/30/web3-js/",
            title: "web3.js"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://visitor.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    window.addEventListener('load', loadComments, false);
</script>

<script>
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

 
</body>
</html>
